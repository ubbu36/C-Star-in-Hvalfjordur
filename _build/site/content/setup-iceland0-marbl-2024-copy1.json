{"version":3,"kind":"Notebook","sha256":"9dcf071219334019631c7ac47dbc294a04203e8b6daa696f48fd2309b5053a84","slug":"setup-iceland0-marbl-2024-copy1","location":"/SETUP_Iceland0_MARBL_2024-Copy1.ipynb","dependencies":[],"frontmatter":{"title":"ROMS-TOOLS setup for Iceland0_MARBL_2024","content_includes_title":false,"kernelspec":{"name":"romstools-test","display_name":"Python (tomstools-test)","language":"python"},"exports":[{"format":"ipynb","filename":"SETUP_Iceland0_MARBL_2024-Copy1.ipynb","url":"/SETUP_Iceland0_MARBL-4ac1f83b9f1d0c01e78d01186cb4709c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First step is to set up the outer grid using ROMS-TOOLS and save the grid file.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cnNXcIC86t"}],"key":"IcB7NHxPgy"}],"key":"HzjUwQQgnq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom roms_tools import Grid","key":"zAH1WK7iku"},{"type":"outputs","id":"Up9fotC8ZZfJcv5u6YTh_","children":[],"key":"ckM0ZKsp9Q"}],"key":"gs66h8bVAM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"project='/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/'\ndatasets='/anvil/projects/x-ees250129/Datasets/'\nmodel_name='Iceland0'\nchild_name='Iceland1'\ngrid_path='/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_s2r_phys+bgc/1.Make_grid/Iceland0_grid_MAT.nc'","key":"cV3e8Oaxpt"},{"type":"outputs","id":"dkDmG2oYAaMu3qUV5mVry","children":[],"key":"mmjHI3mAYf"}],"key":"dy2mMSKRMR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#%%time\n\n#grid = Grid(\n#    nx=512,  # number of grid points in x-direction\n#    ny=512,  # number of grid points in y-direction\n#    size_x=1280,  # domain size in x-direction (in km)\n#    size_y=1280,  # domain size in y-direction (in km)\n#    center_lon=-25,  # longitude of the center of the domain\n#    center_lat=63,  # latitude of the center of the domain\n#    rot=-20,  # rotation of the grid (in degrees)\n#    topography_source={\n#        \"name\": \"SRTM15\",\n#        \"path\":datasets+\"SRTM15/SRTM15_V2.6.nc\"},\n#    N=100,  # number of vertical layers\n#    verbose=True,\n#)","key":"ReZOTB45zb"},{"type":"outputs","id":"wyuMRj1AWlP-XWR5qDSTC","children":[],"key":"c3wAhxaGjI"}],"key":"iTg9eOgTZt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid = Grid.from_file(grid_path)","key":"r1YMQZYbID"},{"type":"outputs","id":"D-2QhZGiS_4vXuBRmaRVt","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:00:02 - WARNING - Vertical coordinates (Cs_r, Cs_w) not found in grid file.\n2025-11-20 13:00:02 - INFO - === Preparing the vertical coordinate system using N = 100, theta_s = 5.0, theta_b = 2.0, hc = 300.0 ===\n2025-11-20 13:00:02 - INFO - Total time: 0.004 seconds\n2025-11-20 13:00:02 - INFO - ================================================================================================\n"},"children":[],"key":"tHPdqIUsp8"}],"key":"XrrTAAbzjr"}],"key":"qmKetzZVXC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n","key":"mKJHu6i3eg"},{"type":"outputs","id":"jaGPLdG-xSEg4Hx-hFhrx","children":[],"key":"uWd3X5YpWZ"}],"key":"lzs7pkrezY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid.update_vertical_coordinate(N=60, theta_s=5.0, theta_b=2.0, hc=300.0, verbose=False)","key":"IcHvE99xkF"},{"type":"outputs","id":"GEiJzaeGNmv0EyciOekZf","children":[],"key":"wR6oOwi1Vs"}],"key":"v3IsjYPG5u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"f4NKx8QhVm"},{"type":"outputs","id":"zT3uI9XRXg6U5OvK42els","children":[],"key":"XLBhd5OD9A"}],"key":"sCNlOTrnEm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid.ds","key":"P6qvXxocI0"},{"type":"outputs","id":"FinXOceVJrUVLI3z3iJEh","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"79aa83984adb5e4831a256ae48e0b6df","path":"/79aa83984adb5e4831a256ae48e0b6df.html"},"text/plain":{"content":"<xarray.Dataset> Size: 31MB\nDimensions:       (one: 1, eta_rho: 514, xi_rho: 514, xi_u: 513, eta_v: 513,\n                   eta_coarse: 258, xi_coarse: 258, s_rho: 60, s_w: 61)\nCoordinates:\n    lon_rho       (eta_rho, xi_rho) float64 2MB ...\n    lat_rho       (eta_rho, xi_rho) float64 2MB ...\n    lat_u         (eta_rho, xi_u) float64 2MB 58.73 58.73 58.73 ... 65.43 65.41\n    lon_u         (eta_rho, xi_u) float64 2MB 320.7 320.8 320.8 ... 352.9 352.9\n    lat_v         (eta_v, xi_rho) float64 2MB 58.74 58.74 58.74 ... 65.41 65.4\n    lon_v         (eta_v, xi_rho) float64 2MB 320.7 320.7 320.8 ... 352.9 352.9\n    lat_coarse    (eta_coarse, xi_coarse) float64 533kB 58.72 58.72 ... 65.41\n    lon_coarse    (eta_coarse, xi_coarse) float64 533kB 320.7 320.8 ... 353.0\nDimensions without coordinates: one, eta_rho, xi_rho, xi_u, eta_v, eta_coarse,\n                                xi_coarse, s_rho, s_w\nData variables: (12/20)\n    spherical     (one) |S1 1B ...\n    angle         (eta_rho, xi_rho) float64 2MB ...\n    h             (eta_rho, xi_rho) float64 2MB ...\n    hraw          (eta_rho, xi_rho) float64 2MB ...\n    f             (eta_rho, xi_rho) float64 2MB ...\n    pm            (eta_rho, xi_rho) float64 2MB ...\n    ...            ...\n    angle_coarse  (eta_coarse, xi_coarse) float64 533kB -0.1261 ... -0.6262\n    mask_coarse   (eta_coarse, xi_coarse) int32 266kB 1 1 1 1 1 1 ... 1 1 1 1 1\n    sigma_r       (s_rho) float32 240B -0.9917 -0.975 ... -0.025 -0.008333\n    Cs_r          (s_rho) float32 240B -0.9865 -0.9579 ... -0.0002471 -2.743e-05\n    sigma_w       (s_w) float32 244B -1.0 -0.9833 -0.9667 ... -0.01667 0.0\n    Cs_w          (s_w) float32 244B -1.0 -0.9725 -0.9429 ... -0.0001098 0.0\nAttributes:\n    Title:     ROMS grid by Easy Grid. Settings: nx: 512 ny: 512 xsize: 1280 ...\n    Date:      14-Oct-2025\n    Type:      ROMS grid produced by Easy Grid\n    straddle:  False\n    theta_s:   5.0\n    theta_b:   2.0\n    hc:        300.0","content_type":"text/plain"}}},"children":[],"key":"w5Fsn5c863"}],"key":"ns9ApXBJhO"}],"key":"T6UhnrJF50"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#mat_grid['h'].plot()","key":"GIzlTTjFOq"},{"type":"outputs","id":"BPXeWuLNCwh7n7jyssFlU","children":[],"key":"HAsndSWgBk"}],"key":"ylMdDsbWBv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid.plot()\n","key":"WMvHveZdCd"},{"type":"outputs","id":"UW7c1BJBLZmKRtOKPrPbt","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c0617ebc27dd8444d13f1e7f858dd719","path":"/c0617ebc27dd8444d13f1e7f858dd719.png"},"text/plain":{"content":"<Figure size 1300x700 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"kMXQCuOWP6"}],"key":"MlYJEzfjcd"}],"key":"UYgObYbSlG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+'_grid_60.nc'\nyaml_filepath=project+model_name+'_grid_60.yaml'","key":"Ygf0OUlYEr"},{"type":"outputs","id":"a2fZ9S9UbU7dJ7OM_xXTf","children":[],"key":"P4FLpQJ1az"}],"key":"wzXpumWU2v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid.save(filepath)","key":"utnU0kZRUd"},{"type":"outputs","id":"yu_X0xjLZXxDDbmcSnPLM","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:00:03 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_grid_60.nc\n"},"children":[],"key":"rt0BoVRCY9"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_grid_60.nc')]","content_type":"text/plain"}}},"children":[],"key":"hSUXwgz5QP"}],"key":"IPopnMrcWB"}],"key":"d5K6SuJL2e"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid.to_yaml(yaml_filepath)","key":"BzFi4zSszW"},{"type":"outputs","id":"XiG-B6hlNqik5TagmTXg7","children":[],"key":"ciSL6WErmc"}],"key":"KNXgQU0EFM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tpxo_path = datasets+\"TPXO/TPXO10.v2/\"\ntpxo_dict = {\n    \"grid\": tpxo_path + \"grid_tpxo10v2.nc\",\n    \"h\": tpxo_path + \"h_tpxo10.v2.nc\",\n    \"u\": tpxo_path + \"u_tpxo10.v2.nc\",\n}","key":"RutYKfEELt"},{"type":"outputs","id":"UG_-FwtM-VBIAUPGMXxDI","children":[],"key":"T2nQH4TRtd"}],"key":"wmLBgtWEgX"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we set up tidal forcing:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BUvOqu95hA"}],"key":"Xd6spuzntV"}],"key":"ZYDxuXGkmQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import TidalForcing","key":"uQpU63da9T"},{"type":"outputs","id":"H5ZjNO7BaOR71qp7-SS0K","children":[],"key":"ej9mf8YF7F"}],"key":"cJ6F37Oaaa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime","key":"TbZ6HyrBQV"},{"type":"outputs","id":"KkI9rao8n4mIYOntu--0R","children":[],"key":"DOcLQEuAb9"}],"key":"FhCamUqFad"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model_reference_date = datetime(2000, 1, 1)","key":"yyndv1YDKf"},{"type":"outputs","id":"pJlSBrmLPXiyZ42iSS8iJ","children":[],"key":"BrLeaVsChj"}],"key":"sdVXpf2hyg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\ntidal_forcing = TidalForcing(\n    grid=grid,\n    source={\"name\": \"TPXO\", \"path\": tpxo_dict},\n    ntides=15,  # Number of constituents to consider <= 15. Default is 10.\n    model_reference_date=model_reference_date,  # Model reference date. Default is January 1, 2000.\n    use_dask=True\n)","key":"muxUehJuvL"},{"type":"outputs","id":"p3kyuK2BMj4xZHHbI2zly","children":[],"key":"twELoppimx"}],"key":"nkIicJzkve"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_tides.nc\"","key":"vfTJITOCut"},{"type":"outputs","id":"I7AEEaRpYlGLIZENu2bIV","children":[],"key":"RLOvIqJ9I3"}],"key":"ACCmnJoehn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time tidal_forcing.save(filepath)","key":"xlGE144umg"},{"type":"outputs","id":"gUPqmCuh20ngnJeu0if0m","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:00:08 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_tides.nc\n"},"children":[],"key":"acX3Rz59C8"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 7.18 sms\nCPU times: user 3min 4s, sys: 1.58 s, total: 3min 5s\nWall time: 7.35 s\n"},"children":[],"key":"nehmSDZr4u"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_tides.nc')]","content_type":"text/plain"}}},"children":[],"key":"L7kmq2L0La"}],"key":"pm23Rzm4sJ"}],"key":"gBSAHiurAg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For the surface forcing, we use ERA5 plus the unified BGC dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XWv0EW7FMc"}],"key":"RR6SQFoMB9"}],"key":"Wand1aL9le"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, SurfaceForcing","key":"bUsgwn84c0"},{"type":"outputs","id":"3ZDrzgn2iDlfaJvaqQXlY","children":[],"key":"lRoqeEGcZ0"}],"key":"fCcZdiwanG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start_time = datetime(2024, 1, 1)\nend_time = datetime(2024, 6, 1)\nstart_time1 = datetime(2024, 6, 1)\nend_time1 = datetime(2024, 12, 1)","key":"E3NRyCBlwG"},{"type":"outputs","id":"LFxYVrCrGc0Qr7zIl6Jjb","children":[],"key":"KTfsGOp9DE"}],"key":"nRtP9wshU1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"surface_forcing_kwargs = {\n    \"grid\": grid,\n    \"start_time\": start_time,\n    \"end_time\": end_time,\n    \"type\": \"physics\",\n    \"model_reference_date\": datetime(2000, 1, 1), # this is the default\n}","key":"Mz3kVpzfRD"},{"type":"outputs","id":"vFAYtOKHLZWbJeX_Hyz3r","children":[],"key":"HZJFyJdGEl"}],"key":"EGBIFtw9KH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"surface_forcing_kwargs1 = {\n    \"grid\": grid,\n    \"start_time\": start_time1,\n    \"end_time\": end_time1,\n    \"type\": \"physics\",\n    \"model_reference_date\": datetime(2000, 1, 1), # this is the default\n}","key":"woE3S5nuBL"},{"type":"outputs","id":"mUOXh3-goMbPLsq8BHohY","children":[],"key":"tMIfkkCXQF"}],"key":"otOvfugiVv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nsurface_forcing = SurfaceForcing(\n    **surface_forcing_kwargs,\n    source={\"name\": \"ERA5\"},\n    use_dask=True,\n)","key":"oXMvW86Rqe"},{"type":"outputs","id":"mE9M406h7mVbRiiwHOfJ9","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:00:16 - INFO - No path specified for ERA5 source; defaulting to ARCO ERA5 dataset on Google Cloud.\n2025-11-20 13:02:02 - INFO - Data will be interpolated onto the grid coarsened by factor 2. Remember to set `interp_frc = 1` in your `bulk_frc.opt` ROMS option file.\n"},"children":[],"key":"fDzuUS9tt0"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 4min 40s, sys: 8.72 s, total: 4min 48s\nWall time: 2min 46s\n"},"children":[],"key":"nUFCYLLXM4"}],"key":"oWknQAU7Rk"}],"key":"jNim18Kqxs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nsurface_forcing1 = SurfaceForcing(\n    **surface_forcing_kwargs1,\n    source={\"name\": \"ERA5\"},\n    use_dask=True,\n)","key":"y7CrJ2eYj1"},{"type":"outputs","id":"_IBIvOT0zrcIgeCmuTKij","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:03:02 - INFO - No path specified for ERA5 source; defaulting to ARCO ERA5 dataset on Google Cloud.\n2025-11-20 13:04:54 - INFO - Data will be interpolated onto the grid coarsened by factor 2. Remember to set `interp_frc = 1` in your `bulk_frc.opt` ROMS option file.\n"},"children":[],"key":"My3mQBt0N4"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 3min 12s, sys: 7.63 s, total: 3min 20s\nWall time: 2min 55s\n"},"children":[],"key":"B5VBedswXL"}],"key":"XEV98DsDYR"}],"key":"ZS8dTurYQP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"surface_forcing.plot(\"uwnd\", time=0)","key":"vPS52P5bJw"},{"type":"outputs","id":"D6On_C11CY0b4d44GZ9dw","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 404.59 ms\n"},"children":[],"key":"oxPHil8SJZ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"025e12a8a74008ff9b28c342188dc190","path":"/025e12a8a74008ff9b28c342188dc190.png"},"text/plain":{"content":"<Figure size 1300x700 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"A6zfgIQLb5"}],"key":"aOQrVZfhE5"}],"key":"NNHS77Zpdh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#cesm_bgc_path = \"/global/cfs/projectdirs/m4746/Datasets/CESM_REGRIDDED/CESM-surface_lowres_regridded.nc\"\nunified_bgc_path = datasets+\"UNIFIED/BGCdataset.nc\"","key":"DNg08Nxwdu"},{"type":"outputs","id":"AcXzJqtv2hQf7BlfBQuuO","children":[],"key":"IZQeBlTM57"}],"key":"RkxO99LqMp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nunified_bgc_surface_forcing = SurfaceForcing(\n    grid=grid,\n    start_time=start_time,\n    end_time=end_time,\n    source={\"name\": \"UNIFIED\", \"path\": unified_bgc_path, \"climatology\": True},\n    type=\"bgc\",\n    use_dask=True,\n)","key":"fN8CvZqG6T"},{"type":"outputs","id":"HbysTvfGsROuaOamq4mnX","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:06:02 - INFO - Data will be interpolated onto the grid coarsened by factor 2. Remember to set `interp_frc = 1` in your `bgc.opt` ROMS option file.\n"},"children":[],"key":"pMb9nOAERh"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 138 ms, sys: 10.9 ms, total: 149 ms\nWall time: 500 ms\n"},"children":[],"key":"qTj2dQF2Cy"}],"key":"YYWRfAIUYc"}],"key":"rUyrxPCIZ1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_surface_forcing2024.nc\"","key":"WWhHS9WaQU"},{"type":"outputs","id":"FiFoehknj_8uarhq5q4n4","children":[],"key":"EIFVrMmvtk"}],"key":"wCQWNQ1SkD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath1 = project+model_name+\"_surface_forcing2024.nc\"","key":"vjp7wdijzD"},{"type":"outputs","id":"wBAA6nXDn5GyQEvRl3Dk4","children":[],"key":"Wzt8UlCjN0"}],"key":"ruqABSB7EC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time surface_forcing.save(filepath)","key":"q1XMRLKRoR"},{"type":"outputs","id":"Xz-QOUo8OTKpIOQaUiBPf","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:06:04 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202401.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202402.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202403.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202404.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202405.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202406.nc\n"},"children":[],"key":"U42vbVVhMS"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 162.15 s\n[########################################] | 100% Completed | 145.96 s\n[########################################] | 100% Completed | 170.19 s\n[########################################] | 100% Completed | 192.96 s\n[########################################] | 100% Completed | 192.20 s\n[########################################] | 100% Completed | 517.91 ms\nCPU times: user 6h 3min 30s, sys: 2min 28s, total: 6h 5min 59s\nWall time: 15min 40s\n"},"children":[],"key":"ZseVpkIWQE"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202401.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202402.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202403.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202404.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202405.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202406.nc')]","content_type":"text/plain"}}},"children":[],"key":"Jy2QH0EpOa"}],"key":"wICXD3jxr7"}],"key":"H2GaAunvsT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time surface_forcing1.save(filepath1)","key":"mAQPChbENf"},{"type":"outputs","id":"1o_muwBmm7hamxGL5Siq0","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:21:45 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202406.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202407.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202408.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202409.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202410.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202411.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202412.nc\n"},"children":[],"key":"aAUtrHrh9u"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 195.17 s\n[########################################] | 100% Completed | 199.92 s\n[########################################] | 100% Completed | 214.15 s\n[########################################] | 100% Completed | 203.79 s\n[########################################] | 100% Completed | 160.58 s\n[########################################] | 100% Completed | 156.47 s\n[########################################] | 100% Completed | 408.13 ms\nCPU times: user 7h 39min 27s, sys: 3min 3s, total: 7h 42min 31s\nWall time: 20min 21s\n"},"children":[],"key":"wM2ksDZwBu"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202406.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202407.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202408.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202409.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202410.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202411.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_surface_forcing2024_202412.nc')]","content_type":"text/plain"}}},"children":[],"key":"r30JwVb4yC"}],"key":"gcx4wLgTaE"}],"key":"sfghRYNPhi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_bgc_surface_forcing.nc\"","key":"TbPi0pMSne"},{"type":"outputs","id":"zgqg1BR30tOAA1IWGpLZ8","children":[],"key":"AiW8i90Qwy"}],"key":"RTlwXVNNvh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time unified_bgc_surface_forcing.save(filepath)","key":"e03p016SXl"},{"type":"outputs","id":"czpQDQLaGEVNeXtveb2_r","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:42:04 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_bgc_surface_forcing_clim.nc\n"},"children":[],"key":"ILlorggCTS"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 302.94 ms\nCPU times: user 211 ms, sys: 11.9 ms, total: 223 ms\nWall time: 840 ms\n"},"children":[],"key":"CUD3wECBcp"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_bgc_surface_forcing_clim.nc')]","content_type":"text/plain"}}},"children":[],"key":"paam0elWbD"}],"key":"sKubSsvJNm"}],"key":"AuC5HrxeTt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next we generate the initial file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e9auXDIAd8"}],"key":"eWtH1Dx1aD"}],"key":"XtDzm1Llag"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, InitialConditions","key":"zUkT5FeJe3"},{"type":"outputs","id":"AhVAEF2W1CVe9xNeLHmOM","children":[],"key":"QYSBFMfohl"}],"key":"sV3owKaSvW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime","key":"gLPViM4OdA"},{"type":"outputs","id":"5L5KheyQvEjje8YOP6cVi","children":[],"key":"MtDOE5qajX"}],"key":"qidxcUEIS9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ini_time = datetime(2024, 1, 5)","key":"V3LoqxfFt6"},{"type":"outputs","id":"kpRexzbQdz3eHzKphy325","children":[],"key":"ayjy3JCKg6"}],"key":"SGWvvrAET7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"path = datasets+\"GLORYS/ICELAND_DOMAIN/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-05_no_depth_zos.nc\"","key":"V3QbLZZsFQ"},{"type":"outputs","id":"jzd1vomOAfJtQpfcuhahH","children":[],"key":"fdv2xjmh2B"}],"key":"D7fm1uo6uv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\ninitial_conditions_with_unified_bgc = InitialConditions(\n    grid=grid,\n    ini_time=ini_time,\n    source={\"name\": \"GLORYS\", \"path\": path},\n    bgc_source={\n        \"name\": \"UNIFIED\",\n        \"path\": unified_bgc_path,\n        \"climatology\": True,\n    },  # bgc_source is optional\n    model_reference_date=datetime(2000, 1, 1), # this is the default\n    use_dask=True,\n)","key":"jqVs9sufLV"},{"type":"outputs","id":"fqJ4gEgRi1qQ-EHBJffND","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:42:05 - INFO - Sea surface height will NOT be used to adjust depth coordinates.\n"},"children":[],"key":"cIxM09sshM"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 1min 20s, sys: 31.7 s, total: 1min 52s\nWall time: 10.9 s\n"},"children":[],"key":"vr1jfQXWuf"}],"key":"VMDIsKdvS8"}],"key":"fQleQGa70k"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_initial_conditions_60m.nc\"","key":"x1ZOnzVqW4"},{"type":"outputs","id":"PtNfgNq4PsJ9hUFem4EW5","children":[],"key":"FngtiQyr1r"}],"key":"bHHyoErWqE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time initial_conditions_with_unified_bgc.save(filepath)","key":"vBLRZRHScQ"},{"type":"outputs","id":"RcR2ZLfJaYKhkhC_vM0lN","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:42:16 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_initial_conditions_60m.nc\n"},"children":[],"key":"JPjLuUSnMA"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 131.41 s\nCPU times: user 25min 33s, sys: 5min 44s, total: 31min 17s\nWall time: 2min 13s\n"},"children":[],"key":"weS9s8CGVt"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":40,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_initial_conditions_60m.nc')]","content_type":"text/plain"}}},"children":[],"key":"FFKRSbjuyK"}],"key":"it4lWcKktd"}],"key":"LW8F2A3yp1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"glorys_path = [\n    datasets+\"/GLORYS/ICELAND_DOMAIN/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-*_no_depth_zos.nc\"]","key":"d1VfgWZmmm"},{"type":"outputs","id":"vVgNMlWtVpCpwSkthUffL","children":[],"key":"JehqsmmtDF"}],"key":"tRwRFwXdLf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#glorys_path = [\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-04_no_depth_zos.nc\",  # include data from day before start time\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-05_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-06_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-07_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-08_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-09_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-10_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-11_no_depth_zos.nc\",  # include data from day after end time\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-12_no_depth_zos.nc\", \n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-13_no_depth_zos.nc\", \n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-14_no_depth_zos.nc\",  # include data from day before start time\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-15_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-16_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-17_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-18_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-19_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-20_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-21_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-22_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-23_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-24_no_depth_zos.nc\",  # include data from day before start time\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-25_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-26_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-27_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-28_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-29_no_depth_zos.nc\",\n#    \"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-30_no_depth_zos.nc\",\n#    #\"/global/cfs/cdirs/m4632/uheede/GLORYS/2024/cmems_mod_glo_phy_myint_0.083deg_P1D-m_multi-vars_52.50W-2.67E_44.33N-74.42N_1.54-3992.48m_2024-01-31_no_depth_zos.nc\"\n#]","key":"ptnjwoSIGB"},{"type":"outputs","id":"bgQTk6M9pTTtcrPenPV1S","children":[],"key":"Y0T8qe1ecv"}],"key":"s8Mgawqdud"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, BoundaryForcing","key":"CCz4lERYsD"},{"type":"outputs","id":"3w8kcOeVKco9SSiqAfqqu","children":[],"key":"Yqi0TwVcDr"}],"key":"txmoVlwlFg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start_time = datetime(2024, 1, 1)\nend_time = datetime(2024, 6, 30)","key":"nOhT04knDV"},{"type":"outputs","id":"ECZGIPxIqzPNnG8K88zyT","children":[],"key":"I80keJZzZA"}],"key":"Z1XEbbKGIN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start_time1 = datetime(2024, 6, 1)\nend_time1 = datetime(2024, 12, 30)","key":"V6kruBfP3K"},{"type":"outputs","id":"i_TV5LRUJBtI-R3kz7eJY","children":[],"key":"fAQqNuuI1l"}],"key":"CV2swRtReP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nboundary_forcing = BoundaryForcing(\n    grid=grid,\n    start_time=start_time,\n    end_time=end_time,\n    boundaries={\n        \"south\": True,\n        \"east\": True,\n        \"north\": True,  \n        \"west\": True,\n    },\n    source={\"name\": \"GLORYS\", \"path\": glorys_path},\n    type=\"physics\",  # \"physics\" or \"bgc\"; default is \"physics\"\n    model_reference_date=datetime(2000, 1, 1), # this is the default\n    use_dask=True,\n)","key":"esRZGXtiar"},{"type":"outputs","id":"q9ITbO66Y98TFTyntL5WE","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:44:29 - INFO - Sea surface height will NOT be used to adjust depth coordinates.\n"},"children":[],"key":"VZxBMVXCP1"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 9.49 s, sys: 2.57 s, total: 12.1 s\nWall time: 4min 50s\n"},"children":[],"key":"gVkOzor2uE"}],"key":"IzjybkZQCq"}],"key":"hQHrb5GIh5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nboundary_forcing1 = BoundaryForcing(\n    grid=grid,\n    start_time=start_time1,\n    end_time=end_time1,\n    boundaries={\n        \"south\": True,\n        \"east\": True,\n        \"north\": True,  \n        \"west\": True,\n    },\n    source={\"name\": \"GLORYS\", \"path\": glorys_path},\n    type=\"physics\",  # \"physics\" or \"bgc\"; default is \"physics\"\n    model_reference_date=datetime(2000, 1, 1), # this is the default\n    use_dask=True,\n)","key":"iY2uhvWsfI"},{"type":"outputs","id":"vQ_6UMMrngpFXCJMDbZkC","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:49:20 - INFO - Sea surface height will NOT be used to adjust depth coordinates.\n2025-11-20 13:54:39 - WARNING - No records found at or after the end_time: 2024-12-30 00:00:00.\n"},"children":[],"key":"f9R7TV6LgE"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 12 s, sys: 2.63 s, total: 14.6 s\nWall time: 5min 25s\n"},"children":[],"key":"EcvsTW2owC"}],"key":"g2MM81xeUx"}],"key":"jWMXBM3zGY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nunified_bgc_boundary_forcing = BoundaryForcing(\n    grid=grid,\n    start_time=start_time,\n    end_time=end_time,\n    boundaries={\n        \"south\": True,\n        \"east\": True,\n        \"north\": True,  \n        \"west\": True,\n    },\n    source={\"name\": \"UNIFIED\", \"path\": unified_bgc_path, \"climatology\": True},\n    type=\"bgc\",\n    use_dask=True,\n)","key":"NhW9AEli9o"},{"type":"outputs","id":"7nHG_WsqzxtOMhY0Ns8NQ","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:54:46 - INFO - Sea surface height will NOT be used to adjust depth coordinates.\n"},"children":[],"key":"NonAHYNOQY"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 5.44 s, sys: 69.7 ms, total: 5.51 s\nWall time: 6.4 s\n"},"children":[],"key":"rcyeUdBEmk"}],"key":"fDrplu7H2L"}],"key":"p2Cld2s9nh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_bgc_boundary_forcing_2024.nc\"\n%time unified_bgc_boundary_forcing.save(filepath)\n","key":"gMIP0XeI3V"},{"type":"outputs","id":"swPL52vhQ6dQGGEoObid6","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:54:52 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_bgc_boundary_forcing_2024_clim.nc\n"},"children":[],"key":"zslSOVTR7A"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 98.60 s\nCPU times: user 1min 4s, sys: 13.9 s, total: 1min 18s\nWall time: 1min 40s\n"},"children":[],"key":"cgGu9xneSq"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":49,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_bgc_boundary_forcing_2024_clim.nc')]","content_type":"text/plain"}}},"children":[],"key":"dFjvvayoFe"}],"key":"HjB0dJz9Ol"}],"key":"JZlPuk1kI9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_boundary_forcing_2024.nc\"\n%time boundary_forcing.save(filepath, group=True)","key":"MQvOUSkojO"},{"type":"outputs","id":"clIablZjRRxfslJAuejt1","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 13:56:33 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202401.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202402.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202403.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202404.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202405.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202406.nc\n"},"children":[],"key":"Wld0LDJPvZ"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 48.10 s\n[########################################] | 100% Completed | 37.60 s\n[########################################] | 100% Completed | 37.16 s\n[########################################] | 100% Completed | 16.34 s\n[########################################] | 100% Completed | 20.15 s\n[########################################] | 100% Completed | 39.81 s\nCPU times: user 1min 57s, sys: 16.3 s, total: 2min 13s\nWall time: 3min 28s\n"},"children":[],"key":"GjYeJEtpHh"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":50,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202401.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202402.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202403.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202404.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202405.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202406.nc')]","content_type":"text/plain"}}},"children":[],"key":"GPWtJU8Kxn"}],"key":"TfckAbWuKO"}],"key":"zR8L8G5T5r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+model_name+\"_boundary_forcing_2024.nc\"\n%time boundary_forcing1.save(filepath, group=True)","key":"RYaFSCXzhT"},{"type":"outputs","id":"euGVL0X37AkgF82NFIYtc","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-20 14:00:01 - INFO - Writing the following NetCDF files:\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202406.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202407.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202408.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202409.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202410.nc\n/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202411.nc\n"},"children":[],"key":"R32QjqtijM"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[########################################] | 100% Completed | 7.96 ss\n[########################################] | 100% Completed | 40.85 s\n[########################################] | 100% Completed | 37.37 s\n[########################################] | 100% Completed | 37.26 s\n[########################################] | 100% Completed | 40.04 s\n[########################################] | 100% Completed | 41.67 s\nCPU times: user 2min 2s, sys: 15.8 s, total: 2min 18s\nWall time: 3min 33s\n"},"children":[],"key":"XWDaGRhRYS"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":51,"metadata":{},"data":{"text/plain":{"content":"[PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202406.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202407.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202408.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202409.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202410.nc'),\n PosixPath('/anvil/projects/x-ees250129/x-uheede/INPUT_files/Iceland0_MARBL_2024/Iceland0_boundary_forcing_2024_202411.nc')]","content_type":"text/plain"}}},"children":[],"key":"IINNltp8Ov"}],"key":"L62auDw1eZ"}],"key":"s3hn0M2t5K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"VLZZlWeUMt"},{"type":"outputs","id":"RFFBY5lyZHKjlfwuVrO2_","children":[],"key":"ZkWQsi2PyC"}],"key":"Jdy1zKDzxU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, ChildGrid","key":"KTYQtcLaz7"},{"type":"outputs","id":"eqlRlbQ_ttoHRxeltmsAt","children":[],"key":"HRnINm8hn6"}],"key":"F442Ua3XL9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"parent_grid = grid","key":"wyyLjZ8WlW"},{"type":"outputs","id":"bAknydqs-o8xgu_Wft9co","children":[],"key":"OTHx5njEx1"}],"key":"XfmXow1iyA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"child_grid_parameters = {\n    \"nx\": 512,\n    \"ny\": 512,\n    \"size_x\": 384,\n    \"size_y\": 384,\n    \"center_lon\": -24,\n    \"center_lat\": 64.9,\n    \"rot\": 0,\n    \"topography_source\": {\n        \"name\": \"SRTM15\",\n        \"path\": datasets+\"SRTM15/SRTM15_V2.6.nc\"},\n    \"N\":60  # number of vertical layers\n}","key":"QUNT0rXtu3"},{"type":"outputs","id":"bRLWVPJrC1RAgG3gcFPVY","children":[],"key":"QDRa4JMieY"}],"key":"R6egjaqbHa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"child_grid = ChildGrid(\n    **child_grid_parameters,\n    parent_grid=parent_grid,\n    boundaries={\n        \"south\": True,\n        \"east\": True,\n        \"north\": True,\n        \"west\": True,\n    },  # this is the default\n    metadata={\"prefix\": \"child\", \"period\": 1800.0}  # this is the default\n)","key":"BHtJZKuFx1"},{"type":"outputs","id":"N31u4i6ug9eIdgTBpRbzp","children":[{"type":"output","jupyter_data":{"ename":"KeyboardInterrupt","evalue":"","output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyboardInterrupt\u001b[39m                         Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[55]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m child_grid = \u001b[43mChildGrid\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m      2\u001b[39m \u001b[43m    \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mchild_grid_parameters\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m      3\u001b[39m \u001b[43m    \u001b[49m\u001b[43mparent_grid\u001b[49m\u001b[43m=\u001b[49m\u001b[43mparent_grid\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m      4\u001b[39m \u001b[43m    \u001b[49m\u001b[43mboundaries\u001b[49m\u001b[43m=\u001b[49m\u001b[43m{\u001b[49m\n\u001b[32m      5\u001b[39m \u001b[43m        \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43msouth\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m      6\u001b[39m \u001b[43m        \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43meast\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m      7\u001b[39m \u001b[43m        \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mnorth\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m      8\u001b[39m \u001b[43m        \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mwest\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m      9\u001b[39m \u001b[43m    \u001b[49m\u001b[43m}\u001b[49m\u001b[43m,\u001b[49m\u001b[43m  \u001b[49m\u001b[38;5;66;43;03m# this is the default\u001b[39;49;00m\n\u001b[32m     10\u001b[39m \u001b[43m    \u001b[49m\u001b[43mmetadata\u001b[49m\u001b[43m=\u001b[49m\u001b[43m{\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mprefix\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mchild\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mperiod\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m1800.0\u001b[39;49m\u001b[43m}\u001b[49m\u001b[43m  \u001b[49m\u001b[38;5;66;43;03m# this is the default\u001b[39;49;00m\n\u001b[32m     11\u001b[39m \u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m<string>:20\u001b[39m, in \u001b[36m__init__\u001b[39m\u001b[34m(self, nx, ny, size_x, size_y, center_lon, center_lat, rot, N, theta_s, theta_b, hc, topography_source, hmin, verbose, parent_grid, boundaries, metadata)\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/roms-tools/roms_tools/setup/nesting.py:86\u001b[39m, in \u001b[36mChildGrid.__post_init__\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m     84\u001b[39m \u001b[38;5;28msuper\u001b[39m().__post_init__()\n\u001b[32m     85\u001b[39m \u001b[38;5;28mself\u001b[39m._map_child_boundaries_onto_parent_grid_indices(verbose=\u001b[38;5;28mself\u001b[39m.verbose)\n\u001b[32m---> \u001b[39m\u001b[32m86\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_modify_child_topography_and_mask\u001b[49m\u001b[43m(\u001b[49m\u001b[43mverbose\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mverbose\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/roms-tools/roms_tools/setup/nesting.py:117\u001b[39m, in \u001b[36mChildGrid._modify_child_topography_and_mask\u001b[39m\u001b[34m(self, verbose)\u001b[39m\n\u001b[32m    114\u001b[39m \u001b[38;5;28;01mwith\u001b[39;00m Timed(\u001b[33m\"\u001b[39m\u001b[33m=== Modifying child topography and mask ===\u001b[39m\u001b[33m\"\u001b[39m, verbose=verbose):\n\u001b[32m    115\u001b[39m     \u001b[38;5;66;03m# Prepare parent and child grid datasets by adjusting longitudes for dateline crossing\u001b[39;00m\n\u001b[32m    116\u001b[39m     parent_grid_ds, child_grid_ds = \u001b[38;5;28mself\u001b[39m._prepare_grid_datasets()\n\u001b[32m--> \u001b[39m\u001b[32m117\u001b[39m     child_grid_ds = \u001b[43mmodify_child_topography_and_mask\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    118\u001b[39m \u001b[43m        \u001b[49m\u001b[43mparent_grid_ds\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mchild_grid_ds\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mboundaries\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mhmin\u001b[49m\n\u001b[32m    119\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    121\u001b[39m     \u001b[38;5;66;03m# Finalize grid datasets by adjusting longitudes back to [0, 360] range\u001b[39;00m\n\u001b[32m    122\u001b[39m     parent_grid_ds, child_grid_ds = \u001b[38;5;28mself\u001b[39m._finalize_grid_datasets(\n\u001b[32m    123\u001b[39m         parent_grid_ds, child_grid_ds\n\u001b[32m    124\u001b[39m     )\n\n\u001b[36mFile \u001b[39m\u001b[32m~/roms-tools/roms_tools/setup/nesting.py:653\u001b[39m, in \u001b[36mmodify_child_topography_and_mask\u001b[39m\u001b[34m(parent_grid_ds, child_grid_ds, boundaries, hmin)\u001b[39m\n\u001b[32m    650\u001b[39m xi = (child_grid_ds.lon_rho.values, child_grid_ds.lat_rho.values)\n\u001b[32m    652\u001b[39m values = parent_grid_ds[\u001b[33m\"\u001b[39m\u001b[33mh\u001b[39m\u001b[33m\"\u001b[39m].values.ravel()\n\u001b[32m--> \u001b[39m\u001b[32m653\u001b[39m h_parent_interpolated = \u001b[43mgriddata\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpoints\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mvalues\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mxi\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m=\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mlinear\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\n\u001b[32m    654\u001b[39m h_parent_interpolated = xr.DataArray(\n\u001b[32m    655\u001b[39m     h_parent_interpolated, dims=(\u001b[33m\"\u001b[39m\u001b[33meta_rho\u001b[39m\u001b[33m\"\u001b[39m, \u001b[33m\"\u001b[39m\u001b[33mxi_rho\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m    656\u001b[39m )\n\u001b[32m    658\u001b[39m values = parent_grid_ds[\u001b[33m\"\u001b[39m\u001b[33mmask_rho\u001b[39m\u001b[33m\"\u001b[39m].values.ravel()\n\n\u001b[36mFile \u001b[39m\u001b[32m~/.conda/envs/2024.02-py311/romstools-test/lib/python3.13/site-packages/scipy/interpolate/_ndgriddata.py:321\u001b[39m, in \u001b[36mgriddata\u001b[39m\u001b[34m(points, values, xi, method, fill_value, rescale)\u001b[39m\n\u001b[32m    318\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m method == \u001b[33m'\u001b[39m\u001b[33mlinear\u001b[39m\u001b[33m'\u001b[39m:\n\u001b[32m    319\u001b[39m     ip = LinearNDInterpolator(points, values, fill_value=fill_value,\n\u001b[32m    320\u001b[39m                               rescale=rescale)\n\u001b[32m--> \u001b[39m\u001b[32m321\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mip\u001b[49m\u001b[43m(\u001b[49m\u001b[43mxi\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    322\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m method == \u001b[33m'\u001b[39m\u001b[33mcubic\u001b[39m\u001b[33m'\u001b[39m \u001b[38;5;129;01mand\u001b[39;00m ndim == \u001b[32m2\u001b[39m:\n\u001b[32m    323\u001b[39m     ip = CloughTocher2DInterpolator(points, values, fill_value=fill_value,\n\u001b[32m    324\u001b[39m                                     rescale=rescale)\n\n\u001b[31mKeyboardInterrupt\u001b[39m: "},"children":[],"key":"N0o0jdlAg7"}],"key":"dghSeZUjlW"}],"key":"T7zIJAGgtI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"child_grid.plot_nesting(with_dim_names=True)","key":"g51O184j6K"},{"type":"outputs","id":"UKCBWbQkxak2zso2l9mgi","children":[],"key":"O7T3NLY4IB"}],"key":"X7Gz7tkr5l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath = project+child_name+\"_grid.nc\"\nchild_grid.save(filepath=filepath)","key":"Ey3t048k3q"},{"type":"outputs","id":"IywuGfg3kzzFQsVPJkaYs","children":[],"key":"VIsroMUUgL"}],"key":"Nur8zUjOxa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filepath_nesting = project+child_name+\"_edata.nc\"","key":"FgWrO5vhff"},{"type":"outputs","id":"7_JnNutNCCJMmXX7sDN_s","children":[],"key":"jbvB8iW5OL"}],"key":"ndn0dIPyzK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"child_grid.save_nesting(filepath=filepath_nesting)","key":"CDjig3ZJQC"},{"type":"outputs","id":"WQTGqIEdmdRt4KsKXDkgN","children":[],"key":"XIKHLn8UbR"}],"key":"HLpCgeXPh1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import partition_netcdf","key":"MUySdtDdza"},{"type":"outputs","id":"TtNRWiVYGnt_cwk-obMb5","children":[],"key":"m5wkFAaixh"}],"key":"y81u1oeGbW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time partition_netcdf(project+model_name+'_grid.nc', np_eta=16, np_xi=16, output_dir='/home/x-uheede/S/Iceland0_MARBL_2024/P_INPUT')","key":"toOc69vGKj"},{"type":"outputs","id":"aGSoXf_co8fKHHrsUw5qx","children":[],"key":"qJqGE1O6zl"}],"key":"gfsr6LIDdx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%time partition_netcdf(project+model_name+'_tides.nc', np_eta=16, np_xi=16, output_dir='/home/x-uheede/S/Iceland0_MARBL_2024/P_INPUT')","key":"X3yPeXzJ7V"},{"type":"outputs","id":"XzJXpT4VwVIYty6dhAH6P","children":[],"key":"Yz5NalpCYG"}],"key":"R5yRh9y7rw"}],"key":"IC34OD9VhC"},"references":{"cite":{"order":[],"data":{}}}}