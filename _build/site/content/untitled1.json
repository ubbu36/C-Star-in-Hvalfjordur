{"version":3,"kind":"Notebook","sha256":"d83c9c4fbf7b3519f73d300027cbabbf27f9a03f38e007d8a5b33862ac882e01","slug":"untitled1","location":"/Untitled1.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"roms_tools","display_name":"Python (My roms_tools Kernel)","language":"python"},"exports":[{"format":"ipynb","filename":"Untitled1.ipynb","url":"/Untitled1-6d3ef74f3fa6abacea5aea0f2d845e63.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr","key":"zBYAfRdGTB"},{"type":"outputs","id":"4RKdIeGgZUfI4wqKezEFd","children":[],"key":"SSxUsbQioy"}],"key":"m2FFh6bByh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid0=xr.open_dataset('/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_s2r_phys+bgc/1.Make_grid/Iceland0_grid_MAT.nc')\ngrid1=xr.open_dataset('/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_r2r_phys+bgc/1.Make_grid/Iceland1_grid_MAT1.nc')\ngrid2=xr.open_dataset('/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_r2r_phys+bgc/1.Make_grid/Iceland2_grid_MAT1.nc')\ngrid3=xr.open_dataset('/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_r2r_phys+bgc/1.Make_grid/Iceland3_grid_MAT.nc')\n","key":"yOqS0imAy9"},{"type":"outputs","id":"XXtJUX9hqCOGtfasJJnrb","children":[],"key":"OiXDvwY6gI"}],"key":"K0mh81PTEK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid0.load()\ngrid1.load()\ngrid2.load()\ngrid3.load()","key":"OJMYffpiBl"},{"type":"outputs","id":"qPRtt6rk6SRYdeDI6Lqm7","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"1b923d4e23080e56d470ebd33ad13655","path":"/1b923d4e23080e56d470ebd33ad13655.html"},"text/plain":{"content":"<xarray.Dataset> Size: 18MB\nDimensions:    (one: 1, eta_rho: 386, xi_rho: 642)\nDimensions without coordinates: one, eta_rho, xi_rho\nData variables: (12/14)\n    spherical  (one) |S1 1B b'T'\n    angle      (eta_rho, xi_rho) float64 2MB 0.005199 0.005199 ... -0.005232\n    h          (eta_rho, xi_rho) float64 2MB 35.92 35.93 35.95 ... 5.0 5.0 5.0\n    hraw       (eta_rho, xi_rho) float64 2MB 35.92 35.99 35.99 ... -0.2 -0.2\n    f          (eta_rho, xi_rho) float64 2MB 0.000131 0.000131 ... 0.0001312\n    pm         (eta_rho, xi_rho) float64 2MB 0.02 0.02 0.02 ... 0.02 0.02 0.02\n    ...         ...\n    lat_rho    (eta_rho, xi_rho) float64 2MB 64.24 64.24 64.24 ... 64.41 64.41\n    mask_rho   (eta_rho, xi_rho) float64 2MB 1.0 1.0 1.0 1.0 ... 0.0 0.0 0.0 0.0\n    tra_lon    (one) float64 8B -21.68\n    tra_lat    (one) float64 8B 64.33\n    rotate     (one) float64 8B 0.0\n    xy_flip    (one) float64 8B 9.969e+36\nAttributes:\n    Title:    ROMS grid by Easy Grid. Settings: nx: 640 ny: 384 xsize: 32 ysi...\n    Date:     09-Oct-2025\n    Type:     ROMS grid produced by Easy Grid","content_type":"text/plain"}}},"children":[],"key":"HrMzDYmB6Z"}],"key":"HJjaWcWRLd"}],"key":"Ee8UJpZev5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport matplotlib.pyplot as plt\nimport cartopy.crs as ccrs\nimport cartopy.feature as cfeature\nimport numpy as np\n\n# === USER SETTINGS ===\n# Replace with your actual grid file paths\ngrid_files = [\n    \"/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_s2r_phys+bgc/1.Make_grid/Iceland0_grid_MAT.nc\",\n    \"/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_r2r_phys+bgc/1.Make_grid/Iceland1_grid_MAT1.nc\",\n    \"/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_r2r_phys+bgc/1.Make_grid/Iceland2_grid_MAT1.nc\",\n    \"/anvil/projects/x-ees250129/x-uheede/MATLAB/setup_r2r_phys+bgc/1.Make_grid/Iceland3_grid_MAT.nc\",\n]\n\n# === HELPER FUNCTION ===\ndef get_grid_outline(ds):\n    \"\"\"Extracts the outer boundary of a ROMS grid from lon/lat.\"\"\"\n    lon = ds.lon_rho.values\n    lat = ds.lat_rho.values\n\n    # Corners of the grid\n    left   = np.column_stack((lon[:, 0], lat[:, 0]))\n    right  = np.column_stack((lon[:, -1], lat[:, -1]))\n    bottom = np.column_stack((lon[0, :], lat[0, :]))\n    top    = np.column_stack((lon[-1, :], lat[-1, :]))\n\n    # Combine into a closed loop\n    boundary = np.vstack((bottom, right, top[::-1], left[::-1]))\n    return boundary\n\n# === PLOTTING ===\nfig = plt.figure(figsize=(10, 8))\nproj = ccrs.PlateCarree()\nax = plt.axes(projection=proj)\n\n# Add coastlines and features\n#ax.add_feature(cfeature.COASTLINE, linewidth=0.7)\n#ax.add_feature(cfeature.LAND, facecolor=\"lightgray\", zorder=0)\n#ax.gridlines(draw_labels=True, linewidth=0.3, color=\"gray\", alpha=0.5)\n\n# Define colors for each grid outline\ncolors = ['red', 'orange', 'green', 'blue']\n\n# Loop through grid files\n\nds = xr.open_dataset(grid_files[0])\nboundary = get_grid_outline(ds)\nax.plot(boundary[:, 0], boundary[:, 1], color=colors[i],\nlinewidth=2, label=f\"Grid {i+1}: {f}\")\n\n# Set extent automatically to fit all grids\n#all_lons = []\n#all_lats = []\n#for f in grid_files:\n#    ds = xr.open_dataset(f)\n#    all_lons.append(ds.lon_rho.values)\n#    all_lats.append(ds.lat_rho.values)\n\n#lon_min = np.min([np.min(lon) for lon in all_lons])\n#lon_max = np.max([np.max(lon) for lon in all_lons])\n#lat_min = np.min([np.min(lat) for lat in all_lats])\n#lat_max = np.max([np.max(lat) for lat in all_lats])\n#ax.set_extent([lon_min - 1, lon_max + 1, lat_min - 1, lat_max + 1])\n\n# Add legend\nax.legend(loc='lower left', fontsize=8)\n\nplt.title(\"Nested ROMS Grid Outlines\", fontsize=12)\nplt.tight_layout()\nplt.show()\n","key":"q6uuv6fsWT"},{"type":"outputs","id":"tLqJGfaiMAI2EHqnmHUyu","children":[{"type":"output","jupyter_data":{"ename":"NameError","evalue":"name 'i' is not defined","output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mNameError\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[4]\u001b[39m\u001b[32m, line 49\u001b[39m\n\u001b[32m     47\u001b[39m ds = xr.open_dataset(grid_files[\u001b[32m0\u001b[39m])\n\u001b[32m     48\u001b[39m boundary = get_grid_outline(ds)\n\u001b[32m---> \u001b[39m\u001b[32m49\u001b[39m ax.plot(boundary[:, \u001b[32m0\u001b[39m], boundary[:, \u001b[32m1\u001b[39m], color=colors[\u001b[43mi\u001b[49m],\n\u001b[32m     50\u001b[39m linewidth=\u001b[32m2\u001b[39m, label=\u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mGrid \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mi+\u001b[32m1\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m: \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mf\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m\"\u001b[39m)\n\u001b[32m     52\u001b[39m \u001b[38;5;66;03m# Set extent automatically to fit all grids\u001b[39;00m\n\u001b[32m     53\u001b[39m \u001b[38;5;66;03m#all_lons = []\u001b[39;00m\n\u001b[32m     54\u001b[39m \u001b[38;5;66;03m#all_lats = []\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m     65\u001b[39m \n\u001b[32m     66\u001b[39m \u001b[38;5;66;03m# Add legend\u001b[39;00m\n\u001b[32m     67\u001b[39m ax.legend(loc=\u001b[33m'\u001b[39m\u001b[33mlower left\u001b[39m\u001b[33m'\u001b[39m, fontsize=\u001b[32m8\u001b[39m)\n\n\u001b[31mNameError\u001b[39m: name 'i' is not defined"},"children":[],"key":"rk1OwgBUnC"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bd4b59cd3a6450c888d76e53e6d305c7","path":"/bd4b59cd3a6450c888d76e53e6d305c7.png"},"text/plain":{"content":"<Figure size 1000x800 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"dfUEkY8sIS"}],"key":"I5gsxFiuun"}],"key":"D8weGVeu0H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds0 = xr.open_dataset(grid_files[0])\nboundary0 = get_grid_outline(ds0)\n\nds1 = xr.open_dataset(grid_files[1])\nboundary1 = get_grid_outline(ds1)\n\nds2 = xr.open_dataset(grid_files[2])\nboundary2 = get_grid_outline(ds2)\n\nds3 = xr.open_dataset(grid_files[3])\nboundary3 = get_grid_outline(ds3)","key":"qUhlftSkK6"},{"type":"outputs","id":"k330en7c7gvTlPDgqU7R2","children":[],"key":"Wk3Lix9sEJ"}],"key":"k4i0HoUcX3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport cartopy.crs as ccrs\nimport cartopy.feature as cfeature\n\n# Example: boundary is an Nx2 array (lon, lat)\n# boundary = np.array([[lon1, lat1], [lon2, lat2], ...])\n\n# Create a Cartopy map with a PlateCarree projection (suitable for lon/lat)\nfig = plt.figure(figsize=(8, 6))\nax = plt.axes(projection=ccrs.Mercator())\n\n# Add coastlines and features for context\nax.coastlines()\nax.add_feature(cfeature.BORDERS, linestyle=':')\nax.add_feature(cfeature.LAND, facecolor='lightgray')\n\n# Plot the boundary line\nax.plot(boundary0[:, 0], boundary0[:, 1], '-y', transform=ccrs.PlateCarree(), label='Iceland0, 2.5 km resolution')\nax.plot(boundary1[:, 0], boundary1[:, 1], '-g', transform=ccrs.PlateCarree(), label='Iceland1, 750 m resolution')\nax.plot(boundary2[:, 0], boundary2[:, 1], '-b', transform=ccrs.PlateCarree(), label='Iceland2, 200 m resolution')\nax.plot(boundary3[:, 0], boundary3[:, 1], '-r', transform=ccrs.PlateCarree(), label='Iceland3, 50 m resolution')\n\n# Optionally set map extent to fit your data\nax.set_extent([boundary0[:,0].min()-1, boundary0[:,0].max()+1,\n               boundary0[:,1].min()-1, boundary0[:,1].max()+1],\n              crs=ccrs.PlateCarree())\n\nax.legend(loc='lower right')\nplt.title(\"Nested grids overview\")\nplt.show()\n","key":"md2HygK4tR"},{"type":"outputs","id":"lvScB6p-bXC4zT6iZU_2q","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e9bb419fd612877c15b0bcc0ac79848b","path":"/e9bb419fd612877c15b0bcc0ac79848b.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"QW6O4vlRwj"}],"key":"oxhuksIFOE"}],"key":"vqLWPFAGk9"}],"key":"dfiY8Rqm9g"},"references":{"cite":{"order":[],"data":{}}}}