{"version":3,"kind":"Notebook","sha256":"0208893d1a05864786ae9d614887678eef31811685348b6ea1abb2052d2ec7a9","slug":"velocity-analysis-200m-copy1","location":"/velocity_analysis-200m-Copy1.ipynb","dependencies":[],"frontmatter":{"title":"Velocity model-obs(ADCP) comparison","content_includes_title":true,"kernelspec":{"name":"roms-tools","display_name":"Python (My roms-tools Kernel)","language":"python"},"exports":[{"format":"ipynb","filename":"velocity_analysis-200m-Copy1.ipynb","url":"/velocity_analysis-20-228c079b7ffac8e73591005f67d4a392.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[],"key":"SNORTAEmxm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Velocity model-obs(ADCP) comparison","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"adj3yRbHDA"}],"identifier":"velocity-model-obs-adcp-comparison","label":"Velocity model-obs(ADCP) comparison","html_id":"velocity-model-obs-adcp-comparison","implicit":true,"key":"cLS2kNBCJ2"}],"key":"BeAbxfpCs1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\nimport pandas as pd\nimport netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \nimport dask\nfrom scipy.interpolate import griddata\n#from ocean_c_lab_tools import *\n#from celluloid import Camera \n#import PyCO2SYS as csys\nimport seawater as sw\nfrom roms_regrid import *","key":"CWn4PNjncs"},{"type":"outputs","id":"JDDnlTRqYwfmN34yM5KSg","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1679176/3005166470.py:17: UserWarning: The seawater library is deprecated! Please use gsw instead.\n  import seawater as sw\n"},"children":[],"key":"DUqv8TtPka"}],"key":"Ky9rO98KYU"}],"key":"iel3TGSBwh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"HAFRO_path='/home/x-uheede/R/HAFRO/Hafro_cruises.xls'\nmodel_grid_path=\"/home/x-uheede/S/Iceland2_MARBL_2024_60m/P_INPUT/Iceland2_grid_MAT1.nc\"\n# Grid parameters, only modify these if grid is made in MATLAB\nvert_levels=60\ntheta_s_model=5\ntheta_b_model=2\nhc_model=300\nmodel_data_path=\"/home/x-uheede/S/Iceland2_NOMARBL_2024_NewV/Iceland2_MARBL_2024_his.20240[4]????????.nc\"\nmonths_analysis=[4] # enter the months you want to analyze for the model\n# enter the dates you want to analyze for the observations\ntarget_depth_levels=[10] # Specify depth levels of interest\nthinner=1 # specify the temporal frequency of data being read (i.e. no need to read in hourly data)\n","key":"oRGPAYkup1"},{"type":"outputs","id":"gJToDmqDnt3g-WCfcKpSe","children":[],"key":"I4HT3Qhfu0"}],"key":"dHolo4ttw3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, ROMSOutput\ngrid = Grid.from_file(\n    model_grid_path\n)\n","key":"th71WVGfck"},{"type":"outputs","id":"d33L-mawTBgDvep435HtA","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-12-09 13:45:13 - WARNING - Vertical coordinates (Cs_r, Cs_w) not found in grid file.\n2025-12-09 13:45:13 - INFO - === Preparing the vertical coordinate system using N = 100, theta_s = 5.0, theta_b = 2.0, hc = 300.0 ===\n2025-12-09 13:45:13 - INFO - Total time: 0.003 seconds\n2025-12-09 13:45:13 - INFO - ========================================================================================================\n"},"children":[],"key":"MbqtLkdM9T"}],"key":"zEdIkjkAJW"}],"key":"DpWuzTNjbt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Only run this cell if grid is made in MATLAB\ngrid.update_vertical_coordinate(N=vert_levels, theta_s=theta_s_model, theta_b=theta_b_model, hc=hc_model, verbose=False)","key":"tIt44UMdrc"},{"type":"outputs","id":"Pyz-EPCzSCFM3FgBqlwTO","children":[],"key":"LlMVQay73r"}],"key":"raVpCbMjqH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\n# Define file paths and station names\nstations = [\"HVIN_1\", \"HVNA_1\", \"HVNV_1\", \"HVSA_1\", \"HVSV_1\"]\nfile_paths = {name: f\"/home/x-uheede/R/HAFRO/{name}new.nc\" for name in stations}\n\n# Dictionary to store datasets\ndatasets = {}\n\nfor name, path in file_paths.items():\n    ds = xr.open_dataset(path)\n\n    # Select valid depth bins\n    good_bins = ds['iigood'].where(ds['iigood'] < 20).to_numpy()\n    good_bins_nn = good_bins[~np.isnan(good_bins)].astype(int)\n    \n    ds = ds.isel(depth_dim=slice(np.min(good_bins_nn), np.max(good_bins_nn)))\n\n    # Store dataset with adjusted longitude\n    datasets[name] = ds.assign_coords(lon=ds['lon'].load() + 360)\n\n","key":"NfcX9Wfz2w"},{"type":"outputs","id":"KEmJCfl6OO9bdOpOG3QsW","children":[],"key":"FqAqPtLj5C"}],"key":"uoYOwsNh9r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\nsubtract = 739674 - 9189  # Computed constant\nreference_date = pd.to_datetime(\"2000-01-01\")  # Reference date\n\n# Apply transformation to all datasets\nfor name, ds in datasets.items():\n    datetime_series = reference_date + pd.to_timedelta((ds['time'].values - subtract), unit='D')\n    datasets[name] = ds.assign_coords(time_dim=datetime_series)  # Update the time coordinate\n","key":"tDMTtG6qYQ"},{"type":"outputs","id":"LqTLbcmvky06ZCDsfGhYU","children":[],"key":"O0JkB7zZdL"}],"key":"w4QB6lDJwE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, ROMSOutput","key":"kasup7dfNR"},{"type":"outputs","id":"d_edGD9S3H0bzdo1dM8fc","children":[],"key":"soA9b0uBeG"}],"key":"Xq5o82zHvF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport numpy as np\n\n# Load ROMS output using your pattern\nroms_output = ROMSOutput(\n    grid=grid,\n    path=[\n        model_data_path,\n    ],\n    use_dask=True,\n)\n\nds = roms_output.regrid(var_names=[\"u\", \"v\"],depth_levels=target_depth_levels)","key":"W6giFAx2rf"},{"type":"outputs","id":"gaLs-OEtkIEQAsWQP6mbV","children":[],"key":"GjROLt4J43"}],"key":"kJfKvkJo5B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_rg=ds['u'].load()\nv_rg=ds['v'].load()","key":"Kb9IriYYkK"},{"type":"outputs","id":"k0cNhJBmllO1nFw_rkDyA","children":[],"key":"dMVvoszsND"}],"key":"Ja6tcX1m5c"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport xarray as xr\nfrom windrose import WindroseAxes\n\n# Define the number of stations\nnum_stations = 5\n\n# Define the observation subset time range (2024)\nobs_time_range = slice('2024-05-01', '2024-05-31')\n\n# Define the model subset time range (2023)\nmodel_time_range = slice('2024-02-01', '2024-02-28')\n\n# Create figure for timeseries plots\nfig, axs = plt.subplots(\n    nrows=num_stations, ncols=2, figsize=(12, 3 * num_stations), sharex=False\n)\nfig.suptitle(\"Timeseries Comparison: Observations vs Model\", fontsize=14)\n\nfor i in range(num_stations):\n\n    # Subset observation data for 2024\n    obs = list(datasets.values())[i]\n    obs_subset = obs.sel(time_dim=obs_time_range)\n    depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n    u_obs = obs_subset['u'].isel(depth_dim=depth_index)[::6]\n    obs_lon = obs.lon\n    obs_lat = obs.lat\n\n    # Extract model data\n    u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    u_mod = u_sel.squeeze()\n\n    # ----------------------------\n    # Compute shared y-limits\n    # ----------------------------\n    ymin = min(u_obs.min().item(), u_mod.min().item())\n    ymax = max(u_obs.max().item(), u_mod.max().item())\n\n    # Add small padding\n    yrange = ymax - ymin\n    ymin -= 0.05 * yrange\n    ymax += 0.05 * yrange\n\n    # Plot observations (2024)\n    axs[i, 0].plot(obs_subset.time_dim[::6], u_obs, label=\"Observed U (2024)\", color=\"blue\")\n    axs[i, 0].set_title(f\"Station {i+1} - Observations (2024)\")\n    axs[i, 0].tick_params(axis='x', rotation=45)\n    axs[i, 0].set_ylim([ymin, ymax])\n    axs[i, 0].legend()\n\n    # Plot model (2023)\n    axs[i, 1].plot(u_rg['time'], u_mod, label=\"Model U (2024)\", color=\"green\")\n    axs[i, 1].set_title(f\"Station {i+1} - Model (2023)\")\n    axs[i, 1].tick_params(axis='x', rotation=45)\n    axs[i, 1].set_ylim([ymin, ymax])\n    axs[i, 1].legend()\n\nplt.tight_layout()\nplt.show()\n","key":"VyRGz3AmaB"},{"type":"outputs","id":"N10e3v3WywohC86QE1kW8","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f732729927449da3c55bf6627d9491b5","path":"/f732729927449da3c55bf6627d9491b5.png"},"text/plain":{"content":"<Figure size 1200x1500 with 10 Axes>","content_type":"text/plain"}}},"children":[],"key":"fHqVf5Tvv7"}],"key":"MNE3DlVnK9"}],"key":"PmS4H3dncB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"obs.lat","key":"OhN1PEXWVa"},{"type":"outputs","id":"Rx6kjRD62Nr4iJa3w4WyO","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;lat&#x27; (lat_dim: 1)&gt; Size: 8B\narray([64.299167])\nDimensions without coordinates: lat_dim</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'lat'</div><ul class='xr-dim-list'><li><span>lat_dim</span>: 1</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-db561384-fd55-4982-b556-86b24ab34065' class='xr-array-in' type='checkbox' checked><label for='section-db561384-fd55-4982-b556-86b24ab34065' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>64.3</span></div><div class='xr-array-data'><pre>array([64.299167])</pre></div></div></li><li class='xr-section-item'><input id='section-6b0c96bc-a711-4be2-8539-537d6e258903' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-6b0c96bc-a711-4be2-8539-537d6e258903' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-74726996-bc9f-437a-9332-7bc0cd28783b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-74726996-bc9f-437a-9332-7bc0cd28783b' class='xr-section-summary'  title='Expand/collapse section'>Indexes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-0aebce03-dd91-4485-8434-458950ba16d9' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0aebce03-dd91-4485-8434-458950ba16d9' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray 'lat' (lat_dim: 1)> Size: 8B\narray([64.299167])\nDimensions without coordinates: lat_dim","content_type":"text/plain"}}},"children":[],"key":"mTitJKBujM"}],"key":"TEeyFusdEd"}],"key":"mm2sUcrKbe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom windrose import WindroseAxes\n\n# Define number of stations\nnum_stations = 5\n\n# Create a figure with 2 columns (Obs & Model) and num_stations rows\nfig = plt.figure(figsize=(14, 7 * num_stations),layout='tight')\n\nfig.suptitle(\"Wind Roses: Observations (2024) vs Model (2024)\", fontsize=16)\n\nfor i in range(num_stations):\n\n    # Compute observed wind speed and direction\n    obs=list(datasets.values())[i]\n    obs_subset = obs.sel(time_dim=obs_time_range)\n    depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n    u_obs = obs_subset['u'].sel(depth_dim=depth_index)[::6]\n    v_obs = obs_subset['v'].sel(depth_dim=depth_index)[::6]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    direction_obs = (np.arctan2(-u_obs.squeeze().values, -v_obs.squeeze().values) * (180 / np.pi) + 360) % 360\n    speed_obs = np.sqrt(u_obs.squeeze().values**2 + v_obs.squeeze().values**2)\n\n    # Compute model wind speed and direction\n    u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    v_sel = v_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    \n    direction_model = (np.arctan2(-u_sel.squeeze().values, -v_sel.squeeze().values) * (180 / np.pi) + 360) % 360\n    speed_model = np.sqrt(u_sel.squeeze().values**2 + v_sel.squeeze().values**2)\n\n    # Define subplot positions using bbox (left, bottom, width, height)\n    ax_obs = WindroseAxes(fig, [0.05, 0.75 - (i * 0.2), 0.4, 0.18])  # Left column\n    fig.add_axes(ax_obs)\n    ax_obs.bar(direction_obs, speed_obs, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n    ax_obs.set_title(f\"Station {i+1} - Obs (2024)\", fontsize=12)\n    ax_obs.set_legend()\n    ax_obs.set_rticks([5, 10, 15, 20, 25, 30])\n    ax_obs.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n    \n    ax_model = WindroseAxes(fig, [0.55, 0.75 - (i * 0.2), 0.4, 0.18])  # Right column\n    fig.add_axes(ax_model)\n    ax_model.bar(direction_model, speed_model, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n    ax_model.set_title(f\"Station {i+1} - Model (2024)\", fontsize=12)\n    ax_model.set_legend()\n    ax_model.set_rticks([5, 10, 15, 20, 25, 30])\n    ax_model.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\nplt.show()\n","key":"RhPA7WNeNA"},{"type":"outputs","id":"vljt3df4lKCpG7GU-4SYO","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/home/x-uheede/.conda/envs/2024.02-py311/roms-tools/lib/python3.11/site-packages/IPython/core/pylabtools.py:170: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.canvas.print_figure(bytes_io, **kw)\n"},"children":[],"key":"fySPDG6AdF"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f389d0ebac46a7b1387c0370ab95a5d6","path":"/f389d0ebac46a7b1387c0370ab95a5d6.png"},"text/plain":{"content":"<Figure size 1400x3500 with 10 Axes>","content_type":"text/plain"}}},"children":[],"key":"oRHWSITA45"}],"key":"cEFtA9ZIYG"}],"key":"mErXu9ooxZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.signal import find_peaks\n\ndef compute_spectrum(time, signal):\n    \"\"\"Compute the FFT and identify spectral peaks.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step (assuming uniform spacing)\n    freq = np.fft.rfftfreq(n, d=dt)  # Compute frequency axis\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n    power = np.abs(spectrum)**2      # Compute Power Spectral Density (PSD)\n    \n    # Find peaks in the power spectrum\n    peaks, _ = find_peaks(power, height=np.max(power) * 0.1)  # Peaks with at least 10% of max power\n    \n    return freq, power, peaks\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\n\n# Example time series (Replace these with your observed and modeled data)\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).load().values\n# Define reference time (2000-01-01T00:00:00)\n\n\n\nmodel_time = (u_rg['time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\nobs_time=(obs_time-obs_time[0])*10**(-0)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-0)*1/3600\n\nobserved_signal = u_obs.squeeze().values  # Example signal\nmodeled_signal = u_sel.squeeze().values # Example signal\n\n# Compute spectra\nfreq_obs, power_obs, peaks_obs = compute_spectrum(obs_time, observed_signal)\nfreq_mod, power_mod, peaks_mod = compute_spectrum(model_time, modeled_signal)\n\n# Plot results\nplt.figure(figsize=(10, 5))\n\n# Observed Spectrum\nplt.plot(freq_obs, power_obs, label=\"Observed Spectrum\", color='b')\nplt.scatter(freq_obs[peaks_obs], power_obs[peaks_obs], color='r', label=\"Observed Peaks\", zorder=3)\n\n# Modeled Spectrum\nplt.plot(freq_mod, power_mod, label=\"Modeled Spectrum\", color='g', linestyle='dashed')\nplt.scatter(freq_mod[peaks_mod], power_mod[peaks_mod], color='orange', label=\"Modeled Peaks\", zorder=3)\n\nplt.xlabel(\"Frequency (hr$^{-1}$)\")\nplt.ylabel(\"Power\")\nplt.legend()\nplt.title(\"Spectral Peaks in Observed and Modeled Data\")\nplt.grid()\nplt.show()\n\n","key":"zCWpqjgfJc"},{"type":"outputs","id":"CRQmSIKgIhp5mSoFcm_m9","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7e26c0da483ed4534f5753d341b26851","path":"/7e26c0da483ed4534f5753d341b26851.png"},"text/plain":{"content":"<Figure size 1000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"E1r3Ey2OC6"}],"key":"XTWRHZOdxN"}],"key":"Nze3ednCK2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.signal import find_peaks\n\n# Convert frequency to period (avoid division by zero)\nperiod_obs = 1 / freq_obs[1:]  # Ignore first value to avoid division by zero\nperiod_mod = 1 / freq_mod[1:]\n\n# Plot results\nplt.figure(figsize=(10, 5))\n\n# Observed Spectrum\nplt.plot(period_obs, power_obs[1:], label=\"Observed Spectrum\", color='b')\n#plt.scatter(period_obs[peaks_obs - 1], power_obs[peaks_obs][1:], color='r', label=\"Observed Peaks\", zorder=3)\n\n# Modeled Spectrum\nplt.plot(period_mod, power_mod[1:], label=\"Modeled Spectrum\", color='g', linestyle='dashed')\n#plt.scatter(period_mod[peaks_mod - 1], power_mod[peaks_mod][1:], color='orange', label=\"Modeled Peaks\", zorder=3)\n\n#plt.xscale(\"log\")  # Log scale to better show long periods\nplt.xlabel(\"Period (hours)\")\nplt.ylabel(\"Power\")\nplt.legend()\nplt.title(\"Spectral Peaks in Observed and Modeled Data\")\nplt.grid(which=\"both\", linestyle=\"--\", linewidth=0.5)\nplt.gca().invert_xaxis()  # Invert x-axis so long periods are on the right\nplt.xlim(1,50)\nplt.show()\n","key":"mZFvC7TysV"},{"type":"outputs","id":"9ldiPcRpqEhBX_j1RVMAV","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1f8163cd787c0bdb9b26169a510ab5df","path":"/1f8163cd787c0bdb9b26169a510ab5df.png"},"text/plain":{"content":"<Figure size 1000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"diNEUmopnO"}],"key":"UEP5fFUZVL"}],"key":"KLSgaCY33w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef bandpass_filter(time, signal, min_period=10, max_period=15):\n    \"\"\"Filter the signal to retain only frequencies corresponding to periods between min_period and max_period hours.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Convert periods to frequencies\n    min_freq = 1 / max_period  # Lower cutoff frequency\n    max_freq = 1 / min_period  # Upper cutoff frequency\n\n    # Zero out frequencies outside the band\n    spectrum[(freq < min_freq) | (freq > max_freq)] = 0\n\n    # Inverse FFT to reconstruct filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Convert time to hours since reference time\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\nmodel_time = (u_rg['time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\nobs_time=(obs_time-obs_time[0])*10**(-0)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-0)*1/3600\n\n# Apply band-pass filter\nu_obs_filtered = bandpass_filter(obs_time, u_obs.squeeze().values, min_period=10, max_period=15)\nu_model_filtered = bandpass_filter(model_time, u_sel.squeeze().values, min_period=10, max_period=15)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot filtered observed signal\naxs[0].plot(obs_time, u_obs_filtered, label=\"Filtered Observed (10-15h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_ylim(-.41,.41)\naxs[0].set_title(\"Filtered Observed u_obs (10-15h Period)\")\naxs[0].legend()\naxs[0].grid()\n\n# Plot filtered modeled signal\naxs[1].plot(model_time, u_model_filtered, label=\"Filtered Modeled (10-15h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_ylim(-.41,.41)\naxs[1].set_title(\"Filtered Modeled u_model (10-15h Period)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"zSAdOD9mRM"},{"type":"outputs","id":"ETbZz2bZLCqQXfXiSqg2M","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"db531a860adbd12a6233e88bfa53707f","path":"/db531a860adbd12a6233e88bfa53707f.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"UEY7ppqOYe"}],"key":"b813jkBjGB"}],"key":"J2Nj2rCbTF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef highpass_filter(time, signal, cutoff_period=10):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (high-pass filter).\"\"\"\n\n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  # Frequency corresponding to the longest period to keep\n\n    # Zero out frequencies below the cutoff (i.e., remove long periods)\n    spectrum[freq < cutoff_freq] = 0\n\n    # Inverse FFT to reconstruct the high-pass filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Apply high-pass filter (removing periods ≥ 10 hours)\nu_obs_highpass = highpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=10)\nu_model_highpass = highpass_filter(model_time, u_sel.squeeze().values, cutoff_period=10)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot high-pass filtered observed signal\naxs[0].plot(obs_time, u_obs_highpass, label=\"Observed (Periods < 10h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"High-Pass Filtered Observed u_obs (Periods < 10h)\")\naxs[0].set_ylim(-.31,.31)\naxs[0].legend()\naxs[0].grid()\naxs[0].set_xlabel(\"Time (hours)\")\n\n# Plot high-pass filtered modeled signal\naxs[1].plot(model_time, u_model_highpass, label=\"Modeled (Periods < 10h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_ylim(-.31,.31)\naxs[1].set_title(\"High-Pass Filtered Modeled u_model (Periods < 10h)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"iRuun1zdwt"},{"type":"outputs","id":"mEgCxZg32J7iHY46cH8gS","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"67595816be94cddabfde44bd585bc321","path":"/67595816be94cddabfde44bd585bc321.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"TOIYLQVXol"}],"key":"yiifsrs9UR"}],"key":"tGDTGGeeu0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef lowpass_filter(time, signal, cutoff_period=15):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (high-pass filter).\"\"\"\n\n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  # Frequency corresponding to the longest period to keep\n\n    # Zero out frequencies below the cutoff (i.e., remove long periods)\n    spectrum[freq > cutoff_freq] = 0\n\n    # Inverse FFT to reconstruct the high-pass filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Apply high-pass filter (removing periods ≥ 10 hours)\nu_obs_lowpass = lowpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=15)\nu_model_lowpass = lowpass_filter(model_time, u_sel.squeeze().values, cutoff_period=15)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot high-pass filtered observed signal\naxs[0].plot(obs_time, u_obs_lowpass, label=\"Observed (Periods > 15h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"Low-Pass Filtered Observed u_obs (Periods > 15h)\")\naxs[0].legend()\naxs[0].set_ylim(-.31,.31)\naxs[0].grid()\naxs[0].set_xlabel(\"Time (hours)\")\n\n# Plot high-pass filtered modeled signal\naxs[1].plot(model_time, u_model_lowpass, label=\"Modeled (Periods > 15h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_ylim(-.31,.31)\naxs[1].set_title(\"Low-Pass Filtered Modeled u_model (Periods > 15h)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"IYUNWgtMud"},{"type":"outputs","id":"LVywWRX_r3RCaK19Yfepb","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4eae5394201b5f5c0bcae9ccbc4c8da9","path":"/4eae5394201b5f5c0bcae9ccbc4c8da9.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"NosPOZhwsR"}],"key":"vJFvrwayL5"}],"key":"olDRUFpVrh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef bandpass_filter(time, signal, low_cutoff=10, high_cutoff=15):\n    \"\"\"Apply a bandpass filter to retain frequencies between `low_cutoff` and `high_cutoff` hours.\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequencies\n    low_freq = 1 / high_cutoff\n    high_freq = 1 / low_cutoff–\n\n    # Zero out frequencies outside the band\n    spectrum[(freq < low_freq) | (freq > high_freq)] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\ndef highpass_filter(time, signal, cutoff_period=10):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (retain high frequencies).\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  \n\n    # Zero out frequencies below the cutoff (remove long periods)\n    spectrum[freq < cutoff_freq] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\ndef lowpass_filter(time, signal, cutoff_period=15):\n    \"\"\"Remove frequencies with periods shorter than `cutoff_period` hours (retain low frequencies).\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  \n\n    # Zero out frequencies above the cutoff (remove short periods)\n    spectrum[freq > cutoff_freq] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\n# Apply filters to observed and modeled data\nu_obs_bandpass = bandpass_filter(obs_time, u_obs.squeeze().values, low_cutoff=10, high_cutoff=15)\nu_model_bandpass = bandpass_filter(model_time, u_sel.squeeze().values, low_cutoff=10, high_cutoff=15)\n\nu_obs_highpass = highpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=10)\nu_model_highpass = highpass_filter(model_time, u_sel.squeeze().values, cutoff_period=10)\n\nu_obs_lowpass = lowpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=15)\nu_model_lowpass = lowpass_filter(model_time, u_sel.squeeze().values, cutoff_period=15)\n\n# Prepare data for boxplot\ndata = [\n    u_obs_bandpass, u_model_bandpass,\n    u_obs_highpass, u_model_highpass,\n    u_obs_lowpass, u_model_lowpass\n]\n\nlabels = [\n    \"Obs Bandpass (10-15h)\", \"Model Bandpass (10-15h)\",\n    \"Obs High-pass (<10h)\", \"Model High-pass (<10h)\",\n    \"Obs Low-pass (>15h)\", \"Model Low-pass (>15h)\"\n]\n\n# Define colors (Obs = Light Green, Model = Light Blue)\ncolors = ['lightgreen', 'lightblue', 'lightgreen', 'lightblue', 'lightgreen', 'lightblue']\n\n# Create boxplot\nfig, ax = plt.subplots(figsize=(10, 6))\nboxplot = ax.boxplot(data, labels=labels, patch_artist=True, medianprops=dict(color=\"red\"))\n\n# Apply colors to boxes\nfor patch, color in zip(boxplot['boxes'], colors):\n    patch.set_facecolor(color)\n    patch.set_alpha(0.6)  # Transparency for better readability\n\nax.set_ylabel(\"Velocity (m/s)\")\nax.set_title(\"Boxplot of Filtered Velocity Components\")\n\nplt.xticks(rotation=20)  # Rotate labels for better readability\nplt.grid(axis='y', linestyle='--', alpha=0.6)\n\nplt.show()\n","key":"RzvPvd4djZ"},{"type":"outputs","id":"MzThu6jAOA4JpTIQSiafF","children":[{"type":"output","jupyter_data":{"ename":"SyntaxError","evalue":"invalid character '–' (U+2013) (331315084.py, line 13)","output_type":"error","traceback":"  \u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[18]\u001b[39m\u001b[32m, line 13\u001b[39m\n\u001b[31m    \u001b[39m\u001b[31mhigh_freq = 1 / low_cutoff–\u001b[39m\n                              ^\n\u001b[31mSyntaxError\u001b[39m\u001b[31m:\u001b[39m invalid character '–' (U+2013)\n"},"children":[],"key":"greC4enHAb"}],"key":"U9cdlY6qAg"}],"key":"db8gedub6V"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"DYQWwlGACe"},{"type":"outputs","id":"Hag3P23OuhSmuTTT79G-4","children":[],"key":"aw9x4pbVtG"}],"key":"O9I15pMw0Z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport numpy as np\ntarget_depth_levels=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25,30,35,40,45,50]\n# Load ROMS output using your pattern\nroms_output = ROMSOutput(\n    grid=grid,\n    path=[\n        model_data_path,\n    ],\n    use_dask=True,\n)\n\nds = roms_output.regrid(var_names=[\"u\", \"v\"],depth_levels=target_depth_levels)\n\nu_mean=ds['u'].thin({'time': 48}).mean('time').load()\nv_mean=ds['v'].thin({'time': 48}).mean('time').load()","key":"R4vXGzToDa"},{"type":"outputs","id":"V6wCVNTIJTEoMbqP2bXxM","children":[],"key":"VrHOfWdKSF"}],"key":"M0u7QyGzG0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Create figure and subplots\nfig, axes = plt.subplots(nrows=1, ncols=5, figsize=(20, 5), sharey=True)\n\n# Loop through each dataset and create a subplot\nfor i, (key, obs) in enumerate(datasets.items()):\n    ax = axes[i]  # Select subplot\n    obs=list(datasets.values())[i]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    # Plot observed profile\n    ax.plot(obs['u'].mean('time_dim').squeeze(), obs.depth, label=\"Observed\", color='b')\n\n    # Extract nearest model data\n    u_sel = u_mean.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n\n    # Plot modeled profile\n    ax.plot(u_sel.squeeze(), u_mean.depth, label=\"Modeled\", color='r')\n\n    # Reverse y-axis\n    ax.invert_yaxis()\n\n    # Titles and labels\n    ax.set_title(f\"Station {i+1}\")\n    if i == 0:\n        ax.set_ylabel(\"Depth (m)\")\n    ax.set_xlabel(\"Velocity (m/s)\")\n    ax.legend()\n\nplt.tight_layout()\nplt.show()\n","key":"zE8Auq91lw"},{"type":"outputs","id":"fLjoc2OVL0n8NqB_Q4EJe","children":[],"key":"xf5BLxkqrs"}],"key":"PNYdaGqYis"}],"key":"ghciwVp2bu"},"references":{"cite":{"order":[],"data":{}}}}