{"version":3,"kind":"Notebook","sha256":"55454d1718ad9fb39e33911fb9cd47310fbcbea62e63c6a0358124c8cc162aba","slug":"regrid-atmospheric-forcing-vedur","location":"/regrid_atmospheric_forcing-Vedur.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"xesmf_env","display_name":"xesmf_env","language":"python"},"exports":[{"format":"ipynb","filename":"regrid_atmospheric_forcing-Vedur.ipynb","url":"/regrid_atmospheric_f-40f07a4bd7d8a439d23eb58f66b28c08.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\n\nimport netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \n#from ocean_c_lab_tools import *\nfrom celluloid import Camera \nimport PyCO2SYS as csys\nimport seawater as sw\nimport xesmf as xe","visibility":"show","key":"QCl4xQcqAf"},{"type":"outputs","id":"PaB4IrTWmMV-PadvJm3xf","children":[],"visibility":"show","key":"HLkScoXQv3"}],"visibility":"show","key":"ZVZA5tudX7"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"r2=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_rhum.nc')\nssr=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_swavr.nc')\nstr=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_lwavr.nc')\nt2m=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_t2m.nc')\ntp=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_tp.nc')\nu10=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_u10.nc')\nv10=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/ig-is_202408*_v10.nc')\n\n\n","visibility":"show","key":"EBMppHAh52"},{"type":"outputs","id":"ZelW3DXe-zPYpuIaU4bdr","children":[],"visibility":"show","key":"LQtnRHJeol"}],"visibility":"show","key":"Ij4V5OLMKD"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ssr.load()\nstr.load()","visibility":"show","key":"dKbM1XewwK"},{"type":"outputs","id":"OW02IQQTdEpHC77yHe0gU","children":[],"visibility":"show","key":"Uiki73V7dz"}],"visibility":"show","key":"ZQT8TGUUTq"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"valid_time_seconds = (r2['valid_time'].astype('datetime64[s]') - np.datetime64('1970-01-01T00:00:00Z')).astype(int)/1e9\n","visibility":"show","key":"nWLAhmnxFx"},{"type":"outputs","id":"45MLM4gEPbCgvYmr-7RYK","children":[],"visibility":"show","key":"Mh0u5wel3e"}],"visibility":"show","key":"oom8RcM2SA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"r2['time']=valid_time_seconds\nssr['time']=valid_time_seconds\nstr['time']=valid_time_seconds\nt2m['time']=valid_time_seconds\ntp['time']=valid_time_seconds\nu10['time']=valid_time_seconds\nv10['time']=valid_time_seconds","visibility":"show","key":"ez7AG1DT64"},{"type":"outputs","id":"2reoniwSsAlYimT_XB384","children":[],"visibility":"show","key":"BBPAUTYnZZ"}],"visibility":"show","key":"mqgWtXBQQF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ssr['time']=valid_time_seconds\nssr['time']","visibility":"show","key":"Vl9pkmfBfb"},{"type":"outputs","id":"F8O4mjAZcBbfp648binB4","children":[],"visibility":"show","key":"tWL7DSlqyb"}],"visibility":"show","key":"YrnCkopRUd"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"lon_min=np.min(r2.longitude.load())\nlon_max=np.max(r2.longitude.load())\n\nlon_step=((lon_max-lon_min)/len(r2.x))\n\nlat_min=np.min(r2.latitude.load())\nlat_max=np.max(r2.latitude.load())\nlat_step=((lat_max-lat_min)/len(r2.y))","visibility":"show","key":"lAjAmwQbHf"},{"type":"outputs","id":"2drRg-tSW1MnBk8Rjn1LN","children":[],"visibility":"show","key":"HhplYaVm35"}],"visibility":"show","key":"Cen4QkGM99"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds_out = xr.Dataset(\n    {\n        \"lon\": ([\"lon\"], np.arange(lon_min, lon_max, lon_step), {\"units\": \"degrees_north\"}),\n        \"lat\": ([\"lat\"], np.arange(lat_min, lat_max, lat_step), {\"units\": \"degrees_east\"}),\n    }\n)","visibility":"show","key":"sRdaPVjeDy"},{"type":"outputs","id":"AABCudKZWcrtWQJvavU75","children":[],"visibility":"show","key":"HFpFfbKdqJ"}],"visibility":"show","key":"vu7eNvirJ3"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds_out","visibility":"show","key":"xVVBv6ji7U"},{"type":"outputs","id":"1UFCaF9kJAKRpBDO5yPKY","children":[],"visibility":"show","key":"U6AKYwSTFn"}],"visibility":"show","key":"Gr3iIAUBbr"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"regridder = xe.Regridder(r2, ds_out, \"bilinear\")\nr2_regrid=regridder(r2['rhum'])\n\nssr_regrid=regridder(ssr['swavr'])\nstr_regrid=regridder(str['lwavr'])\nt2m_regrid=regridder(t2m['t2m'])\ntp_regrid=regridder(tp['tp']*0.001) # convert from kg/m2 to m\nu10_regrid=regridder(u10['u10'])\nv10_regrid=regridder(v10['v10'])","visibility":"show","key":"WD0dW2diPT"},{"type":"outputs","id":"cP4e8wqScz-6Cq3S5gH2G","children":[],"visibility":"show","key":"bKmiKj3Nsq"}],"visibility":"show","key":"uTXbfcovc9"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"r2_regrid","visibility":"show","key":"TALLgHXHpl"},{"type":"outputs","id":"Ex_T-ffOcnzK_l5jPhj1S","children":[],"visibility":"show","key":"BjEZv23bL2"}],"visibility":"show","key":"en9qD5YnqA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cf=plt.contourf(t2m_regrid.isel(valid_time=0))\nplt.colorbar(cf)","visibility":"show","key":"toehbnsYhp"},{"type":"outputs","id":"bFRhTcN1nOc4u4gfmSGuI","children":[],"visibility":"show","key":"xpumcDyRik"}],"visibility":"show","key":"f4jBp5uck1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"p=101000\ne=610.94*np.exp(17.625*(t2m_regrid-273.15)/((t2m_regrid-273.15)+243.04))*r2_regrid\nq = (0.622 * e) / (p - (1 - 0.622) * e)\n","visibility":"show","key":"DSSxDiHc16"},{"type":"outputs","id":"sn5fsKfIrIisH8qKTy-Ui","children":[],"visibility":"show","key":"xL6u2Oon5m"}],"visibility":"show","key":"t8CmXahNaD"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cf=plt.contourf(q.isel(valid_time=0))\nplt.colorbar(cf)","visibility":"show","key":"pZmVDDVtAm"},{"type":"outputs","id":"Ku7aP9G312Zk3IKNgI3vb","children":[],"visibility":"show","key":"jmMCHxxFbM"}],"visibility":"show","key":"hwj4aJdKBv"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sh2_regrid = q","visibility":"show","key":"P9vuOlfTMT"},{"type":"outputs","id":"Jl9hEGSzpUgN0fmXzXq3M","children":[],"visibility":"show","key":"hi7buGth3j"}],"visibility":"show","key":"J61iL1W6GA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"","visibility":"show","key":"UncVAQTXVs"},{"type":"outputs","id":"csANnldVM96VLHVT5EK3w","children":[],"visibility":"show","key":"Plxql38nvU"}],"visibility":"show","key":"T6vkXInIPo"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"r2_regrid.attrs['long name'] = '2 metre relative humidity'\nr2_regrid=r2_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n#r2_regrid=r2_regrid.rename({\"rhum\":'r2'})\n\nsh2_regrid.attrs['long name'] = '2 metre specific humidity'\nsh2_regrid=sh2_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n\nssr_regrid.attrs['long name'] = 'Surface net short-wave (solar) radiation'\nssr_regrid=ssr_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n#ssr_regrid=ssr_regrid.rename({\"swavr\":'ssr'})\n\nstr_regrid.attrs['long name'] = 'Surface long-wave (thermal) radiation downwards'\nstr_regrid=str_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n#str_regrid=str_regrid.rename({\"lwavr\":'str'})\n\nu10_regrid.attrs['long name'] = '10 metre U wind component'\nu10_regrid=u10_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n\nv10_regrid.attrs['long name'] = '10 metre V wind component'\nv10_regrid=v10_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n\nt2m_regrid.attrs['long name'] = '2 metre temperature'\nt2m_regrid=t2m_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n\ntp_regrid.attrs['long name'] = 'total precipitation'\ntp_regrid=tp_regrid.reset_coords(names=\"heightAboveGround\",drop=True)\n","visibility":"show","key":"ADudAednAT"},{"type":"outputs","id":"9lRFh6vOUp472ynCvfoWR","children":[],"visibility":"show","key":"lqE3HAqGSd"}],"visibility":"show","key":"Uv9JJHb23s"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(u10_regrid.time)\nprint(v10_regrid.time)\nprint(t2m_regrid.time)\nprint(tp_regrid.time)\nprint(ssr_regrid.time)\nprint(str_regrid.time)\nprint(sh2_regrid.time)","visibility":"show","key":"NodenQK80R"},{"type":"outputs","id":"ilQ6iIlap9zGZaT7UtFQE","children":[],"visibility":"show","key":"VBYmLVZJqk"}],"visibility":"show","key":"hOCU8SoR4m"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"vedur_2024 = xr.Dataset({\n    'u10': u10_regrid.load().squeeze(),\n    'v10': v10_regrid.load().squeeze(),\n    't2m': t2m_regrid.load().squeeze(),\n    'strd': str_regrid.load().squeeze(),\n    'ssr': ssr_regrid.load().squeeze(),\n    'sh2': sh2_regrid.load().squeeze(),\n    'tp': tp_regrid.load().squeeze(),\n    'longitude': u10_regrid.load().lon,\n    'latitude': u10_regrid.load().lat})","visibility":"show","key":"w3QD8tjDq8"},{"type":"outputs","id":"b9iaPgNPHVZzQw3ddJjbS","children":[],"visibility":"show","key":"b2UnQwF8HH"}],"visibility":"show","key":"OsFU530xks"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sh2_regrid","visibility":"show","key":"EC3RivZuSW"},{"type":"outputs","id":"wDQ15Rq0wt24GQ0hJQGbD","children":[],"visibility":"show","key":"jkjuJv6i9X"}],"visibility":"show","key":"PUkxXDnnXZ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#vedur_2024 = vedur_2024.set_index(time='valid_time')","visibility":"show","key":"dXiqTqtPSw"},{"type":"outputs","id":"-Ok8g7X8uAV84WCm4Afm9","children":[],"visibility":"show","key":"aFXBQWmJSY"}],"visibility":"show","key":"MMnet6rZjt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"vedur_2024.to_netcdf('/global/cfs/cdirs/m4632/uheede/Vedur_data/ig-is_202406-8/netcdf_files/vedur_202408.nc')\n\n\n","key":"nhbRl0ObOq"},{"type":"outputs","id":"t-g85hSevsxbfyUUsaiBF","children":[],"key":"CVC4ptsoxe"}],"key":"INRZQX6Ryr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"vedur_2024","key":"Cr3zWgwmjt"},{"type":"outputs","id":"H8jx6hZKozbaNWn-44hGZ","children":[],"key":"IzDYYx32fH"}],"key":"jOdDDxKVSm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"720/24","visibility":"show","key":"wwvGxqIJ1C"},{"type":"outputs","id":"N2hFChkKO35HvUNi6thrL","children":[],"visibility":"show","key":"F7KqpHzgBx"}],"visibility":"show","key":"rX4TnzTgef"}],"key":"Ahs4UnDsTF"},"references":{"cite":{"order":[],"data":{}}}}