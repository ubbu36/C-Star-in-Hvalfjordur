{"version":3,"kind":"Notebook","sha256":"3eb44aebe2b29825634b8ed0a17b395e174fbdab56a887d7cf6f39b95db18a42","slug":"sf6-observations","location":"/SF6_observations.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"xesmf_env","display_name":"xesmf_env","language":"python"},"exports":[{"format":"ipynb","filename":"SF6_observations.ipynb","url":"/SF6_observations-9d3cee697c999fcea9d37723c35d552f.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\nimport pandas as pd\nimport netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \nimport dask\nfrom scipy.interpolate import griddata\n#from ocean_c_lab_tools import *\n#from celluloid import Camera \n#import PyCO2SYS as csys\nimport seawater as sw\nfrom roms_regrid import *","key":"oG2Pj06oHj"},{"type":"outputs","id":"0dbdZqPmq7uU1dicUCi9v","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_212869/3005166470.py:17: UserWarning: The seawater library is deprecated! Please use gsw instead.\n  import seawater as sw\n"},"children":[],"key":"fXLahVdNl8"}],"key":"qJzIpIWM7p"}],"key":"yJFWSYlyfa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xls = pd.ExcelFile('20241119_combined_data.xlsx')\n\n\ncombo = pd.read_excel(xls, '20241119_combined_data',decimal='.')\ncombo","key":"kkPTAqwxXU"},{"type":"outputs","id":"BMfW4Z5ZVnprJr3oTCfQy","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Date</th>\n      <th>Lat</th>\n      <th>Long</th>\n      <th>TIMESTAMP</th>\n      <th>Unnamed: 4</th>\n      <th>SF6 (fmol/L)</th>\n      <th>Col</th>\n      <th>Area</th>\n      <th>TSG_salinity</th>\n      <th>TSG-temp</th>\n      <th>Obs_no</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2024-07-17</td>\n      <td>64.32825</td>\n      <td>-21.80205</td>\n      <td>04:45:00</td>\n      <td>PM</td>\n      <td>0.10</td>\n      <td>R</td>\n      <td>0.1</td>\n      <td>33.3366</td>\n      <td>11.8161</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2024-07-17</td>\n      <td>64.32976</td>\n      <td>-21.79768</td>\n      <td>04:46:00</td>\n      <td>PM</td>\n      <td>0.10</td>\n      <td>L</td>\n      <td>0.1</td>\n      <td>33.3808</td>\n      <td>11.6866</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2024-07-17</td>\n      <td>64.33173</td>\n      <td>-21.79222</td>\n      <td>04:48:00</td>\n      <td>PM</td>\n      <td>0.10</td>\n      <td>R</td>\n      <td>0.1</td>\n      <td>33.3917</td>\n      <td>11.7163</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2024-07-17</td>\n      <td>64.33325</td>\n      <td>-21.78762</td>\n      <td>04:49:00</td>\n      <td>PM</td>\n      <td>0.10</td>\n      <td>L</td>\n      <td>0.1</td>\n      <td>33.2175</td>\n      <td>11.8738</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2024-07-17</td>\n      <td>64.33526</td>\n      <td>-21.78227</td>\n      <td>04:50:00</td>\n      <td>PM</td>\n      <td>0.10</td>\n      <td>R</td>\n      <td>0.1</td>\n      <td>33.1928</td>\n      <td>11.8925</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2724</th>\n      <td>2024-07-25</td>\n      <td>64.29511</td>\n      <td>-22.05250</td>\n      <td>06:02:00</td>\n      <td>PM</td>\n      <td>3.58</td>\n      <td>L</td>\n      <td>1516.6</td>\n      <td>34.1858</td>\n      <td>12.9878</td>\n      <td>2725</td>\n    </tr>\n    <tr>\n      <th>2725</th>\n      <td>2024-07-25</td>\n      <td>64.29914</td>\n      <td>-22.06086</td>\n      <td>06:04:00</td>\n      <td>PM</td>\n      <td>6.28</td>\n      <td>L</td>\n      <td>2637.9</td>\n      <td>34.1605</td>\n      <td>12.9207</td>\n      <td>2726</td>\n    </tr>\n    <tr>\n      <th>2726</th>\n      <td>2024-07-25</td>\n      <td>64.30427</td>\n      <td>-22.06558</td>\n      <td>06:07:00</td>\n      <td>PM</td>\n      <td>4.64</td>\n      <td>L</td>\n      <td>1965.5</td>\n      <td>34.1565</td>\n      <td>12.9650</td>\n      <td>2727</td>\n    </tr>\n    <tr>\n      <th>2727</th>\n      <td>2024-07-25</td>\n      <td>64.30935</td>\n      <td>-22.07066</td>\n      <td>06:09:00</td>\n      <td>PM</td>\n      <td>4.46</td>\n      <td>L</td>\n      <td>1848.6</td>\n      <td>33.8809</td>\n      <td>12.9910</td>\n      <td>2728</td>\n    </tr>\n    <tr>\n      <th>2728</th>\n      <td>2024-07-25</td>\n      <td>64.31367</td>\n      <td>-22.07553</td>\n      <td>06:11:00</td>\n      <td>PM</td>\n      <td>3.05</td>\n      <td>L</td>\n      <td>1273.7</td>\n      <td>34.0009</td>\n      <td>12.7879</td>\n      <td>2729</td>\n    </tr>\n  </tbody>\n</table>\n<p>2729 rows × 11 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"           Date       Lat      Long TIMESTAMP Unnamed: 4  SF6 (fmol/L) Col  \\\n0    2024-07-17  64.32825 -21.80205  04:45:00         PM          0.10   R   \n1    2024-07-17  64.32976 -21.79768  04:46:00         PM          0.10   L   \n2    2024-07-17  64.33173 -21.79222  04:48:00         PM          0.10   R   \n3    2024-07-17  64.33325 -21.78762  04:49:00         PM          0.10   L   \n4    2024-07-17  64.33526 -21.78227  04:50:00         PM          0.10   R   \n...         ...       ...       ...       ...        ...           ...  ..   \n2724 2024-07-25  64.29511 -22.05250  06:02:00         PM          3.58   L   \n2725 2024-07-25  64.29914 -22.06086  06:04:00         PM          6.28   L   \n2726 2024-07-25  64.30427 -22.06558  06:07:00         PM          4.64   L   \n2727 2024-07-25  64.30935 -22.07066  06:09:00         PM          4.46   L   \n2728 2024-07-25  64.31367 -22.07553  06:11:00         PM          3.05   L   \n\n        Area  TSG_salinity  TSG-temp  Obs_no  \n0        0.1       33.3366   11.8161       1  \n1        0.1       33.3808   11.6866       2  \n2        0.1       33.3917   11.7163       3  \n3        0.1       33.2175   11.8738       4  \n4        0.1       33.1928   11.8925       5  \n...      ...           ...       ...     ...  \n2724  1516.6       34.1858   12.9878    2725  \n2725  2637.9       34.1605   12.9207    2726  \n2726  1965.5       34.1565   12.9650    2727  \n2727  1848.6       33.8809   12.9910    2728  \n2728  1273.7       34.0009   12.7879    2729  \n\n[2729 rows x 11 columns]","content_type":"text/plain"}}},"children":[],"key":"ad0Sc0KFrF"}],"key":"PnMNaKl9Mk"}],"key":"ol8I9i6khJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"obs=xr.Dataset.from_dataframe(combo)\nobs=obs.set_index(index=['Date','Obs_no'])\n#obs=obs.drop_duplicates('index')\nobs=obs.unstack('index')\n#obs=obs.rename(name_dict={'mon/day/yr':'time','Depth':'depth','Latitude(¬∞N)':'lat','Longitude(¬∞E)':'lon'})\n","key":"t1fr2nDRFL"},{"type":"outputs","id":"1KuKDR9P8txgf4-F0PI03","children":[],"key":"hkVGqNmHyF"}],"key":"uFcAhLK6EN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/roms_setups/Iceland3_MARBL/1.Make_grid/Iceland4_grd.nc')\nmask=roms_regrid(grid,grid['mask_rho'])","key":"R8j9shC8ba"},{"type":"outputs","id":"8UyGMuFU7qULh1-sojDiu","children":[],"key":"PMRI4HQ6af"}],"key":"ROUN1fh0uT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid","key":"VDblHYUL1U"},{"type":"outputs","id":"kqudGgkrWJhi3WXqK9wH3","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"0fd2866feb0eda408e9d9a206445c247","path":"/0fd2866feb0eda408e9d9a206445c247.html"},"text/plain":{"content":"<xarray.Dataset> Size: 85MB\nDimensions:       (one: 1, eta_rho: 722, xi_rho: 1442, eta_coarse: 362,\n                   xi_coarse: 722)\nDimensions without coordinates: one, eta_rho, xi_rho, eta_coarse, xi_coarse\nData variables: (12/19)\n    spherical     (one) |S1 1B dask.array<chunksize=(1,), meta=np.ndarray>\n    angle         (eta_rho, xi_rho) float64 8MB dask.array<chunksize=(722, 1442), meta=np.ndarray>\n    h             (eta_rho, xi_rho) float64 8MB dask.array<chunksize=(722, 1442), meta=np.ndarray>\n    hraw          (eta_rho, xi_rho) float64 8MB dask.array<chunksize=(722, 1442), meta=np.ndarray>\n    f             (eta_rho, xi_rho) float64 8MB dask.array<chunksize=(722, 1442), meta=np.ndarray>\n    pm            (eta_rho, xi_rho) float64 8MB dask.array<chunksize=(722, 1442), meta=np.ndarray>\n    ...            ...\n    xy_flip       (one) float64 8B dask.array<chunksize=(1,), meta=np.ndarray>\n    lon_coarse    (eta_coarse, xi_coarse) float64 2MB dask.array<chunksize=(362, 722), meta=np.ndarray>\n    lat_coarse    (eta_coarse, xi_coarse) float64 2MB dask.array<chunksize=(362, 722), meta=np.ndarray>\n    angle_coarse  (eta_coarse, xi_coarse) float64 2MB dask.array<chunksize=(362, 722), meta=np.ndarray>\n    h_coarse      (eta_coarse, xi_coarse) float64 2MB dask.array<chunksize=(362, 722), meta=np.ndarray>\n    mask_coarse   (eta_coarse, xi_coarse) float64 2MB dask.array<chunksize=(362, 722), meta=np.ndarray>\nAttributes:\n    Title:    ROMS grid by Easy Grid. Settings: nx: 1440 ny: 720 xsize: 43.6 ...\n    Date:     21-Aug-2023\n    Type:     ROMS grid produced by Easy Grid","content_type":"text/plain"}}},"children":[],"key":"gzc837HUdW"}],"key":"WoJjUufYEW"}],"key":"rtziyPbQZV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\ndef get_daily_locations(obs_ds):\n    dates = obs_ds['Date'].values\n    num_days = len(dates)\n    num_obs = obs_ds.dims['Obs_no']\n    \n    # Initialize empty array: (days, obs, 2)\n    locations = np.empty((num_days, num_obs, 2))\n    \n    for i in range(0,num_days):\n        lat = obs_ds['Lat'].isel(Date=i).values\n        lon = obs_ds['Long'].isel(Date=i).values + 360  # convert to 0–360 range\n        locations[i, :, 0] = lat\n        locations[i, :, 1] = lon\n    \n    return locations\n\n# Example usage\nlocations_array = get_daily_locations(obs)\nprint(\"Shape of locations array:\", locations_array.shape)  # should be (9, 2729, 2)\n","key":"Tp8zevbj3T"},{"type":"outputs","id":"85eKUXckUqP8jEq7K22Us","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Shape of locations array: (9, 2729, 2)\n"},"children":[],"key":"WKOuyIo9A0"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1582087/1794326622.py:6: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.\n  num_obs = obs_ds.dims['Obs_no']\n"},"children":[],"key":"xMS24za072"}],"key":"R3m5qRkBkC"}],"key":"DFGluyAVwW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib.colors import LogNorm\nimport cartopy.crs as ccrs\nfrom cartopy.mpl.gridliner import LONGITUDE_FORMATTER, LATITUDE_FORMATTER\n\n\nfigures = [\n    {'days': [0, 1]},       # Figure 1: Days 1–2\n    {'days': [2, 3]},       # Figure 2: Days 3–4\n    {'days': [4, 5]},       # Figure 3: Days 5–6\n    {'days': [6]},          # Figure 4: Day 7\n]\n\nfor fig_idx, group in enumerate(figures):\n    nrows = len(group['days'])\n    fig, axs = plt.subplots(nrows=nrows, figsize=(6, 2.5 * nrows), dpi=200,\n                            subplot_kw={'projection': ccrs.Mercator()})\n\n    if nrows == 1:\n        axs = [axs]  # make iterable\n\n    for ax, day in zip(axs, group['days']):\n        obs_day=obs['SF6 (fmol/L)'].isel(Date=day).values\n        obs_lat=obs['Lat'].isel(Date=day).values\n        obs_lon=obs['Long'].isel(Date=day).values\n        obs_clear = obs_day[~np.isnan(obs_day)]\n        obs_lat = obs_lat[~np.isnan(obs_lat)]\n        obs_lon = obs_lon[~np.isnan(obs_lon)]\n        \n        ax.contourf(mask.lon, mask.lat, mask.load(), transform=ccrs.PlateCarree(), cmap='bone')\n        \n        scatter = ax.scatter(obs_lat, obs_lon, c=obs_clear, cmap='jet', edgecolor='none',\n                             transform=ccrs.PlateCarree(), s=5,\n                             norm=LogNorm(vmin=1e-1, vmax=5e4))\n    gl = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,\n                      linewidth=1, color='gray', alpha=0.5, linestyle='--')\n    gl.top_labels = False\n    gl.right_labels = False\n    gl.xlines = False\n    gl.ylines = False\n    gl.xformatter = LONGITUDE_FORMATTER\n    gl.yformatter = LATITUDE_FORMATTER\n\n    ax.set_title(f'Day {day+1}: Avg SF6 over 24 hrs', fontsize=8)\n    # Get the bounding box of the mask\n    lon_min = float(mask.lon.min())\n    lon_max = float(mask.lon.max())\n    lat_min = float(mask.lat.min())\n    lat_max = float(mask.lat.max())\n\n    # Set map extent to match mask\n    ax.set_extent([lon_min, lon_max, lat_min, lat_max], crs=ccrs.PlateCarree())\n\n# Colorbar\n#cbar = ax.colorbar(scatter, ax=axs, orientation='vertical', shrink=0.5, pad=0.05)\n#cbar.set_label('SF6 (fmol/L)')\n\nplt.tight_layout()\nplt.show()","key":"Pm3P5TtJTQ"},{"type":"outputs","id":"MqcDZzv6P_UMlpUld5Aiq","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5891809419d2b4f7a8f6228ef2e2568f","path":"/5891809419d2b4f7a8f6228ef2e2568f.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"aH1njpHH8P"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f77772f5a75dc137fbfbe02e17f2c00a","path":"/f77772f5a75dc137fbfbe02e17f2c00a.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"JJRVUi6pUC"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ebf5b2324809d9c18d9d3ac6f33c6064","path":"/ebf5b2324809d9c18d9d3ac6f33c6064.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"nmRPaPZRjS"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"926c66f8680f437edcc3c740463368be","path":"/926c66f8680f437edcc3c740463368be.png"},"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"WdNG40Wtce"}],"key":"EazxSZJerO"}],"key":"HU6uEYljH3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib.colors import LogNorm\nimport cartopy.crs as ccrs\nfrom cartopy.mpl.gridliner import LONGITUDE_FORMATTER, LATITUDE_FORMATTER\nimport matplotlib.pyplot as plt\n\nfigures = [\n    {'days': [0, 1]},       # Figure 1: Days 1–2\n    {'days': [2, 3]},       # Figure 2: Days 3–4\n    {'days': [4, 5]},       # Figure 3: Days 5–6\n    {'days': [6]},          # Figure 4: Day 7\n]\n\nfor fig_idx, group in enumerate(figures):\n    nrows = len(group['days'])\n    fig, axs = plt.subplots(nrows=nrows, figsize=(6, 2.5 * nrows), dpi=200,\n                            subplot_kw={'projection': ccrs.Mercator()})\n\n    if nrows == 1:\n        axs = [axs]  # Make iterable if only one subplot\n\n    for ax, day in zip(axs, group['days']):\n        # Extract observation values\n        obs_day = obs['SF6 (fmol/L)'].isel(Date=day).values\n        obs_lat = obs['Lat'].isel(Date=day).values\n        obs_lon = obs['Long'].isel(Date=day).values\n\n        # Remove NaNs\n        mask_valid = ~np.isnan(obs_day)\n        obs_clear = obs_day[mask_valid]\n        obs_lat = obs_lat[mask_valid]\n        obs_lon = obs_lon[mask_valid]\n\n        # Plot the land mask\n        ax.contourf(mask.lon, mask.lat, mask.load(), transform=ccrs.PlateCarree(), cmap='bone')\n\n        # Plot the observations as scatter points\n        scatter = ax.scatter(obs_lon, obs_lat, c=obs_clear, cmap='jet', edgecolor='none',\n                             transform=ccrs.PlateCarree(), s=5,\n                             norm=LogNorm(vmin=1e-1, vmax=5e4))\n\n        # Set map extent to match mask\n        lon_min = float(mask.lon.min())\n        lon_max = float(mask.lon.max())\n        lat_min = float(mask.lat.min())\n        lat_max = float(mask.lat.max())\n        ax.set_extent([lon_min, lon_max, lat_min, lat_max], crs=ccrs.PlateCarree())\n\n        # Add gridlines\n        gl = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,\n                          linewidth=1, color='gray', alpha=0.5, linestyle='--')\n        gl.top_labels = False\n        gl.right_labels = False\n        gl.xlines = False\n        gl.ylines = False\n        gl.xformatter = LONGITUDE_FORMATTER\n        gl.yformatter = LATITUDE_FORMATTER\n\n        # Title\n        ax.set_title(f'Day {day+1}: SF6 Observations', fontsize=8)\n\n    # Optional colorbar for each figure (shared across subplots)\n    # cbar = fig.colorbar(scatter, ax=axs, orientation='vertical', shrink=0.6, pad=0.05)\n    # cbar.set_label('SF6 (fmol/L)')\n\n    plt.tight_layout()\n    plt.show()\n","key":"Ph2NWhCas0"},{"type":"outputs","id":"QtTwHFJhlVySZshur_cSt","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"95b9e88efe6df0f84b95f6967d323ed3","path":"/95b9e88efe6df0f84b95f6967d323ed3.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"bg5jBgQ2GG"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3bc35959cd81d1e0def1a2d23a1276e0","path":"/3bc35959cd81d1e0def1a2d23a1276e0.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"WH2KzfVYQu"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6b38ac6afd72c58307548ad19bb32e1a","path":"/6b38ac6afd72c58307548ad19bb32e1a.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"qE1T3OoQe0"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ac850c916c81920591e7bc98336a07fb","path":"/ac850c916c81920591e7bc98336a07fb.png"},"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"dENbDp3xCt"}],"key":"UY5R0HhseK"}],"key":"BNEXBHGkFm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for fig_idx, group in enumerate(figures):\n    nrows = len(group['days'])\n    fig, axs = plt.subplots(nrows=nrows, figsize=(6, 2.5 * nrows), dpi=200,\n                            subplot_kw={'projection': ccrs.Mercator()})\n\n    if nrows == 1:\n        axs = [axs]\n\n    all_scatters = []\n    for ax, day in zip(axs, group['days']):\n        obs_day = obs['SF6 (fmol/L)'].isel(Date=day).values\n        obs_lat = obs['Lat'].isel(Date=day).values\n        obs_lon = obs['Long'].isel(Date=day).values\n\n        mask_valid = ~np.isnan(obs_day)\n        obs_clear = obs_day[mask_valid]\n        obs_lat = obs_lat[mask_valid]\n        obs_lon = obs_lon[mask_valid]\n\n        ax.contourf(mask.lon, mask.lat, mask.load(), transform=ccrs.PlateCarree(), cmap='bone')\n\n        scatter = ax.scatter(obs_lon, obs_lat, c=obs_clear, cmap='jet', edgecolor='none',\n                             transform=ccrs.PlateCarree(), s=5,\n                             norm=LogNorm(vmin=1e-1, vmax=5e4))\n        all_scatters.append(scatter)\n\n        lon_min = float(mask.lon.min())\n        lon_max = float(mask.lon.max())\n        lat_min = float(mask.lat.min())\n        lat_max = float(mask.lat.max())\n        ax.set_extent([lon_min, lon_max, lat_min, lat_max], crs=ccrs.PlateCarree())\n\n        gl = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,\n                          linewidth=1, color='gray', alpha=0.5, linestyle='--')\n        gl.top_labels = False\n        gl.right_labels = False\n        gl.xlines = False\n        gl.ylines = False\n        gl.xformatter = LONGITUDE_FORMATTER\n        gl.yformatter = LATITUDE_FORMATTER\n\n        ax.set_title(f'Day {day+1}: SF6 Observations', fontsize=8)\n\n    # Optional: add shared colorbar\n    #cbar = fig.colorbar(all_scatters[0], ax=axs, orientation='vertical', shrink=0.6, pad=0.05)\n    #cbar.set_label('SF6 (fmol/L)')\n\n    plt.tight_layout()\n    plt.savefig(f'sf6_obs_group_{fig_idx+1}.png', dpi=300, bbox_inches='tight')\n    plt.show()\n","key":"kb1IUC2Zcn"},{"type":"outputs","id":"YD7ub3vBBZzA6l-sq2D9X","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"95b9e88efe6df0f84b95f6967d323ed3","path":"/95b9e88efe6df0f84b95f6967d323ed3.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"nW51KUc2nu"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3bc35959cd81d1e0def1a2d23a1276e0","path":"/3bc35959cd81d1e0def1a2d23a1276e0.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"FFGYtaW19r"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6b38ac6afd72c58307548ad19bb32e1a","path":"/6b38ac6afd72c58307548ad19bb32e1a.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"RvJdu3n6RU"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ac850c916c81920591e7bc98336a07fb","path":"/ac850c916c81920591e7bc98336a07fb.png"},"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"mUbBspi6Tc"}],"key":"zXPCoiE4Nd"}],"key":"m17tf91Tpo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\nimport xarray as xr\n\n\n\nnum_days = 7\n\n# Precompute the mask\nmask = roms_regrid(grid, grid['mask_rho'])\n\n# Set up plotting\nplt.figure(figsize=(10, 5), dpi=300)\nvmin, vmax = 1e-1, 5e4\n\nfor day in range(num_days):\n\n\n    obs_day = obs['SF6 (fmol/L)'].isel(Date=day).values\n    obs_lat = obs['Lat'].isel(Date=day).values\n    obs_lon = obs['Long'].isel(Date=day).values\n\n    mask_valid = ~np.isnan(obs_day)\n    obs_clear = obs_day[mask_valid]\n    obs_lat = obs_lat[mask_valid]\n    obs_lon = obs_lon[mask_valid]\n\n    # Convert to numpy arrays and sort by longitude\n    lons = np.array(obs_lon)+360\n    dye_values = np.array(obs_clear)\n    sort_idx = np.argsort(lons)\n    lons_sorted = lons[sort_idx]\n    dye_sorted = dye_values[sort_idx]\n\n    # Plot\n    plt.plot(lons_sorted, dye_sorted, label=f'Day {day + 1}')\n\n# Final plot formatting\n#plt.yscale('log')\nplt.xlabel('Longitude')\nplt.ylabel('SF6 (fmol/L)')\nplt.title('SF6 vs Longitude (Days 1–7)')\nplt.legend(title='Day')\nplt.grid(True, which='both', linestyle='--', alpha=0.5)\nplt.tight_layout()\nplt.ylim([0,3000])\nplt.show()\n","key":"WIQ9c5pXIM"},{"type":"outputs","id":"wDOZk2bVW4_Hy5IC4M_Yn","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"864735bc713a26fcaa9f869e2ea4001a","path":"/864735bc713a26fcaa9f869e2ea4001a.png"},"text/plain":{"content":"<Figure size 3000x1500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"IrVEWwkxNC"}],"key":"Qa6NBYE99Z"}],"key":"EqJnVyZjyE"}],"key":"D2FqHCoiS4"},"references":{"cite":{"order":[],"data":{}}}}