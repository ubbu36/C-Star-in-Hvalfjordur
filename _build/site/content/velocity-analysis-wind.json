{"version":3,"kind":"Notebook","sha256":"4ea7eb91a73c9bc82761dec468080f00212eaaad134a2736ac1886799d2c10a5","slug":"velocity-analysis-wind","location":"/velocity_analysis-WIND.ipynb","dependencies":[],"frontmatter":{"title":"Velocity model-obs(ADCP) comparison","content_includes_title":true,"kernelspec":{"name":"roms-tools","display_name":"Python (My roms-tools Kernel)","language":"python"},"exports":[{"format":"ipynb","filename":"velocity_analysis-WIND.ipynb","url":"/velocity_analysis-WI-1582fe12d2514e3fa381f24c37279ea4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[],"key":"oPryUwBjP0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Velocity model-obs(ADCP) comparison","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fXzBHXP88p"}],"identifier":"velocity-model-obs-adcp-comparison","label":"Velocity model-obs(ADCP) comparison","html_id":"velocity-model-obs-adcp-comparison","implicit":true,"key":"iEtxVA3WHr"}],"key":"Mz2kOzJGLK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\nimport pandas as pd\nimport netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \nimport dask\nfrom scipy.interpolate import griddata\n#from ocean_c_lab_tools import *\n#from celluloid import Camera \n#import PyCO2SYS as csys\nimport seawater as sw\nfrom roms_regrid import *","key":"Ovb2X8knft"},{"type":"outputs","id":"8lOBu8RK0rmxqdmH1t3Qc","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1865397/3005166470.py:17: UserWarning: The seawater library is deprecated! Please use gsw instead.\n  import seawater as sw\n"},"children":[],"key":"KLZlwjOj9y"}],"key":"kdRv8ZuIg1"}],"key":"Ukdr8NKDdl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\n# Define file paths and station names\nstations = [\"HVIN_1\", \"HVNA_1\", \"HVNV_1\", \"HVSA_1\", \"HVSV_1\"]\nfile_paths = {name: f\"/global/cfs/cdirs/m4632/uheede/Hafro_obsdata/{name}new.nc\" for name in stations}\n\n# Dictionary to store datasets\ndatasets = {}\n\nfor name, path in file_paths.items():\n    ds = xr.open_dataset(path)\n\n    # Select valid depth bins\n    good_bins = ds['iigood'].where(ds['iigood'] < 20).to_numpy()\n    good_bins_nn = good_bins[~np.isnan(good_bins)].astype(int)\n    \n    ds = ds.isel(depth_dim=slice(np.min(good_bins_nn), np.max(good_bins_nn)))\n\n    # Store dataset with adjusted longitude\n    datasets[name] = ds.assign_coords(lon=ds['lon'].load() + 360)\n\n","key":"MfVLvDO1Fx"},{"type":"outputs","id":"LjgUz0CldE2_GbPLY-3Uv","children":[],"key":"Rjd8XcpGma"}],"key":"afTNV6qtzM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\nsubtract = 739674 - 9189  # Computed constant\nreference_date = pd.to_datetime(\"2000-01-01\")  # Reference date\n\n# Apply transformation to all datasets\nfor name, ds in datasets.items():\n    datetime_series = reference_date + pd.to_timedelta((ds['time'].values - subtract), unit='D')\n    datasets[name] = ds.assign_coords(time_dim=datetime_series)  # Update the time coordinate\n","key":"KdGzsHaJQg"},{"type":"outputs","id":"zXO7kzzhGDeBIc08oemB5","children":[],"key":"EwnzJHAeTe"}],"key":"D267E6eZmR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#model=xr.open_mfdataset('/pscratch/sd/u/uheede/Iceland3_phys_hour/z_Iceland3_MARBL_his.202305????????.nc', combine='nested', concat_dim=[\"time\"])\n#model=xr.open_mfdataset('/global/cfs/cdirs/m4746/Users/ulla/Iceland4_multidye_np4/z_Iceland4_linedye_rnd.201206*.nc', combine='nested', concat_dim=[\"time\"])\nmodel=xr.open_mfdataset('/global/cfs/cdirs/m4746/Users/ulla/Iceland3_wind_new/z_Iceland3_MARBL_rnd.20230?????????.nc', combine='nested', concat_dim=[\"time\"])","key":"H5cRUIFY8D"},{"type":"outputs","id":"kWRrqJk2Ng21Zi4eaMld9","children":[],"key":"UjyW5I8EVW"}],"key":"nIerusE9Hd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/work/Iceland3_MARBL/INPUT/Iceland3_grd.nc')\n#grid=xr.open_dataset('/global/cfs/cdirs/m4632/uheede/work/Iceland4_BGC/INPUT/Iceland4_grd.nc')","key":"v8Z1JrRSNT"},{"type":"outputs","id":"Wbp7_9RQfPpznQdLBPaew","children":[],"key":"judPS7OgtR"}],"key":"H683kS8IZB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_sub=model['u'].sel(depth=-10)\nv_sub=model['v'].sel(depth=-10)","key":"xdYOOYedvr"},{"type":"outputs","id":"UVA57qm4mX9A288I8Pomr","children":[],"key":"WuLpF6q0Bn"}],"key":"Li0hSuTlos"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_rg=roms_regrid_u(grid,u_sub)\nv_rg=roms_regrid_v(grid,v_sub)","key":"uTTZ2AsOQM"},{"type":"outputs","id":"dpvVXUNKraIYq6diYF1SN","children":[],"key":"aJudY6NOfp"}],"key":"Ylz24NtEOh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_rg.load()\nv_rg.load()","key":"rrSVOmGIJv"},{"type":"outputs","id":"-HcJuFVKKvlcxFp9qG6qS","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=dark],\nhtml[data-theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1F1F1F;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: '►';\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: '▼';\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: '(';\n}\n\n.xr-dim-list:after {\n  content: ')';\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: ',';\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (time: 2136, lat: 722, lon: 721)&gt; Size: 4GB\narray([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)\nCoordinates:\n    depth    float32 4B -10.0\n  * lon      (lon) float64 6kB 337.2 337.2 337.2 337.2 ... 338.7 338.7 338.7\n  * lat      (lat) float64 6kB 63.92 63.92 63.93 63.93 ... 64.57 64.57 64.57\nDimensions without coordinates: time\nAttributes:\n    regrid_method:  bilinear</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span>time</span>: 2136</li><li><span class='xr-has-index'>lat</span>: 722</li><li><span class='xr-has-index'>lon</span>: 721</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-7dd7052c-b42d-4816-9c13-8627deceefc0' class='xr-array-in' type='checkbox' checked><label for='section-7dd7052c-b42d-4816-9c13-8627deceefc0' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</span></div><div class='xr-array-data'><pre>array([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-dd1d99d9-567f-4496-b187-93ac843814ec' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dd1d99d9-567f-4496-b187-93ac843814ec' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>depth</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-10.0</div><input id='attrs-7a6df587-eb0c-46e6-b724-ec02ea3fb5cf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7a6df587-eb0c-46e6-b724-ec02ea3fb5cf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-69ed5563-c7f7-47d9-ab8f-90d1733e5a36' class='xr-var-data-in' type='checkbox'><label for='data-69ed5563-c7f7-47d9-ab8f-90d1733e5a36' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(-10., dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>337.2 337.2 337.2 ... 338.7 338.7</div><input id='attrs-9ca3428f-8f89-47a2-94e1-516318fb1e31' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9ca3428f-8f89-47a2-94e1-516318fb1e31' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-33b5a6a3-809f-4947-a625-61b3451cc50e' class='xr-var-data-in' type='checkbox'><label for='data-33b5a6a3-809f-4947-a625-61b3451cc50e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([337.194988, 337.197083, 337.199177, ..., 338.698729, 338.700823,\n       338.702917])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>63.92 63.92 63.93 ... 64.57 64.57</div><input id='attrs-7d04f908-5e3e-4249-bfb0-f0f3b8fac366' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7d04f908-5e3e-4249-bfb0-f0f3b8fac366' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c510953d-0ed1-4688-882b-10541404af65' class='xr-var-data-in' type='checkbox'><label for='data-c510953d-0ed1-4688-882b-10541404af65' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([63.923933, 63.924832, 63.925732, ..., 64.57059 , 64.57149 , 64.572389])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2030d180-44a6-46f8-8e22-19bce490c642' class='xr-section-summary-in' type='checkbox'  ><label for='section-2030d180-44a6-46f8-8e22-19bce490c642' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-085bc1d3-c111-4070-b83a-8e51f63d24a4' class='xr-index-data-in' type='checkbox'/><label for='index-085bc1d3-c111-4070-b83a-8e51f63d24a4' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 337.1949882266615,  337.1970825727734,  337.1991769188853,\n        337.2012712649972,  337.2033656111091,   337.205459957221,\n        337.2075543033329, 337.20964864944483, 337.21174299555673,\n       337.21383734166864,\n       ...\n       338.68406831222467, 338.68616265833657,  338.6882570044485,\n        338.6903513505604,  338.6924456966723,  338.6945400427842,\n        338.6966343888961,   338.698728735008,  338.7008230811199,\n        338.7029174272318],\n      dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=721))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-d8c68082-4adf-48bd-a970-f960b0254af2' class='xr-index-data-in' type='checkbox'/><label for='index-d8c68082-4adf-48bd-a970-f960b0254af2' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([63.923932965369254,  63.92483234964702, 63.925731733924785,\n        63.92663111820255, 63.927530502480316,  63.92842988675808,\n        63.92932927103585,  63.93022865531361,  63.93112803959138,\n       63.932027423869144,\n       ...\n        64.56429457113836,  64.56519395541612,  64.56609333969388,\n        64.56699272397165,  64.56789210824942,  64.56879149252718,\n        64.56969087680494,  64.57059026108271,  64.57148964536049,\n        64.57238902963825],\n      dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=722))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-960f95d1-9e45-482d-a572-1bde917bd48e' class='xr-section-summary-in' type='checkbox'  checked><label for='section-960f95d1-9e45-482d-a572-1bde917bd48e' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>regrid_method :</span></dt><dd>bilinear</dd></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray (time: 2136, lat: 722, lon: 721)> Size: 4GB\narray([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)\nCoordinates:\n    depth    float32 4B -10.0\n  * lon      (lon) float64 6kB 337.2 337.2 337.2 337.2 ... 338.7 338.7 338.7\n  * lat      (lat) float64 6kB 63.92 63.92 63.93 63.93 ... 64.57 64.57 64.57\nDimensions without coordinates: time\nAttributes:\n    regrid_method:  bilinear","content_type":"text/plain"}}},"children":[],"key":"xi9n6Zfveo"}],"key":"fKhkpodD6f"}],"key":"QdsUuGSySQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\nreference_date = np.datetime64('2000-01-01T00:00:00')\n\n# Convert seconds to datetime\ndatetime_array = reference_date + (model['ocean_time']).astype('timedelta64[s]')\n","key":"yBFbQbRxUY"},{"type":"outputs","id":"EvoNROJV0T1KEOK74PWil","children":[],"key":"HNkGfwkmGY"}],"key":"Ah2pNLFm4A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model['ocean_time']=datetime_array","key":"Y3XG1vDUaT"},{"type":"outputs","id":"JaOuednfWzLz-SQ6Ftax6","children":[],"key":"EyPBkP4JFa"}],"key":"bPhJIA4dMI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport xarray as xr\nfrom windrose import WindroseAxes\n\n# Define the number of stations\nnum_stations = 5\n\n# Define the observation subset time range (2024)\nobs_time_range = slice('2024-05-01', '2024-08-01')\n\n# Define the model subset time range (2023)\nmodel_time_range = slice('2023-05-05', '2023-08-05')\n\n# Create figure for timeseries plots\nfig, axs = plt.subplots(nrows=num_stations, ncols=2, figsize=(12, 3 * num_stations), sharex=False)\nfig.suptitle(\"Timeseries Comparison: Observations (2024) vs Model (2023)\", fontsize=14)\n\nfor i in range(num_stations):\n\n    # Subset observation data for 2024\n    obs=list(datasets.values())[i]\n    obs_subset = obs.sel(time_dim=obs_time_range)\n    depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n    u_obs = obs_subset['u'].isel(depth_dim=depth_index)[::6]  # Every 6th entry\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    \n    # Extract model data at station location and for the correct time range\n    u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    #u_sel = u_sel.sel(time_dim=model_time_range)  # Select only 2023 data\n\n    # Plot observations (2024)\n    axs[i, 0].plot(obs_subset.time_dim[::6], u_obs, label=\"Observed U (2024)\", color=\"blue\")\n    axs[i, 0].set_title(f\"Station {i+1} - Observations (2024)\")\n    axs[i, 0].tick_params(axis='x', rotation=45)\n    axs[i, 0].legend()\n    \n    # Plot model (2023)\n    axs[i, 1].plot(model['ocean_time'], u_sel.squeeze(), label=\"Model U (2023)\", color=\"green\")\n    axs[i, 1].set_title(str(stations[i])+' - Model (2023)')\n    axs[i, 1].tick_params(axis='x', rotation=45)\n    axs[i, 1].legend()\n\nplt.tight_layout()\nplt.show()\n\n\n","key":"N2PUmKK5jY"},{"type":"outputs","id":"hhhCTimuVt8Z6BaT2ZnJc","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"803f3429217c3568ba9b910a28a389e6","path":"/803f3429217c3568ba9b910a28a389e6.png"},"text/plain":{"content":"<Figure size 1200x1500 with 10 Axes>","content_type":"text/plain"}}},"children":[],"key":"Tj4raZseeB"}],"key":"PIRPMqwOJQ"}],"key":"lkDsKONj2J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"obs.lat","key":"Xaz0eUG6P2"},{"type":"outputs","id":"o_wz5prtpx0jGQ1_xn3BK","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=dark],\nhtml[data-theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1F1F1F;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: '►';\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: '▼';\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: '(';\n}\n\n.xr-dim-list:after {\n  content: ')';\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: ',';\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;lat&#x27; (lat_dim: 1)&gt; Size: 8B\narray([64.299167])\nDimensions without coordinates: lat_dim</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'lat'</div><ul class='xr-dim-list'><li><span>lat_dim</span>: 1</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-1744b861-5af3-4226-a5bf-3551120990ba' class='xr-array-in' type='checkbox' checked><label for='section-1744b861-5af3-4226-a5bf-3551120990ba' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>64.3</span></div><div class='xr-array-data'><pre>array([64.299167])</pre></div></div></li><li class='xr-section-item'><input id='section-b8fb2907-9465-4aee-a463-1f799acc1477' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b8fb2907-9465-4aee-a463-1f799acc1477' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-3cc67df3-d32e-4f92-a4ad-61ebdb13ec09' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-3cc67df3-d32e-4f92-a4ad-61ebdb13ec09' class='xr-section-summary'  title='Expand/collapse section'>Indexes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-5d758c2e-464f-4c61-a438-277a53b8b9bc' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-5d758c2e-464f-4c61-a438-277a53b8b9bc' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray 'lat' (lat_dim: 1)> Size: 8B\narray([64.299167])\nDimensions without coordinates: lat_dim","content_type":"text/plain"}}},"children":[],"key":"tWJYz5xvXA"}],"key":"q70bvQiHbQ"}],"key":"BBbhVPeFFb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom windrose import WindroseAxes\n\n# Define number of stations\nnum_stations = 1\n\n# Create a figure with 2 columns (Obs & Model) and num_stations rows\nfig = plt.figure(figsize=(14, 7 * num_stations),layout='tight')\n\nfig.suptitle(\"Wind Roses: Observations (2024) vs Model (2023)\", fontsize=16)\n\nfor i in range(1):\n\n    # Compute observed wind speed and direction\n    obs=list(datasets.values())[i]\n    obs_subset = obs.sel(time_dim=obs_time_range)\n    depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n    u_obs = obs_subset['u'].sel(depth_dim=depth_index)[::6]\n    v_obs = obs_subset['v'].sel(depth_dim=depth_index)[::6]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    direction_obs = (np.arctan2(-u_obs.squeeze().values, -v_obs.squeeze().values) * (180 / np.pi) + 360) % 360\n    speed_obs = np.sqrt(u_obs.squeeze().values**2 + v_obs.squeeze().values**2)\n\n    # Compute model wind speed and direction\n    u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    v_sel = v_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    \n    direction_model = (np.arctan2(-u_sel.squeeze().values, -v_sel.squeeze().values) * (180 / np.pi) + 360) % 360\n    speed_model = np.sqrt(u_sel.squeeze().values**2 + v_sel.squeeze().values**2)\n\n    # Define subplot positions using bbox (left, bottom, width, height)\n    ax_obs = WindroseAxes(fig, [0.05, 0.75 - (i * 0.2), 0.4, 0.18])  # Left column\n    fig.add_axes(ax_obs)\n    ax_obs.bar(direction_obs, speed_obs, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n    ax_obs.set_title(f\"Station {i+1} - Obs (2024)\", fontsize=12)\n    ax_obs.set_legend()\n    ax_obs.set_rticks([5, 10, 15, 20, 25, 30])\n    ax_obs.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n    \n    ax_model = WindroseAxes(fig, [0.55, 0.75 - (i * 0.2), 0.4, 0.18])  # Right column\n    fig.add_axes(ax_model)\n    ax_model.bar(direction_model, speed_model, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n    ax_model.set_title(f\"Station {i+1} - Model (2023)\", fontsize=12)\n    ax_model.set_legend()\n    ax_model.set_rticks([5, 10, 15, 20, 25, 30])\n    ax_model.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\nplt.show()\n","key":"VmeKQZq7Dn"},{"type":"outputs","id":"ndlwYw3Y1-VpHZJHkGNNA","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/global/homes/u/uheede/.conda/envs/xesmf_env/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.canvas.print_figure(bytes_io, **kw)\n"},"children":[],"key":"N4rk4YwPa1"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eff95c2eb3e55ebe93fb6f06c14c1d71","path":"/eff95c2eb3e55ebe93fb6f06c14c1d71.png"},"text/plain":{"content":"<Figure size 1400x700 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"tL6AZ2gz5B"}],"key":"czLl1kpnq9"}],"key":"gKZ7MzrGEf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.signal import find_peaks\n\ndef compute_spectrum(time, signal):\n    \"\"\"Compute the FFT and identify spectral peaks.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step (assuming uniform spacing)\n    freq = np.fft.rfftfreq(n, d=dt)  # Compute frequency axis\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n    power = np.abs(spectrum)**2      # Compute Power Spectral Density (PSD)\n    \n    # Find peaks in the power spectrum\n    peaks, _ = find_peaks(power, height=np.max(power) * 0.1)  # Peaks with at least 10% of max power\n    \n    return freq, power, peaks\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\n\n# Example time series (Replace these with your observed and modeled data)\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).load().values\n# Define reference time (2000-01-01T00:00:00)\n\n\n\nmodel_time = (model['ocean_time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\nobs_time=(obs_time-obs_time[0])*10**(-9)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-9)*1/3600\n\nobserved_signal = u_obs.squeeze().values  # Example signal\nmodeled_signal = u_sel.squeeze().values # Example signal\n\n# Compute spectra\nfreq_obs, power_obs, peaks_obs = compute_spectrum(obs_time, observed_signal)\nfreq_mod, power_mod, peaks_mod = compute_spectrum(model_time, modeled_signal)\n\n# Plot results\nplt.figure(figsize=(10, 5))\n\n# Observed Spectrum\nplt.plot(freq_obs, power_obs, label=\"Observed Spectrum\", color='b')\nplt.scatter(freq_obs[peaks_obs], power_obs[peaks_obs], color='r', label=\"Observed Peaks\", zorder=3)\n\n# Modeled Spectrum\nplt.plot(freq_mod, power_mod, label=\"Modeled Spectrum\", color='g', linestyle='dashed')\nplt.scatter(freq_mod[peaks_mod], power_mod[peaks_mod], color='orange', label=\"Modeled Peaks\", zorder=3)\n\nplt.xlabel(\"Frequency (Hz)\")\nplt.ylabel(\"Power\")\nplt.legend()\nplt.title(\"Spectral Peaks in Observed and Modeled Data\")\nplt.grid()\nplt.show()\n\n","key":"xy5Nwx1DGA"},{"type":"outputs","id":"vPr6mDuKaSUVY0Yx0bded","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1865397/567341843.py:22: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  obs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).load().values\n/tmp/ipykernel_1865397/567341843.py:27: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\n/tmp/ipykernel_1865397/567341843.py:27: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\n"},"children":[],"key":"hvZNjZ0hV6"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2c24083c1c47c453abf686cf61961ddf","path":"/2c24083c1c47c453abf686cf61961ddf.png"},"text/plain":{"content":"<Figure size 1000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"JRKLwsmjjp"}],"key":"f6jKh3qXFU"}],"key":"Z7RhQoeGTV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"observed_signal","key":"DoGy6OTJod"},{"type":"outputs","id":"Gbi0oR8b2iudFZvbIX3Cs","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"array([ 0.   , -0.042, -0.025, ...,  0.084,  0.067,  0.062])","content_type":"text/plain"}}},"children":[],"key":"uyuhEshQUz"}],"key":"XwUbGPR4I8"}],"key":"pNOvdXyxdN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"obs_time","key":"Qp7ybTxiS5"},{"type":"outputs","id":"DrhNHeGzaD7l17XVckZ1w","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"array([0.000e+00, 0.000e+00, 2.000e+00, ..., 2.229e+03, 2.229e+03,\n       2.231e+03])","content_type":"text/plain"}}},"children":[],"key":"OqxUQqaHCM"}],"key":"xi7YDqjl9b"}],"key":"CAE0Nj2551"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.signal import find_peaks\n\ndef compute_spectrum(time, signal):\n    \"\"\"Compute the FFT and identify spectral peaks.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step (assuming uniform spacing)\n    freq = np.fft.rfftfreq(n, d=dt)  # Compute frequency axis\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n    power = np.abs(spectrum)**2      # Compute Power Spectral Density (PSD)\n    \n    # Find peaks in the power spectrum\n    peaks, _ = find_peaks(power, height=np.max(power) * 0.1)  # Peaks with at least 10% of max power\n    \n    return freq, power, peaks\n\n# Reference time\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\n\n# Convert time to hours\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\nmodel_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\nobs_time=(obs_time-obs_time[0])*10**(-9)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-9)*1/3600\n\n# Example signals\nobserved_signal = u_obs.squeeze().values  \nmodeled_signal = u_sel.squeeze().values  \n\n# Compute spectra\nfreq_obs, power_obs, peaks_obs = compute_spectrum(obs_time, observed_signal)\nfreq_mod, power_mod, peaks_mod = compute_spectrum(model_time, modeled_signal)\n\n# Convert frequency to period (avoid division by zero)\nperiod_obs = 1 / freq_obs[1:]  # Ignore first value to avoid division by zero\nperiod_mod = 1 / freq_mod[1:]\n\n# Plot results\nplt.figure(figsize=(10, 5))\n\n# Observed Spectrum\nplt.plot(period_obs, power_obs[1:], label=\"Observed Spectrum\", color='b')\n#plt.scatter(period_obs[peaks_obs - 1], power_obs[peaks_obs][1:], color='r', label=\"Observed Peaks\", zorder=3)\n\n# Modeled Spectrum\nplt.plot(period_mod, power_mod[1:], label=\"Modeled Spectrum\", color='g', linestyle='dashed')\n#plt.scatter(period_mod[peaks_mod - 1], power_mod[peaks_mod][1:], color='orange', label=\"Modeled Peaks\", zorder=3)\n\n#plt.xscale(\"log\")  # Log scale to better show long periods\nplt.xlabel(\"Period (hours)\")\nplt.ylabel(\"Power\")\nplt.legend()\nplt.title(\"Spectral Peaks in Observed and Modeled Data\")\nplt.grid(which=\"both\", linestyle=\"--\", linewidth=0.5)\nplt.gca().invert_xaxis()  # Invert x-axis so long periods are on the right\nplt.xlim(1,50)\nplt.show()\n","key":"rCDdhJVwG0"},{"type":"outputs","id":"-UQfOwE5hPcd2tGGLeNm9","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1865397/2513204617.py:24: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  obs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\n/tmp/ipykernel_1865397/2513204617.py:25: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\n"},"children":[],"key":"YkCCTMf2H3"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"424f78dee26a0643b892483ba2761e14","path":"/424f78dee26a0643b892483ba2761e14.png"},"text/plain":{"content":"<Figure size 1000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"qzRXpoZynp"}],"key":"E8Zhc8b4P5"}],"key":"skd0nSQ4rk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef bandpass_filter(time, signal, min_period=10, max_period=15):\n    \"\"\"Filter the signal to retain only frequencies corresponding to periods between min_period and max_period hours.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Convert periods to frequencies\n    min_freq = 1 / max_period  # Lower cutoff frequency\n    max_freq = 1 / min_period  # Upper cutoff frequency\n\n    # Zero out frequencies outside the band\n    spectrum[(freq < min_freq) | (freq > max_freq)] = 0\n\n    # Inverse FFT to reconstruct filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Convert time to hours since reference time\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\nmodel_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\nobs_time=(obs_time-obs_time[0])*10**(-9)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-9)*1/3600\n\n# Apply band-pass filter\nu_obs_filtered = bandpass_filter(obs_time, u_obs.squeeze().values, min_period=10, max_period=15)\nu_model_filtered = bandpass_filter(model_time, u_sel.squeeze().values, min_period=10, max_period=15)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot filtered observed signal\naxs[0].plot(obs_time, u_obs_filtered, label=\"Filtered Observed (10-15h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"Filtered Observed u_obs (10-15h Period)\")\naxs[0].legend()\naxs[0].grid()\n\n# Plot filtered modeled signal\naxs[1].plot(model_time, u_model_filtered, label=\"Filtered Modeled (10-15h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_title(\"Filtered Modeled u_model (10-15h Period)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"ho1efHpJco"},{"type":"outputs","id":"FH7Qyr3g_QQPcraid_jBV","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1865397/2325760596.py:27: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  obs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\n/tmp/ipykernel_1865397/2325760596.py:28: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\n"},"children":[],"key":"bBCFViDwxg"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b42e14a321a69327df6198c0f890232a","path":"/b42e14a321a69327df6198c0f890232a.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"HfgTsPgak0"}],"key":"HTGl2uCS96"}],"key":"pCtPgQnax6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef highpass_filter(time, signal, cutoff_period=10):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (high-pass filter).\"\"\"\n\n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  # Frequency corresponding to the longest period to keep\n\n    # Zero out frequencies below the cutoff (i.e., remove long periods)\n    spectrum[freq < cutoff_freq] = 0\n\n    # Inverse FFT to reconstruct the high-pass filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Apply high-pass filter (removing periods ≥ 10 hours)\nu_obs_highpass = highpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=10)\nu_model_highpass = highpass_filter(model_time, u_sel.squeeze().values, cutoff_period=10)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot high-pass filtered observed signal\naxs[0].plot(obs_time, u_obs_highpass, label=\"Observed (Periods < 10h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"High-Pass Filtered Observed u_obs (Periods < 10h)\")\naxs[0].legend()\naxs[0].grid()\naxs[0].set_xlabel(\"Time (hours)\")\n\n# Plot high-pass filtered modeled signal\naxs[1].plot(model_time, u_model_highpass, label=\"Modeled (Periods < 10h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_title(\"High-Pass Filtered Modeled u_model (Periods < 10h)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"tpdXRXZkix"},{"type":"outputs","id":"9nb5JATOuJ-X08sDVzHwU","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7c92803ae5c3b18f9f3a47f2716b7e0b","path":"/7c92803ae5c3b18f9f3a47f2716b7e0b.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"RKlWOOpP9q"}],"key":"BD03wbgbtN"}],"key":"hBN6qlXRBl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef lowpass_filter(time, signal, cutoff_period=15):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (high-pass filter).\"\"\"\n\n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  # Frequency corresponding to the longest period to keep\n\n    # Zero out frequencies below the cutoff (i.e., remove long periods)\n    spectrum[freq > cutoff_freq] = 0\n\n    # Inverse FFT to reconstruct the high-pass filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Apply high-pass filter (removing periods ≥ 10 hours)\nu_obs_lowpass = lowpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=15)\nu_model_lowpass = lowpass_filter(model_time, u_sel.squeeze().values, cutoff_period=15)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot high-pass filtered observed signal\naxs[0].plot(obs_time, u_obs_lowpass, label=\"Observed (Periods > 15h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"Low-Pass Filtered Observed u_obs (Periods > 15h)\")\naxs[0].legend()\naxs[0].grid()\naxs[0].set_xlabel(\"Time (hours)\")\n\n# Plot high-pass filtered modeled signal\naxs[1].plot(model_time, u_model_lowpass, label=\"Modeled (Periods > 15h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_title(\"Low-Pass Filtered Modeled u_model (Periods > 15h)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"b1QyZwij1Z"},{"type":"outputs","id":"Nb85A7IkwWayTvIgZ_t1E","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"38e9b4e15b5d1c9f8827925b312cd811","path":"/38e9b4e15b5d1c9f8827925b312cd811.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"hSPdqcxfvx"}],"key":"vK5MIuV7zy"}],"key":"WGjlqscgEZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef bandpass_filter(time, signal, low_cutoff=10, high_cutoff=15):\n    \"\"\"Apply a bandpass filter to retain frequencies between `low_cutoff` and `high_cutoff` hours.\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequencies\n    low_freq = 1 / high_cutoff\n    high_freq = 1 / low_cutoff\n\n    # Zero out frequencies outside the band\n    spectrum[(freq < low_freq) | (freq > high_freq)] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\ndef highpass_filter(time, signal, cutoff_period=10):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (retain high frequencies).\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  \n\n    # Zero out frequencies below the cutoff (remove long periods)\n    spectrum[freq < cutoff_freq] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\ndef lowpass_filter(time, signal, cutoff_period=15):\n    \"\"\"Remove frequencies with periods shorter than `cutoff_period` hours (retain low frequencies).\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  \n\n    # Zero out frequencies above the cutoff (remove short periods)\n    spectrum[freq > cutoff_freq] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\n# Apply filters to observed and modeled data\nu_obs_bandpass = bandpass_filter(obs_time, u_obs.squeeze().values, low_cutoff=10, high_cutoff=15)\nu_model_bandpass = bandpass_filter(model_time, u_sel.squeeze().values, low_cutoff=10, high_cutoff=15)\n\nu_obs_highpass = highpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=10)\nu_model_highpass = highpass_filter(model_time, u_sel.squeeze().values, cutoff_period=10)\n\nu_obs_lowpass = lowpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=15)\nu_model_lowpass = lowpass_filter(model_time, u_sel.squeeze().values, cutoff_period=15)\n\n# Prepare data for boxplot\ndata = [\n    u_obs_bandpass, u_model_bandpass,\n    u_obs_highpass, u_model_highpass,\n    u_obs_lowpass, u_model_lowpass\n]\n\nlabels = [\n    \"Obs Bandpass (10-15h)\", \"Model Bandpass (10-15h)\",\n    \"Obs High-pass (>10h)\", \"Model High-pass (<10h)\",\n    \"Obs Low-pass (<15h)\", \"Model Low-pass (>15h)\"\n]\n\n# Define colors (Obs = Light Green, Model = Light Blue)\ncolors = ['lightgreen', 'lightblue', 'lightgreen', 'lightblue', 'lightgreen', 'lightblue']\n\n# Create boxplot\nfig, ax = plt.subplots(figsize=(10, 6))\nboxplot = ax.boxplot(data, labels=labels, patch_artist=True, medianprops=dict(color=\"red\"))\n\n# Apply colors to boxes\nfor patch, color in zip(boxplot['boxes'], colors):\n    patch.set_facecolor(color)\n    patch.set_alpha(0.6)  # Transparency for better readability\n\nax.set_ylabel(\"Velocity (m/s)\")\nax.set_title(\"Boxplot of Filtered Velocity Components\")\n\nplt.xticks(rotation=20)  # Rotate labels for better readability\nplt.grid(axis='y', linestyle='--', alpha=0.6)\n\nplt.show()\n","key":"KalmxXsKdZ"},{"type":"outputs","id":"8EVKnSk4_G3cBUbY7KKpG","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1865397/384995258.py:78: MatplotlibDeprecationWarning: The 'labels' parameter of boxplot() has been renamed 'tick_labels' since Matplotlib 3.9; support for the old name will be dropped in 3.11.\n  boxplot = ax.boxplot(data, labels=labels, patch_artist=True, medianprops=dict(color=\"red\"))\n"},"children":[],"key":"oaaD1ynLaA"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0e1f1985f35d1c9c7318d00bbe8d0d94","path":"/0e1f1985f35d1c9c7318d00bbe8d0d94.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"r3Sjl2fjwn"}],"key":"mJ3s6j8ydd"}],"key":"DfZhsswUTp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#model=xr.open_mfdataset('/pscratch/sd/u/uheede/Iceland3_riv/z_Iceland3_MARBL_rnd.20230[5-6]????????.nc', combine='nested', concat_dim=[\"time\"])\n\n","key":"tLXVpfjMwB"},{"type":"outputs","id":"hQQ-sVAtY-tEZBrMRVEuP","children":[],"key":"zAgj3amGRA"}],"key":"JiCassgUBg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#u=model['u'].sel(depth=[-0,-1,-2,-3,-4,-5,-7,-9,-10,-12,-14,-15,-16,-18,-20,-26,-30,-36,-40,-50,-80]).mean('time')\n#v=model['v'].sel(depth=[-0,-1,-2,-3,-4,-5,-7,-9,-10,-12,-14,-15,-16,-18,-20,-26,-30,-36,-40,-50,-80]).mean('time')\n\n#u=roms_regrid_u(grid,u)\n#v=roms_regrid_v(grid,v)\n#mask=roms_regrid(grid,grid['mask_rho'])\n\n\n","key":"uMO5jfeAFP"},{"type":"outputs","id":"srHWL3qPBDOyv_xkdgTUc","children":[],"key":"WkV3aJ0zir"}],"key":"PsYL3nVO8q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#u.load()\n#t.to_netcdf('/global/cfs/cdirs/m4746/Users/ulla/run/Iceland3_MARBL/t_06.nc')\n;","key":"levb6RWFz5"},{"type":"outputs","id":"qHnEKpEVs2Jha6Vpbt2tx","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/plain":{"content":"''","content_type":"text/plain"}}},"children":[],"key":"w862P0dsLs"}],"key":"LkvZGkuxMT"}],"key":"qbDrls3nc2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#v.load()","key":"t6zwihcFxg"},{"type":"outputs","id":"W1ChfmcsEFLHPDnagqbMB","children":[],"key":"e1AVwTo9M7"}],"key":"kXHCLS8jRT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"datasets","key":"xZo3xLPjAY"},{"type":"outputs","id":"OGc_fvafwUiSREgtyUm2K","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"{'HVIN_1': <xarray.Dataset> Size: 6MB\n Dimensions:   (time_dim: 19068, depth_dim: 12, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.5\n   * time_dim  (time_dim) datetime64[ns] 153kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 153kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 96B ...\n     lat       (lat_dim) float64 8B 64.38\n     u         (depth_dim, time_dim) float64 2MB ...\n     v         (depth_dim, time_dim) float64 2MB ...\n     w         (depth_dim, time_dim) float64 2MB ...\n     iigood    (depth_dim) float64 96B 2.0 3.0 4.0 5.0 ... 10.0 11.0 12.0 13.0,\n 'HVNA_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19058, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.3\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B 64.37\n     u         (depth_dim, time_dim) float64 610kB ...\n     v         (depth_dim, time_dim) float64 610kB ...\n     w         (depth_dim, time_dim) float64 610kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0,\n 'HVNV_1': <xarray.Dataset> Size: 3MB\n Dimensions:   (time_dim: 19030, depth_dim: 5, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.1\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 40B ...\n     lat       (lat_dim) float64 8B 64.31\n     u         (depth_dim, time_dim) float64 761kB ...\n     v         (depth_dim, time_dim) float64 761kB ...\n     w         (depth_dim, time_dim) float64 761kB ...\n     iigood    (depth_dim) float64 40B 2.0 3.0 4.0 5.0 6.0,\n 'HVSA_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19054, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.3\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B 64.36\n     u         (depth_dim, time_dim) float64 610kB ...\n     v         (depth_dim, time_dim) float64 610kB ...\n     w         (depth_dim, time_dim) float64 610kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0,\n 'HVSV_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19108, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.1\n   * time_dim  (time_dim) datetime64[ns] 153kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 153kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B 64.3\n     u         (depth_dim, time_dim) float64 611kB ...\n     v         (depth_dim, time_dim) float64 611kB ...\n     w         (depth_dim, time_dim) float64 611kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0}","content_type":"text/plain"}}},"children":[],"key":"QB70EkUU3g"}],"key":"YXcRc5viR0"}],"key":"OhyIhRqfk2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"ExqKbLWIhS"},{"type":"outputs","id":"3W9R7wVW2pVOTNizcbxdc","children":[],"key":"ZViE5695n7"}],"key":"TXDrOseMbD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"obs=list(datasets.values())[1]\n\nplt.plot(obs['u'].mean('time_dim').squeeze(),obs.depth)\nplt.gca().invert_yaxis()\n\nu_sel = u.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\nplt.plot(u_sel.squeeze(),u.depth*(-1))","key":"aO0wrBtv1e"},{"type":"outputs","id":"HKMzTWiXEVtEUdLj0hPTG","children":[{"type":"output","jupyter_data":{"ename":"NameError","evalue":"name 'u' is not defined","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)\nCell \u001b[0;32mIn[27], line 6\u001b[0m\n\u001b[1;32m      3\u001b[0m plt\u001b[38;5;241m.\u001b[39mplot(obs[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mu\u001b[39m\u001b[38;5;124m'\u001b[39m]\u001b[38;5;241m.\u001b[39mmean(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mtime_dim\u001b[39m\u001b[38;5;124m'\u001b[39m)\u001b[38;5;241m.\u001b[39msqueeze(),obs\u001b[38;5;241m.\u001b[39mdepth)\n\u001b[1;32m      4\u001b[0m plt\u001b[38;5;241m.\u001b[39mgca()\u001b[38;5;241m.\u001b[39minvert_yaxis()\n\u001b[0;32m----> 6\u001b[0m u_sel \u001b[38;5;241m=\u001b[39m \u001b[43mu\u001b[49m\u001b[38;5;241m.\u001b[39msel(lon\u001b[38;5;241m=\u001b[39mobs_lon\u001b[38;5;241m.\u001b[39mvalues, method\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mnearest\u001b[39m\u001b[38;5;124m'\u001b[39m)\u001b[38;5;241m.\u001b[39msel(lat\u001b[38;5;241m=\u001b[39mobs_lat\u001b[38;5;241m.\u001b[39mvalues, method\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mnearest\u001b[39m\u001b[38;5;124m'\u001b[39m)\n\u001b[1;32m      7\u001b[0m plt\u001b[38;5;241m.\u001b[39mplot(u_sel\u001b[38;5;241m.\u001b[39msqueeze(),u\u001b[38;5;241m.\u001b[39mdepth\u001b[38;5;241m*\u001b[39m(\u001b[38;5;241m-\u001b[39m\u001b[38;5;241m1\u001b[39m))\n\n\u001b[0;31mNameError\u001b[0m: name 'u' is not defined"},"children":[],"key":"XYNcBPCGVn"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7ebc2aba575146a7c8a2b7183bef8daa","path":"/7ebc2aba575146a7c8a2b7183bef8daa.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"Nq1RgulyxW"}],"key":"d3FQ5ncblz"}],"key":"nbyYMmt0GZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Create figure and subplots\nfig, axes = plt.subplots(nrows=1, ncols=5, figsize=(20, 5), sharey=True)\n\n# Loop through each dataset and create a subplot\nfor i, (key, obs) in enumerate(datasets.items()):\n    ax = axes[i]  # Select subplot\n    obs=list(datasets.values())[i]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    # Plot observed profile\n    ax.plot(obs['u'].mean('time_dim').squeeze(), obs.depth, label=\"Observed\", color='b')\n\n    # Extract nearest model data\n    u_sel = u.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n\n    # Plot modeled profile\n    ax.plot(u_sel.squeeze(), u.depth * (-1), label=\"Modeled\", color='r')\n\n    # Reverse y-axis\n    ax.invert_yaxis()\n\n    # Titles and labels\n    ax.set_title(f\"Station {i+1}\")\n    if i == 0:\n        ax.set_ylabel(\"Depth (m)\")\n    ax.set_xlabel(\"Velocity (m/s)\")\n    ax.legend()\n\nplt.tight_layout()\nplt.show()\n","key":"dQiuOWy0Vs"},{"type":"outputs","id":"KEMGKRbZ6PSu26G4PDXgb","children":[],"key":"ZVVT5nq8y2"}],"key":"ZIsGY09cbD"}],"key":"bUTmc7jbkm"},"references":{"cite":{"order":[],"data":{}}}}