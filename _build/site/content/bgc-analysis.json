{"version":3,"kind":"Notebook","sha256":"e928d52e6394999e105cbee20e16be15810a7177c52ddeb9ee9d62068a32e778","slug":"bgc-analysis","location":"/BGC_analysis.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"xesmf_env","display_name":"xesmf_env","language":"python"},"exports":[{"format":"ipynb","filename":"BGC_analysis.ipynb","url":"/BGC_analysis-20277d9224e744f6071f55024d4ebf54.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\nimport pandas as pd\n#import netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \nimport dask\nfrom scipy.interpolate import griddata\n#from ocean_c_lab_tools import *\n#from celluloid import Camera \n#import PyCO2SYS as csys\nimport seawater as sw\nfrom roms_regrid import *","visibility":"show","key":"dCYmjIxVn2"},{"type":"outputs","id":"J_xnSeZOEMiF6KgW6FG7f","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1590548/3945946454.py:17: UserWarning: The seawater library is deprecated! Please use gsw instead.\n  import seawater as sw\n"},"children":[],"key":"I0DHh8imWg"}],"visibility":"show","key":"cVK0JuXemm"}],"visibility":"show","key":"CNNTzQT3MN"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"xls = pd.ExcelFile('/global/cfs/cdirs/m4632/uheede/Hafro_obsdata/20241210_biogeochemistry_format.xlsx')\ncombo = pd.read_excel(xls, 'Sheet1',decimal='.')\n\n\nobs=xr.Dataset.from_dataframe(combo)\nobs=obs.set_index(index=['HV','depth_bin','date'])\nobs=obs.drop_duplicates('index')\nobs=obs.unstack('index')\nobs=obs.rename(name_dict={'Latitude(°N)':'lat','Longitude(°E)':'lon'})\n\n","visibility":"show","key":"nFcuX2czBp"},{"type":"outputs","id":"B8MPixuf7Gh7Y_HBDjPbS","children":[],"visibility":"show","key":"BHwijlRgIS"}],"visibility":"show","key":"GRMtMTsnq1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"density=sw.dens0(obs['S'],obs['T'])\nobs['Alk']=obs['TA'] * (1 / 1000) * density\nobs['DIC']=obs['DIC'] * (1 / 1000) * density","visibility":"show","key":"Tdtnj7tYXF"},{"type":"outputs","id":"tohVtdHWtMLupV-o-oh7R","children":[],"visibility":"show","key":"IB8b1ANHwC"}],"visibility":"show","key":"FeFpvuM0o9"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"TA0=274\nSref=34\nDIC0=315\nnTA=((obs['Alk']-TA0)/obs['S'])*Sref+TA0\n\nnDIC=((obs['DIC']-DIC0)/obs['S'])*Sref+DIC0","visibility":"show","key":"Vh9tMY6mjY"},{"type":"outputs","id":"PE47zipCSVK2sKAtvC1Eq","children":[],"visibility":"show","key":"mCagX19Pnu"}],"visibility":"show","key":"PR0A1dTElA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# define location which calculations the average location of each station\ndef get_location(obs, hv_values):\n    locations = []\n    for hv in hv_values:\n        lat = (obs['lat'].sel(HV=hv).isel(depth_bin=0).mean('date').squeeze()).values+0\n        lon = obs['lon'].sel(HV=hv).isel(depth_bin=0).mean('date').squeeze().values + 360\n        locations.append([lat, lon])\n    return locations\n\n# List of HV values\nhv_values = 1,3,5,7,9,10,12\n\n# Get the locations\nlocations = get_location(obs, hv_values)","visibility":"show","key":"JBRYARRLGn"},{"type":"outputs","id":"gTnGJVKtIN-imNCbB32A8","children":[],"visibility":"show","key":"e76ihroiHW"}],"visibility":"show","key":"FurGUwNyne"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"","visibility":"show","key":"Rp6lSLN4uY"},{"type":"outputs","id":"K9NkpnUzFFpehLwqzXIH8","children":[],"visibility":"show","key":"BbcodS9dVo"}],"visibility":"show","key":"dCEznBFnw0"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"\n#x=xr.open_mfdataset('/pscratch/sd/u/uheede/from_expanse/Iceland3/*', combine='nested', concat_dim=[\"time\"])\n\n# open grid\ngrid=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/roms_setups/Iceland3_MARBL/1.Make_grid/Iceland3_grd.nc')\n\n\n\n# regridding\nh=roms_regrid(grid,grid['h'])\n\nmask=roms_regrid(grid,grid['mask_rho'])\n\n;","visibility":"show","key":"bh7NNL4eT2"},{"type":"outputs","id":"hM_kBbx0O5N1IzDVHc6bm","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"''","content_type":"text/plain"}}},"children":[],"key":"TULPHKiMkW"}],"visibility":"show","key":"QXKHjg2OCc"}],"visibility":"show","key":"MkEM9jjVBo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Define depth levels\nlevels = np.arange(0, 80)\n\n# Create figure and subplots\nfig = plt.figure(figsize=(8, 13))\ngs = fig.add_gridspec(4, 1, height_ratios=[2, 1, 1, 1])\n\n# Main map plot\nax = fig.add_subplot(gs[0], projection=ccrs.PlateCarree())\nax2 = fig.add_subplot(gs[1])\nax3 = fig.add_subplot(gs[2])\nax4 = fig.add_subplot(gs[3])\n\n# Plot bathymetry\ncf1 = ax.contourf(h.lon, h.lat, h, levels, transform=ccrs.PlateCarree(), cmap='cividis')\nax.contourf(h.lon, h.lat, mask.where(mask != 1), cmap='Greys', transform=ccrs.PlateCarree())\n\n# Add station labels\nfor i, e in enumerate(locations):\n    ax.text(e[1], e[0], hv_values[i], color='red', size=10, ha='center', va='center', transform=ccrs.PlateCarree())\n\n# Gridlines\ngls = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True, color='darkgray', alpha=0.5, linestyle='--')\ngls.top_labels = False\ngls.right_labels = False\n\n# Colorbar\ncb1 = plt.colorbar(cf1, shrink=0.3)\ncb1.set_label('Bottom Depth (m)', fontsize=10)\n\nax.set_extent([-22, -21.35, 64.25, 64.45], ccrs.PlateCarree())\nax.set_title('Station Overview')\n\n# --- Boxplot Data Preparation ---\ndef extract_cruise_data(var, depth=None, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across cruises.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth_bin=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- Salinity Normalized DIC Variation ---\nax2.boxplot(extract_cruise_data(nTA), patch_artist=True)\nax2.set_title('Salinity Normalized Alk Variation')\nax2.set_ylabel('mmol/m$^3$')\nax2.set_xticklabels([])\n\n# --- Total DIC Variation ---\nax3.boxplot(extract_cruise_data(obs['Alk']), patch_artist=True)\nax3.set_title('Total Alk Variation')\nax3.set_ylabel('mmol/m$^3$')\nax3.set_xticklabels([])\n\n# --- Surface-Only Salinity Normalized DIC ---\nax4.boxplot(extract_cruise_data(nTA, depth=0), patch_artist=True)\nax4.set_title('Salinity Normalized Alk, Surface Only')\nax4.set_xlabel('Cruise')\nax4.set_ylabel('mmol/m$^3$')\nax4.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nplt.show()\n","key":"NRt23mltqx"},{"type":"outputs","id":"q60rePtfj6cJVf5yqfYXN","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"294afdbd4155965b596cd5615765cf5e","path":"/294afdbd4155965b596cd5615765cf5e.png"},"text/plain":{"content":"<Figure size 800x1300 with 5 Axes>","content_type":"text/plain"}}},"children":[],"key":"MoGiR5h0pQ"}],"key":"ijFiEp1KzO"}],"key":"alMi62jmat"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(2290,2360,2)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=nTA.sel(HV=[1,5,9,10]).isel(date=slice(0,9)).mean('date')\ndata_alk2=obs['Alk'].sel(HV=[1,5,9,10]).isel(date=slice(0,9)).mean('date')\n\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(6*2, 3), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].invert_yaxis()\nax[0].set_title('salinity normalized alkalinity along fjord')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\nc0=ax[1].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].invert_yaxis()\nax[1].set_title('alkalinity along fjord')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')","key":"guBJyXpimJ"},{"type":"outputs","id":"OQTNXBmJGlM3amYoo6opE","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b42248f3b901ba985314e1b32e525a25","path":"/b42248f3b901ba985314e1b32e525a25.png"},"text/plain":{"content":"<Figure size 1200x300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"ATwcI8DinU"}],"key":"udjiWk4mPG"}],"key":"S55fjX0sba"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Define depth levels\nlevels = np.arange(0, 80)\n\n# Create figure and subplots\nfig = plt.figure(figsize=(8, 13))\ngs = fig.add_gridspec(4, 1, height_ratios=[2, 1, 1, 1])\n\n# Main map plot\nax = fig.add_subplot(gs[0], projection=ccrs.PlateCarree())\nax2 = fig.add_subplot(gs[1])\nax3 = fig.add_subplot(gs[2])\nax4 = fig.add_subplot(gs[3])\n\n# Plot bathymetry\ncf1 = ax.contourf(h.lon, h.lat, h, levels, transform=ccrs.PlateCarree(), cmap='cividis')\nax.contourf(h.lon, h.lat, mask.where(mask != 1), cmap='Greys', transform=ccrs.PlateCarree())\n\n# Add station labels\nfor i, e in enumerate(locations):\n    ax.text(e[1], e[0], hv_values[i], color='red', size=10, ha='center', va='center', transform=ccrs.PlateCarree())\n\n# Gridlines\ngls = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True, color='darkgray', alpha=0.5, linestyle='--')\ngls.top_labels = False\ngls.right_labels = False\n\n# Colorbar\ncb1 = plt.colorbar(cf1, shrink=0.3)\ncb1.set_label('Bottom Depth (m)', fontsize=10)\n\nax.set_extent([-22, -21.35, 64.25, 64.45], ccrs.PlateCarree())\nax.set_title('Station Overview')\n\n# --- Boxplot Data Preparation ---\ndef extract_cruise_data(var, depth=None, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across cruises.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth_bin=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- Salinity Normalized DIC Variation ---\nax2.boxplot(extract_cruise_data(nDIC), patch_artist=True)\nax2.set_title('Salinity Normalized DIC Variation')\nax2.set_ylabel('mmol/m$^3$')\nax2.set_xticklabels([])\n\n# --- Total DIC Variation ---\nax3.boxplot(extract_cruise_data(obs['DIC']), patch_artist=True)\nax3.set_title('Total DIC Variation')\nax3.set_ylabel('mmol/m$^3$')\nax3.set_xticklabels([])\n\n# --- Surface-Only Salinity Normalized DIC ---\nax4.boxplot(extract_cruise_data(nDIC, depth=0), patch_artist=True)\nax4.set_title('Salinity Normalized DIC, Surface Only')\nax4.set_xlabel('Cruise')\nax4.set_ylabel('mmol/m$^3$')\nax4.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nplt.show()\n","key":"r8FZZMMlKC"},{"type":"outputs","id":"FIgHVOmhXFhXCulOQXLC4","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"df46e64c19d36682217a40ee5af341c1","path":"/df46e64c19d36682217a40ee5af341c1.png"},"text/plain":{"content":"<Figure size 800x1300 with 5 Axes>","content_type":"text/plain"}}},"children":[],"key":"wGwOg9bPDf"}],"key":"adnf48kFXu"}],"key":"NtygEbmCzg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(2070,2160,2)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=nDIC.sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=nDIC.sel(HV=[1,5,9,10]).isel(date=slice(5,9)).mean('date')\n\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(6*2, 3), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].invert_yaxis()\nax[0].set_title('salinity normalized DIC along fjord April-May')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\nc0=ax[1].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].invert_yaxis()\nax[1].set_title('salinity normalized DIC along fjord June-August')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')","key":"gJPwLR2J0t"},{"type":"outputs","id":"75Uha4OVYub0KzfuHUyei","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"78d363db0711cfa7cf5560c61ec0ac61","path":"/78d363db0711cfa7cf5560c61ec0ac61.png"},"text/plain":{"content":"<Figure size 1200x300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"KhYAjHMlbw"}],"key":"e43UiFtAKo"}],"key":"oQ3faYhTw7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Define depth levels\nlevels = np.arange(0, 80)\n\n# Create figure and subplots\nfig = plt.figure(figsize=(8, 13))\ngs = fig.add_gridspec(4, 1, height_ratios=[1, 1, 1, 1])\n\n# Main map plot\nax1 = fig.add_subplot(gs[0])\nax2 = fig.add_subplot(gs[1])\nax3 = fig.add_subplot(gs[2])\nax4 = fig.add_subplot(gs[3])\n\n\n\n# --- Boxplot Data Preparation ---\ndef extract_cruise_data(var, depth=None, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across cruises.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- Salinity Normalized DIC Variation ---\nax1.boxplot(extract_cruise_data(obs['NO3']), patch_artist=True)\nax1.set_title('NO3')\nax1.set_ylabel('mmol/m$^3$')\nax1.set_xticklabels([])\n\n# --- Salinity Normalized DIC Variation ---\nax2.boxplot(extract_cruise_data(obs['PO4']), patch_artist=True)\nax2.set_title('PO4')\nax2.set_ylabel('mmol/m$^3$')\nax2.set_xticklabels([])\n\n# --- Total DIC Variation ---\nax3.boxplot(extract_cruise_data(obs['SiO2']), patch_artist=True)\nax3.set_title('SiO2')\nax3.set_ylabel('mmol/m$^3$')\nax3.set_xticklabels([])\n\n# --- Surface-Only Salinity Normalized DIC ---\nax4.boxplot(extract_cruise_data(obs['NH4']), patch_artist=True)\nax4.set_title('NH4')\nax4.set_xlabel('Cruise')\nax4.set_ylabel('mmol/m$^3$')\nax4.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nplt.show()\n","key":"ZkTMqwk3Zh"},{"type":"outputs","id":"qUA9Cu9DoNovsDv7m3kjk","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2217a644bd33f43f71d20785dd32be4b","path":"/2217a644bd33f43f71d20785dd32be4b.png"},"text/plain":{"content":"<Figure size 800x1300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"RSQxqYS9y2"}],"key":"RXOebUgLnT"}],"key":"fashFZQXqr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Define depth levels\nlevels = np.arange(0, 80)\n\n# Create figure and subplots\nfig = plt.figure(figsize=(8, 13))\ngs = fig.add_gridspec(4, 1, height_ratios=[1, 1, 1, 1])\n\n# Main map plot\nax1 = fig.add_subplot(gs[0])\nax2 = fig.add_subplot(gs[1])\nax3 = fig.add_subplot(gs[2])\nax4 = fig.add_subplot(gs[3])\n\n\n\n# --- Boxplot Data Preparation ---\ndef extract_cruise_data(var, depth=0, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across cruises.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth_bin=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- Salinity Normalized DIC Variation ---\nax1.boxplot(extract_cruise_data(obs['NO3']), patch_artist=True)\nax1.set_title('NO3 surface only')\nax1.set_ylabel('mmol/m$^3$')\nax1.set_xticklabels([])\n\n# --- Salinity Normalized DIC Variation ---\nax2.boxplot(extract_cruise_data(obs['PO4']), patch_artist=True)\nax2.set_title('PO4 surface only')\nax2.set_ylabel('mmol/m$^3$')\nax2.set_xticklabels([])\n\n# --- Total DIC Variation ---\nax3.boxplot(extract_cruise_data(obs['SiO2']), patch_artist=True)\nax3.set_title('SiO2 surface only')\nax3.set_ylabel('mmol/m$^3$')\nax3.set_xticklabels([])\n\n# --- Surface-Only Salinity Normalized DIC ---\nax4.boxplot(extract_cruise_data(obs['NH4']), patch_artist=True)\nax4.set_title('NH4 surface only')\nax4.set_xlabel('Cruise')\nax4.set_ylabel('mmol/m$^3$')\nax4.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nplt.show()\n","key":"ZaoydCx38f"},{"type":"outputs","id":"ZS7nsMPIqt5c7weLw1Uyz","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1f17dd0a7911e3ee73563598344a4e74","path":"/1f17dd0a7911e3ee73563598344a4e74.png"},"text/plain":{"content":"<Figure size 800x1300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"ncTqfHleFc"}],"key":"TMy2Qy6cDx"}],"key":"jvoBcK8rOn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(0,2.7,0.1)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=obs['NH4'].sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=obs['NH4'].sel(HV=[1,5,9,10]).isel(date=slice(5,9)).mean('date')\n\nfig, axarr = plt.subplots(nrows=4, ncols=2, figsize=(6*2, 3*4), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].invert_yaxis()\nax[0].set_title('NH4 along fjord April-May')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\nc0=ax[1].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].invert_yaxis()\nax[1].set_title('NH4 along fjord June-August')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')\n\ndata_alk1=obs['SiO2'].sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=obs['SiO2'].sel(HV=[1,5,9,10]).isel(date=slice(5,9)).mean('date')\n\nlevels=np.arange(0,7,0.2)\nc0=ax[2].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[2], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[2].invert_yaxis()\nax[2].set_title('SiO2 along fjord April-May')\nax[2].set_xlabel('longitude')\nax[2].set_ylabel('depth (m)')\n\nc0=ax[3].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[3], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[3].invert_yaxis()\nax[3].set_title('SiO2 along fjord June-August')\nax[3].set_xlabel('longitude')\nax[3].set_ylabel('depth (m)')\n\ndata_alk1=obs['PO4'].sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=obs['PO4'].sel(HV=[1,5,9,10]).isel(date=slice(5,9)).mean('date')\n\nlevels=np.arange(0,0.8,0.02)\nc0=ax[4].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[4], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[4].invert_yaxis()\nax[4].set_title('PO4 along fjord April-May')\nax[4].set_xlabel('longitude')\nax[4].set_ylabel('depth (m)')\n\nc0=ax[5].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[5], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[5].invert_yaxis()\nax[5].set_title('PO4 along fjord June-August')\nax[5].set_xlabel('longitude')\nax[5].set_ylabel('depth (m)')\n\ndata_alk1=obs['NO3'].sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=obs['NO3'].sel(HV=[1,5,9,10]).isel(date=slice(5,9)).mean('date')\n\nlevels=np.arange(0,6.4,0.2)\nc0=ax[6].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[6], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[6].invert_yaxis()\nax[6].set_title('NO3 along fjord April-May')\nax[6].set_xlabel('longitude')\nax[6].set_ylabel('depth (m)')\n\nc0=ax[7].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[7], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[7].invert_yaxis()\nax[7].set_title('NO3 along fjord June-August')\nax[7].set_xlabel('longitude')\nax[7].set_ylabel('depth (m)')","key":"AjonPtTBrL"},{"type":"outputs","id":"RkTcItVyQnrbpN3p6HjE2","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bb7ef1e05a9d93ac0def8a7e1e53fd72","path":"/bb7ef1e05a9d93ac0def8a7e1e53fd72.png"},"text/plain":{"content":"<Figure size 1200x1200 with 16 Axes>","content_type":"text/plain"}}},"children":[],"key":"c0QqLGkgkv"}],"key":"uyIIUK3LWx"}],"key":"PFGflA8pET"}],"key":"aC5As4hexx"},"references":{"cite":{"order":[],"data":{}}}}