{"version":3,"kind":"Notebook","sha256":"abfb88e00022fadedbf6c6ca9b4e0833f18b216d89328749049e9fc77b0febd6","slug":"velocity-analysis","location":"/velocity_analysis.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"xesmf_env","display_name":"xesmf_env","language":"python"},"exports":[{"format":"ipynb","filename":"velocity_analysis.ipynb","url":"/velocity_analysis-775a05cbf024cf235b816c4ad1e9bbf2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\nimport pandas as pd\nimport netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \nimport dask\nfrom scipy.interpolate import griddata\n#from ocean_c_lab_tools import *\n#from celluloid import Camera \n#import PyCO2SYS as csys\nimport seawater as sw\nfrom roms_regrid import *","key":"F1coAugGSW"},{"type":"outputs","id":"W8zTUqQygGs51O7rqf4mx","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/3005166470.py:17: UserWarning: The seawater library is deprecated! Please use gsw instead.\n  import seawater as sw\n"},"children":[],"key":"DBso0NYnti"}],"key":"cZ4i3S1o9L"}],"key":"BKhkIZNIXT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\n# Define file paths and station names\nstations = [\"HVIN_1\", \"HVNA_1\", \"HVNV_1\", \"HVSA_1\", \"HVSV_1\"]\nfile_paths = {name: f\"/global/cfs/cdirs/m4632/uheede/Hafro_obsdata/{name}new.nc\" for name in stations}\n\n# Dictionary to store datasets\ndatasets = {}\n\nfor name, path in file_paths.items():\n    ds = xr.open_dataset(path)\n\n    # Select valid depth bins\n    good_bins = ds['iigood'].where(ds['iigood'] < 20).to_numpy()\n    good_bins_nn = good_bins[~np.isnan(good_bins)].astype(int)\n    \n    ds = ds.isel(depth_dim=slice(np.min(good_bins_nn), np.max(good_bins_nn)))\n\n    # Store dataset with adjusted longitude\n    datasets[name] = ds.assign_coords(lon=ds['lon'].load() + 360)\n\n","key":"CANS2NA85t"},{"type":"outputs","id":"ZErcAQsPKbjJCf7Coo_nK","children":[],"key":"juLiBGXYm9"}],"key":"chAQBOzUlR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\nsubtract = 739674 - 9189  # Computed constant\nreference_date = pd.to_datetime(\"2000-01-01\")  # Reference date\n\n# Apply transformation to all datasets\nfor name, ds in datasets.items():\n    datetime_series = reference_date + pd.to_timedelta((ds['time'].values - subtract), unit='D')\n    datasets[name] = ds.assign_coords(time_dim=datetime_series)  # Update the time coordinate\n","key":"Pk4tBIt0cR"},{"type":"outputs","id":"aTfo7ikjlXMTCHLdCpiFm","children":[],"key":"sCJlQUrRbV"}],"key":"eKQmuZLfNe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#model=xr.open_mfdataset('/pscratch/sd/u/uheede/Iceland3_phys_hour/z_Iceland3_MARBL_his.202305????????.nc', combine='nested', concat_dim=[\"time\"])\n#model=xr.open_mfdataset('/global/cfs/cdirs/m4746/Users/ulla/Iceland4_multidye_np4/z_Iceland4_linedye_rnd.201206*.nc', combine='nested', concat_dim=[\"time\"])\nmodel=xr.open_mfdataset('/pscratch/sd/u/uheede/Iceland3_riv/z_Iceland3_MARBL_rnd.20230[5-6]????????.nc', combine='nested', concat_dim=[\"time\"])","key":"SGv9BLdiKS"},{"type":"outputs","id":"uoGIl3sXca7RqR1ZVBooI","children":[],"key":"RnX79G9w3D"}],"key":"OlxSdyZZCg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid=xr.open_mfdataset('/global/cfs/cdirs/m4632/uheede/work/Iceland3_MARBL/INPUT/Iceland3_grd.nc')\n#grid=xr.open_dataset('/global/cfs/cdirs/m4632/uheede/work/Iceland4_BGC/INPUT/Iceland4_grd.nc')","key":"UgAvRTNPFp"},{"type":"outputs","id":"Q790WD6Sx4zLEueuhR7BK","children":[],"key":"RVtHYUkmf5"}],"key":"kMzParRygS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_sub=model['u'].sel(depth=-10)\nv_sub=model['v'].sel(depth=-10)","key":"HDPriYIzEz"},{"type":"outputs","id":"Jh_Z1gR1outjAZEjULzBG","children":[],"key":"l2gdlgjbRC"}],"key":"zCXc6IDi25"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_rg=roms_regrid_u(grid,u_sub)\nv_rg=roms_regrid_v(grid,v_sub)","key":"frNO2Egqz4"},{"type":"outputs","id":"9Z9py1ahIkUq5iiHI3yqg","children":[],"key":"RPDOrLXO0b"}],"key":"U5Bmkftzm1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_rg.load()\nv_rg.load()","key":"w63do23Zo9"},{"type":"outputs","id":"Cx5MjMJYCvxLIGGJudUYU","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=dark],\nhtml[data-theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1F1F1F;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: '►';\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: '▼';\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: '(';\n}\n\n.xr-dim-list:after {\n  content: ')';\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: ',';\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (time: 1432, lat: 722, lon: 721)&gt; Size: 3GB\narray([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)\nCoordinates:\n    depth    float32 4B -10.0\n  * lon      (lon) float64 6kB 337.2 337.2 337.2 337.2 ... 338.7 338.7 338.7\n  * lat      (lat) float64 6kB 63.92 63.92 63.93 63.93 ... 64.57 64.57 64.57\nDimensions without coordinates: time\nAttributes:\n    regrid_method:  bilinear</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span>time</span>: 1432</li><li><span class='xr-has-index'>lat</span>: 722</li><li><span class='xr-has-index'>lon</span>: 721</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-d2c88c96-83b6-4722-aa7b-68698ef6dc37' class='xr-array-in' type='checkbox' checked><label for='section-d2c88c96-83b6-4722-aa7b-68698ef6dc37' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</span></div><div class='xr-array-data'><pre>array([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-b394ce22-1393-4258-8bb3-da79b7956273' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b394ce22-1393-4258-8bb3-da79b7956273' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>depth</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-10.0</div><input id='attrs-bb853c20-0cc6-4976-a7a1-cc94dd3acc2f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bb853c20-0cc6-4976-a7a1-cc94dd3acc2f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4536df4f-5f63-499b-b28e-1b40d488961a' class='xr-var-data-in' type='checkbox'><label for='data-4536df4f-5f63-499b-b28e-1b40d488961a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(-10., dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>337.2 337.2 337.2 ... 338.7 338.7</div><input id='attrs-28760540-20ef-4892-923e-7cb3c0b53c2d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-28760540-20ef-4892-923e-7cb3c0b53c2d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-85cd35da-c518-4d3f-b52e-3179001b2a65' class='xr-var-data-in' type='checkbox'><label for='data-85cd35da-c518-4d3f-b52e-3179001b2a65' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([337.194988, 337.197083, 337.199177, ..., 338.698729, 338.700823,\n       338.702917])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>63.92 63.92 63.93 ... 64.57 64.57</div><input id='attrs-aefd4802-ebd0-4937-9c03-ae61a781b613' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aefd4802-ebd0-4937-9c03-ae61a781b613' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5b64c03f-30e8-4319-9992-995596324f9e' class='xr-var-data-in' type='checkbox'><label for='data-5b64c03f-30e8-4319-9992-995596324f9e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([63.923933, 63.924832, 63.925732, ..., 64.57059 , 64.57149 , 64.572389])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-424b7e96-c3d2-42f0-8433-c3c9c99cfdbe' class='xr-section-summary-in' type='checkbox'  ><label for='section-424b7e96-c3d2-42f0-8433-c3c9c99cfdbe' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-38dd9b74-6785-47b6-828c-011b8ccbb156' class='xr-index-data-in' type='checkbox'/><label for='index-38dd9b74-6785-47b6-828c-011b8ccbb156' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 337.1949882266615,  337.1970825727734,  337.1991769188853,\n        337.2012712649972,  337.2033656111091,   337.205459957221,\n        337.2075543033329, 337.20964864944483, 337.21174299555673,\n       337.21383734166864,\n       ...\n       338.68406831222467, 338.68616265833657,  338.6882570044485,\n        338.6903513505604,  338.6924456966723,  338.6945400427842,\n        338.6966343888961,   338.698728735008,  338.7008230811199,\n        338.7029174272318],\n      dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=721))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-f44f9efe-e1f4-4b4a-9c81-6930d8510664' class='xr-index-data-in' type='checkbox'/><label for='index-f44f9efe-e1f4-4b4a-9c81-6930d8510664' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([63.923932965369254,  63.92483234964702, 63.925731733924785,\n        63.92663111820255, 63.927530502480316,  63.92842988675808,\n        63.92932927103585,  63.93022865531361,  63.93112803959138,\n       63.932027423869144,\n       ...\n        64.56429457113836,  64.56519395541612,  64.56609333969388,\n        64.56699272397165,  64.56789210824942,  64.56879149252718,\n        64.56969087680494,  64.57059026108271,  64.57148964536049,\n        64.57238902963825],\n      dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=722))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-762364b5-32f4-4e97-9aa7-f3a9e2af40a4' class='xr-section-summary-in' type='checkbox'  checked><label for='section-762364b5-32f4-4e97-9aa7-f3a9e2af40a4' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>regrid_method :</span></dt><dd>bilinear</dd></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray (time: 1432, lat: 722, lon: 721)> Size: 3GB\narray([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)\nCoordinates:\n    depth    float32 4B -10.0\n  * lon      (lon) float64 6kB 337.2 337.2 337.2 337.2 ... 338.7 338.7 338.7\n  * lat      (lat) float64 6kB 63.92 63.92 63.93 63.93 ... 64.57 64.57 64.57\nDimensions without coordinates: time\nAttributes:\n    regrid_method:  bilinear","content_type":"text/plain"}}},"children":[],"key":"g9dYdMvBTI"}],"key":"Pt1IvzTOud"}],"key":"UIDNkBrPDu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\nreference_date = np.datetime64('2000-01-01T00:00:00')\n\n# Convert seconds to datetime\ndatetime_array = reference_date + (model['ocean_time']).astype('timedelta64[s]')\n","key":"eB3lpwWVZ5"},{"type":"outputs","id":"3MZLrvmVrW7HZN8c7xzx2","children":[],"key":"sUQk9liFXL"}],"key":"fbex1eOxEN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model['ocean_time']=datetime_array","key":"IPWmoePKFX"},{"type":"outputs","id":"ZTWc3apOfb87NHsljyqrK","children":[],"key":"ao3KhlYNxH"}],"key":"fTFA5vF7i5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"datasets","key":"iHtlQ0Gchh"},{"type":"outputs","id":"b0V_ceLitfOkVE5redQ8e","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"{'HVIN_1': <xarray.Dataset> Size: 6MB\n Dimensions:   (time_dim: 19068, depth_dim: 12, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.5\n   * time_dim  (time_dim) datetime64[ns] 153kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 153kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 96B ...\n     lat       (lat_dim) float64 8B ...\n     u         (depth_dim, time_dim) float64 2MB ...\n     v         (depth_dim, time_dim) float64 2MB ...\n     w         (depth_dim, time_dim) float64 2MB ...\n     iigood    (depth_dim) float64 96B 2.0 3.0 4.0 5.0 ... 10.0 11.0 12.0 13.0,\n 'HVNA_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19058, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.3\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B ...\n     u         (depth_dim, time_dim) float64 610kB ...\n     v         (depth_dim, time_dim) float64 610kB ...\n     w         (depth_dim, time_dim) float64 610kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0,\n 'HVNV_1': <xarray.Dataset> Size: 3MB\n Dimensions:   (time_dim: 19030, depth_dim: 5, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.1\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 40B ...\n     lat       (lat_dim) float64 8B ...\n     u         (depth_dim, time_dim) float64 761kB ...\n     v         (depth_dim, time_dim) float64 761kB ...\n     w         (depth_dim, time_dim) float64 761kB ...\n     iigood    (depth_dim) float64 40B 2.0 3.0 4.0 5.0 6.0,\n 'HVSA_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19054, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.3\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B ...\n     u         (depth_dim, time_dim) float64 610kB ...\n     v         (depth_dim, time_dim) float64 610kB ...\n     w         (depth_dim, time_dim) float64 610kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0,\n 'HVSV_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19108, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.1\n   * time_dim  (time_dim) datetime64[ns] 153kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 153kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B ...\n     u         (depth_dim, time_dim) float64 611kB ...\n     v         (depth_dim, time_dim) float64 611kB ...\n     w         (depth_dim, time_dim) float64 611kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0}","content_type":"text/plain"}}},"children":[],"key":"olBEN0C6pk"}],"key":"GIFVbdsXF2"}],"key":"NwLokSnY5N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport xarray as xr\nfrom windrose import WindroseAxes\n\n# Define the number of stations\nnum_stations = 5\n\n# Define the observation subset time range (2024)\nobs_time_range = slice('2024-05-05', '2024-07-05')\n\n# Define the model subset time range (2023)\nmodel_time_range = slice('2023-05-05', '2023-07-05')\n\n# Create figure for timeseries plots\nfig, axs = plt.subplots(nrows=num_stations, ncols=2, figsize=(12, 3 * num_stations), sharex=False)\nfig.suptitle(\"Timeseries Comparison: Observations (2024) vs Model (2023)\", fontsize=14)\n\nfor i in range(num_stations):\n\n    # Subset observation data for 2024\n    obs=list(datasets.values())[i]\n    obs_subset = obs.sel(time_dim=obs_time_range)\n    depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n    u_obs = obs_subset['u'].isel(depth_dim=depth_index)[::6]  # Every 6th entry\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    \n    # Extract model data at station location and for the correct time range\n    u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    #u_sel = u_sel.sel(time_dim=model_time_range)  # Select only 2023 data\n\n    # Plot observations (2024)\n    axs[i, 0].plot(obs_subset.time_dim[::6], u_obs, label=\"Observed U (2024)\", color=\"blue\")\n    axs[i, 0].set_title(str(stations[i])+' - Obs (2024)')\n    axs[i, 0].tick_params(axis='x', rotation=45)\n    axs[i, 0].legend()\n    \n    # Plot model (2023)\n    axs[i, 1].plot(model['ocean_time'], u_sel.squeeze(), label=\"Model U (2023)\", color=\"green\")\n    axs[i, 1].set_title(str(stations[i])+' - Model (2023)')\n    axs[i, 1].tick_params(axis='x', rotation=45)\n    axs[i, 1].legend()\n\nplt.tight_layout()\nplt.show()\n\n\n","key":"BtpLyy6WgN"},{"type":"outputs","id":"ZcqcO1nwdjXS9UmCu04XR","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8cc0ea7202084aca325c1a0686805002","path":"/8cc0ea7202084aca325c1a0686805002.png"},"text/plain":{"content":"<Figure size 1200x1500 with 10 Axes>","content_type":"text/plain"}}},"children":[],"key":"Xszpkk2Zpz"}],"key":"GmzmfxMbln"}],"key":"rpVMN5MIPG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom windrose import WindroseAxes\n\n# Define station groups\nstation_groups_main = [[0, 1], [2, 3]]  # Part 1 & 2\nstation_group_final = [4]              # Part 3\n\n# --- Part 1 & 2: Loop over first two groups ---\nfor fig_index, station_indices in enumerate(station_groups_main):\n    num_stations = len(station_indices)\n    fig = plt.figure(figsize=(9, 11 * num_stations), layout='tight')\n    fig.suptitle(f\"Wind Roses: Observations (2024) vs Model (2023) - Part {fig_index + 1}\", fontsize=16)\n\n    for i, station_i in enumerate(station_indices):\n        # Extract observation dataset\n        obs = list(datasets.values())[station_i]\n        obs_subset = obs.sel(time_dim=obs_time_range)\n        depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n        u_obs = obs_subset['u'].sel(depth_dim=depth_index)[::6]\n        v_obs = obs_subset['v'].sel(depth_dim=depth_index)[::6]\n        obs_lon = obs.lon\n        obs_lat = obs.lat\n        direction_obs = (np.arctan2(-u_obs.squeeze().values, -v_obs.squeeze().values) * (180 / np.pi) + 360) % 360\n        speed_obs = np.sqrt(u_obs.squeeze().values**2 + v_obs.squeeze().values**2)\n\n        u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n        v_sel = v_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n        direction_model = (np.arctan2(-u_sel.squeeze().values, -v_sel.squeeze().values) * (180 / np.pi) + 360) % 360\n        speed_model = np.sqrt(u_sel.squeeze().values**2 + v_sel.squeeze().values**2)\n\n        # Plotting\n        y_pos = 0.75 - (i * 0.25)\n        ax_obs = WindroseAxes(fig, [0.05, y_pos, 0.4, 0.16])\n        fig.add_axes(ax_obs)\n        ax_obs.bar(direction_obs, speed_obs, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n        ax_obs.set_title(str(stations[station_i]) + ' - Obs (2024)', fontsize=12)\n        ax_obs.set_legend()\n        ax_obs.set_rticks([5, 10, 15, 20, 25, 30])\n        ax_obs.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\n        ax_model = WindroseAxes(fig, [0.55, y_pos, 0.4, 0.16])\n        fig.add_axes(ax_model)\n        ax_model.bar(direction_model, speed_model, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n        ax_model.set_title(str(stations[station_i]) + ' - Model (2023)', fontsize=12)\n        ax_model.set_legend()\n        ax_model.set_rticks([5, 10, 15, 20, 25, 30])\n        ax_model.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\n    fig.savefig(f\"wind_roses_comparison_part{fig_index + 1}.png\", dpi=300, bbox_inches='tight')\n    plt.show()\n\n# --- Part 3: Final group handled separately ---\nfig = plt.figure(figsize=(9, 11), layout='tight')\nfig.suptitle(\"Wind Roses: Observations (2024) vs Model (2023) - Part 3\", fontsize=16)\n\nstation_i = station_group_final[0]\nobs = list(datasets.values())[station_i]\nobs_subset = obs.sel(time_dim=obs_time_range)\ndepth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\nu_obs = obs_subset['u'].sel(depth_dim=depth_index)[::6]\nv_obs = obs_subset['v'].sel(depth_dim=depth_index)[::6]\nobs_lon = obs.lon\nobs_lat = obs.lat\ndirection_obs = (np.arctan2(-u_obs.squeeze().values, -v_obs.squeeze().values) * (180 / np.pi) + 360) % 360\nspeed_obs = np.sqrt(u_obs.squeeze().values**2 + v_obs.squeeze().values**2)\n\nu_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\nv_sel = v_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\ndirection_model = (np.arctan2(-u_sel.squeeze().values, -v_sel.squeeze().values) * (180 / np.pi) + 360) % 360\nspeed_model = np.sqrt(u_sel.squeeze().values**2 + v_sel.squeeze().values**2)\n\n# Plotting\nax_obs = WindroseAxes(fig, [0.05, 0.55, 0.4, 0.35])\nfig.add_axes(ax_obs)\nax_obs.bar(direction_obs, speed_obs, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\nax_obs.set_title(str(stations[station_i]) + ' - Obs (2024)', fontsize=12)\nax_obs.set_legend()\nax_obs.set_rticks([5, 10, 15, 20, 25, 30])\nax_obs.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\nax_model = WindroseAxes(fig, [0.55, 0.55, 0.4, 0.35])\nfig.add_axes(ax_model)\nax_model.bar(direction_model, speed_model, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\nax_model.set_title(str(stations[station_i]) + ' - Model (2023)', fontsize=12)\nax_model.set_legend()\nax_model.set_rticks([5, 10, 15, 20, 25, 30])\nax_model.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\nfig.savefig(\"wind_roses_comparison_part3.png\", dpi=300, bbox_inches='tight')\nplt.show()\n","key":"f1gE7nZkyD"},{"type":"outputs","id":"6XnySJ5RdH8twhXhPZ8Ab","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/2634239763.py:50: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.savefig(f\"wind_roses_comparison_part{fig_index + 1}.png\", dpi=300, bbox_inches='tight')\n/global/homes/u/uheede/.conda/envs/xesmf_env/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.canvas.print_figure(bytes_io, **kw)\n"},"children":[],"key":"AhD2uHyFur"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0ff730c06b7bde29786bc77853447118","path":"/0ff730c06b7bde29786bc77853447118.png"},"text/plain":{"content":"<Figure size 900x2200 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"FbjseOM6PQ"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/2634239763.py:50: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.savefig(f\"wind_roses_comparison_part{fig_index + 1}.png\", dpi=300, bbox_inches='tight')\n/global/homes/u/uheede/.conda/envs/xesmf_env/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.canvas.print_figure(bytes_io, **kw)\n"},"children":[],"key":"cO0TD8vlP2"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d214c65eaeae04dd66903add69afa602","path":"/d214c65eaeae04dd66903add69afa602.png"},"text/plain":{"content":"<Figure size 900x2200 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"BNm2qnfDJS"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/2634239763.py:90: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.savefig(\"wind_roses_comparison_part3.png\", dpi=300, bbox_inches='tight')\n/global/homes/u/uheede/.conda/envs/xesmf_env/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.canvas.print_figure(bytes_io, **kw)\n"},"children":[],"key":"Hu3Oi05ptA"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"460c669126b3c67718486b7ef5446254","path":"/460c669126b3c67718486b7ef5446254.png"},"text/plain":{"content":"<Figure size 900x1100 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"YwO0TZRKqK"}],"key":"vK6FrnCSip"}],"key":"u3IY02BuLn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom windrose import WindroseAxes\n\n# Define number of stations\nnum_stations = 1\n\n# Create a figure with 2 columns (Obs & Model) and num_stations rows\nfig = plt.figure(figsize=(14, 7 * num_stations),layout='tight')\n\nfig.suptitle(\"Wind Roses: Observations (2024) vs Model (2023)\", fontsize=16)\n\nfor i in range(1):\n\n    # Compute observed wind speed and direction\n    obs=list(datasets.values())[i]\n    obs_subset = obs.sel(time_dim=obs_time_range)\n    depth_index = (np.abs(obs_subset['depth_dim'].values - 10)).argmin()\n    u_obs = obs_subset['u'].sel(depth_dim=depth_index)[::6]\n    v_obs = obs_subset['v'].sel(depth_dim=depth_index)[::6]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    direction_obs = (np.arctan2(-u_obs.squeeze().values, -v_obs.squeeze().values) * (180 / np.pi) + 360) % 360\n    speed_obs = np.sqrt(u_obs.squeeze().values**2 + v_obs.squeeze().values**2)\n\n    # Compute model wind speed and direction\n    u_sel = u_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    v_sel = v_rg.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n    \n    direction_model = (np.arctan2(-u_sel.squeeze().values, -v_sel.squeeze().values) * (180 / np.pi) + 360) % 360\n    speed_model = np.sqrt(u_sel.squeeze().values**2 + v_sel.squeeze().values**2)\n\n    # Define subplot positions using bbox (left, bottom, width, height)\n    ax_obs = WindroseAxes(fig, [0.05, 0.75 - (i * 0.2), 0.4, 0.18])  # Left column\n    fig.add_axes(ax_obs)\n    ax_obs.bar(direction_obs, speed_obs, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n    ax_obs.set_title(str(stations[i])+' - Obs (2024)')\n    ax_obs.set_legend()\n    ax_obs.set_rticks([5, 10, 15, 20, 25, 30])\n    ax_obs.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n    \n    ax_model = WindroseAxes(fig, [0.55, 0.75 - (i * 0.2), 0.4, 0.18])  # Right column\n    fig.add_axes(ax_model)\n    ax_model.bar(direction_model, speed_model, normed=True, opening=0.8, edgecolor='white', bins=np.linspace(0, 0.6, 7))\n    ax_model.set_title(str(stations[i])+' - Model (2023)')\n    ax_model.set_legend()\n    ax_model.set_rticks([5, 10, 15, 20, 25, 30])\n    ax_model.set_yticklabels(['5%', '10%', '15%', '20%', '25%', '30%'])\n\nplt.show()\n","key":"cLxPB7wpKH"},{"type":"outputs","id":"vp4Uh2jt5q8ZqLQozlfZs","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/global/homes/u/uheede/.conda/envs/xesmf_env/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  fig.canvas.print_figure(bytes_io, **kw)\n"},"children":[],"key":"Qe4BOADFb2"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e2ad4cdb1d3c5dea68d52e476e58ecf3","path":"/e2ad4cdb1d3c5dea68d52e476e58ecf3.png"},"text/plain":{"content":"<Figure size 1400x700 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"tdVBIu1JlS"}],"key":"RBYzH088hg"}],"key":"hmb5y8AsYc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.signal import find_peaks\n\ndef compute_spectrum(time, signal):\n    \"\"\"Compute the FFT and identify spectral peaks.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step (assuming uniform spacing)\n    freq = np.fft.rfftfreq(n, d=dt)  # Compute frequency axis\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n    power = np.abs(spectrum)**2      # Compute Power Spectral Density (PSD)\n    \n    # Find peaks in the power spectrum\n    peaks, _ = find_peaks(power, height=np.max(power) * 0.1)  # Peaks with at least 10% of max power\n    \n    return freq, power, peaks\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\n\n# Example time series (Replace these with your observed and modeled data)\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\n# Define reference time (2000-01-01T00:00:00)\n\n\n\nmodel_time = (model['ocean_time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\nobs_time=(obs_time-obs_time[0])*10**(-9)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-9)*1/3600\n\nobserved_signal = u_obs.squeeze().values  # Example signal\nmodeled_signal = u_sel.squeeze().values # Example signal\n\n# Compute spectra\nfreq_obs, power_obs, peaks_obs = compute_spectrum(obs_time, observed_signal)\nfreq_mod, power_mod, peaks_mod = compute_spectrum(model_time, modeled_signal)\n\n# Plot results\nplt.figure(figsize=(10, 5))\n\n# Observed Spectrum\nplt.plot(freq_obs, power_obs, label=\"Observed Spectrum\", color='b')\nplt.scatter(freq_obs[peaks_obs], power_obs[peaks_obs], color='r', label=\"Observed Peaks\", zorder=3)\n\n# Modeled Spectrum\nplt.plot(freq_mod, power_mod, label=\"Modeled Spectrum\", color='g', linestyle='dashed')\nplt.scatter(freq_mod[peaks_mod], power_mod[peaks_mod], color='orange', label=\"Modeled Peaks\", zorder=3)\n\nplt.xlabel(\"Frequency (Hz)\")\nplt.ylabel(\"Power\")\nplt.legend()\nplt.title(\"Spectral Peaks in Observed and Modeled Data\")\nplt.grid()\nplt.show()\n\n","key":"qoVx1iM4su"},{"type":"outputs","id":"8fjbc3GLuVAbRSw3AmAXc","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/40607730.py:22: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  obs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\n/tmp/ipykernel_1875745/40607730.py:27: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\n/tmp/ipykernel_1875745/40607730.py:27: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'].load() - reference_time).astype('timedelta64[h]').astype(int).load().values# Example time axis (modify as needed)\n"},"children":[],"key":"rj5GpRtfSz"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d6b9ca2a69acfca81af6c5a0e3519450","path":"/d6b9ca2a69acfca81af6c5a0e3519450.png"},"text/plain":{"content":"<Figure size 1000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"R0Sa8a4Dk9"}],"key":"IAiY4YRZrf"}],"key":"UNgYf1xEoe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.signal import find_peaks\n\ndef compute_spectrum(time, signal):\n    \"\"\"Compute the FFT and identify spectral peaks.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step (assuming uniform spacing)\n    freq = np.fft.rfftfreq(n, d=dt)  # Compute frequency axis\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n    power = np.abs(spectrum)**2      # Compute Power Spectral Density (PSD)\n    \n    # Find peaks in the power spectrum\n    peaks, _ = find_peaks(power, height=np.max(power) * 0.1)  # Peaks with at least 10% of max power\n    \n    return freq, power, peaks\n\n# Reference time\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\n\n# Convert time to hours\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\nmodel_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\nobs_time=(obs_time-obs_time[0])*10**(-9)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-9)*1/3600\n\n# Example signals\nobserved_signal = u_obs.squeeze().values  \nmodeled_signal = u_sel.squeeze().values  \n\n# Compute spectra\nfreq_obs, power_obs, peaks_obs = compute_spectrum(obs_time, observed_signal)\nfreq_mod, power_mod, peaks_mod = compute_spectrum(model_time, modeled_signal)\n\n# Convert frequency to period (avoid division by zero)\nperiod_obs = 1 / freq_obs[1:]  # Ignore first value to avoid division by zero\nperiod_mod = 1 / freq_mod[1:]\n\n# Plot results\nplt.figure(figsize=(10, 5))\n\n# Observed Spectrum\nplt.plot(period_obs, power_obs[1:], label=\"Observed Spectrum\", color='b')\n#plt.scatter(period_obs[peaks_obs - 1], power_obs[peaks_obs][1:], color='r', label=\"Observed Peaks\", zorder=3)\n\n# Modeled Spectrum\nplt.plot(period_mod, power_mod[1:], label=\"Modeled Spectrum\", color='g', linestyle='dashed')\n#plt.scatter(period_mod[peaks_mod - 1], power_mod[peaks_mod][1:], color='orange', label=\"Modeled Peaks\", zorder=3)\n\n#plt.xscale(\"log\")  # Log scale to better show long periods\nplt.xlabel(\"Period (hours)\")\nplt.ylabel(\"Power\")\nplt.legend()\nplt.title(\"Spectral Peaks in Observed and Modeled Data\")\nplt.grid(which=\"both\", linestyle=\"--\", linewidth=0.5)\nplt.gca().invert_xaxis()  # Invert x-axis so long periods are on the right\nplt.xlim(1,24*20)\nplt.show()\n","key":"rOz78mNpQE"},{"type":"outputs","id":"qEeHqB-BKstIFPgW6gXlJ","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/980353686.py:24: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  obs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\n/tmp/ipykernel_1875745/980353686.py:25: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\n"},"children":[],"key":"yjSrC9UFl0"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"53396a8f1431a043f84e462eee013ee0","path":"/53396a8f1431a043f84e462eee013ee0.png"},"text/plain":{"content":"<Figure size 1000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"eZEwSovqb9"}],"key":"CnUc2kaMGj"}],"key":"E3yGnb3pJs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef bandpass_filter(time, signal, min_period=10, max_period=15):\n    \"\"\"Filter the signal to retain only frequencies corresponding to periods between min_period and max_period hours.\"\"\"\n    \n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Convert periods to frequencies\n    min_freq = 1 / max_period  # Lower cutoff frequency\n    max_freq = 1 / min_period  # Upper cutoff frequency\n\n    # Zero out frequencies outside the band\n    spectrum[(freq < min_freq) | (freq > max_freq)] = 0\n\n    # Inverse FFT to reconstruct filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Convert time to hours since reference time\nreference_time = np.datetime64('2000-01-01T00:00:00', 's')\nobs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\nmodel_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\nobs_time=(obs_time-obs_time[0])*10**(-9)*1/3600\nmodel_time=(model_time-model_time[0])*10**(-9)*1/3600\n\n# Apply band-pass filter\nu_obs_filtered = bandpass_filter(obs_time, u_obs.squeeze().values, min_period=10, max_period=15)\nu_model_filtered = bandpass_filter(model_time, u_sel.squeeze().values, min_period=10, max_period=15)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot filtered observed signal\naxs[0].plot(obs_time, u_obs_filtered, label=\"Filtered Observed (10-15h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"Filtered Observed u_obs (10-15h Period)\")\naxs[0].legend()\naxs[0].grid()\n\n# Plot filtered modeled signal\naxs[1].plot(model_time, u_model_filtered, label=\"Filtered Modeled (10-15h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_title(\"Filtered Modeled u_model (10-15h Period)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"OtIbxhpeWW"},{"type":"outputs","id":"xopidnnHQFlmcaYl4tytP","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/2325760596.py:27: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  obs_time = (obs_subset.time_dim[::6].load() - reference_time).astype('timedelta64[h]').astype(int).values\n/tmp/ipykernel_1875745/2325760596.py:28: UserWarning: Converting non-nanosecond precision timedelta values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.\n  model_time = (model['ocean_time'] - reference_time).astype('timedelta64[h]').astype(int).load().values\n"},"children":[],"key":"MRzX8IlTvH"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2e2828d3d07cae9ed5352254ee68fc88","path":"/2e2828d3d07cae9ed5352254ee68fc88.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"sPgnCl0G70"}],"key":"ASVbuuVpYN"}],"key":"zPpL5MUfiO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef highpass_filter(time, signal, cutoff_period=10):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (high-pass filter).\"\"\"\n\n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  # Frequency corresponding to the longest period to keep\n\n    # Zero out frequencies below the cutoff (i.e., remove long periods)\n    spectrum[freq < cutoff_freq] = 0\n\n    # Inverse FFT to reconstruct the high-pass filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Apply high-pass filter (removing periods ≥ 10 hours)\nu_obs_highpass = highpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=10)\nu_model_highpass = highpass_filter(model_time, u_sel.squeeze().values, cutoff_period=10)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot high-pass filtered observed signal\naxs[0].plot(obs_time, u_obs_highpass, label=\"Observed (Periods < 10h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"High-Pass Filtered Observed u_obs (Periods < 10h)\")\naxs[0].legend()\naxs[0].grid()\n\n# Plot high-pass filtered modeled signal\naxs[1].plot(model_time, u_model_highpass, label=\"Modeled (Periods < 10h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_title(\"High-Pass Filtered Modeled u_model (Periods < 10h)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"YCPJGer4W6"},{"type":"outputs","id":"4rgJuGeWj4rc_GGta9P4y","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"dcdb3df83a0f2fba3ff471bf533e6fb3","path":"/dcdb3df83a0f2fba3ff471bf533e6fb3.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"uztTXwC9Ku"}],"key":"Wexp6f0pOc"}],"key":"KId5BqwlF8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef lowpass_filter(time, signal, cutoff_period=15):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (high-pass filter).\"\"\"\n\n    # Compute FFT\n    n = len(signal)\n    dt = np.mean(np.diff(time))  # Time step in hours\n    freq = np.fft.rfftfreq(n, d=dt)  # Frequency axis (in Hz or cycles per hour)\n    spectrum = np.fft.rfft(signal)   # Compute FFT\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  # Frequency corresponding to the longest period to keep\n\n    # Zero out frequencies below the cutoff (i.e., remove long periods)\n    spectrum[freq > cutoff_freq] = 0\n\n    # Inverse FFT to reconstruct the high-pass filtered signal\n    filtered_signal = np.fft.irfft(spectrum, n=n)\n\n    return filtered_signal\n\n# Apply high-pass filter (removing periods ≥ 10 hours)\nu_obs_lowpass = lowpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=15)\nu_model_lowpass = lowpass_filter(model_time, u_sel.squeeze().values, cutoff_period=15)\n\n# Create figure and subplots\nfig, axs = plt.subplots(nrows=2, ncols=1, figsize=(12, 8), sharex=True)\n\n# Plot high-pass filtered observed signal\naxs[0].plot(obs_time, u_obs_lowpass, label=\"Observed (Periods > 15h)\", color='b')\naxs[0].set_ylabel(\"Velocity (m/s)\")\naxs[0].set_title(\"Low-Pass Filtered Observed u_obs (Periods > 15h)\")\naxs[0].legend()\naxs[0].grid()\n\n# Plot high-pass filtered modeled signal\naxs[1].plot(model_time, u_model_lowpass, label=\"Modeled (Periods > 15h)\", color='g')\naxs[1].set_xlabel(\"Time (hours)\")\naxs[1].set_ylabel(\"Velocity (m/s)\")\naxs[1].set_title(\"Low-Pass Filtered Modeled u_model (Periods > 15h)\")\naxs[1].legend()\naxs[1].grid()\n\nplt.tight_layout()\nplt.show()\n","key":"ZUn0hexUrZ"},{"type":"outputs","id":"lDvSxbjG0r2TpgS1ZeSV6","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8b8ea0ea0f5aee96af3d3c91065064b6","path":"/8b8ea0ea0f5aee96af3d3c91065064b6.png"},"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"WTrlsVYGUX"}],"key":"Dbld7Yyg1u"}],"key":"EojJQoPpAh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\n\ndef bandpass_filter(time, signal, low_cutoff=10, high_cutoff=15):\n    \"\"\"Apply a bandpass filter to retain frequencies between `low_cutoff` and `high_cutoff` hours.\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequencies\n    low_freq = 1 / high_cutoff\n    high_freq = 1 / low_cutoff\n\n    # Zero out frequencies outside the band\n    spectrum[(freq < low_freq) | (freq > high_freq)] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\ndef highpass_filter(time, signal, cutoff_period=10):\n    \"\"\"Remove frequencies with periods longer than `cutoff_period` hours (retain high frequencies).\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  \n\n    # Zero out frequencies below the cutoff (remove long periods)\n    spectrum[freq < cutoff_freq] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\ndef lowpass_filter(time, signal, cutoff_period=15):\n    \"\"\"Remove frequencies with periods shorter than `cutoff_period` hours (retain low frequencies).\"\"\"\n    n = len(signal)\n    dt = np.mean(np.diff(time))\n    freq = np.fft.rfftfreq(n, d=dt)\n    spectrum = np.fft.rfft(signal)\n\n    # Define cutoff frequency\n    cutoff_freq = 1 / cutoff_period  \n\n    # Zero out frequencies above the cutoff (remove short periods)\n    spectrum[freq > cutoff_freq] = 0\n\n    return np.fft.irfft(spectrum, n=n)\n\n# Apply filters to observed and modeled data\nu_obs_bandpass = bandpass_filter(obs_time, u_obs.squeeze().values, low_cutoff=10, high_cutoff=15)\nu_model_bandpass = bandpass_filter(model_time, u_sel.squeeze().values, low_cutoff=10, high_cutoff=15)\n\nu_obs_highpass = highpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=10)\nu_model_highpass = highpass_filter(model_time, u_sel.squeeze().values, cutoff_period=10)\n\nu_obs_lowpass = lowpass_filter(obs_time, u_obs.squeeze().values, cutoff_period=15)\nu_model_lowpass = lowpass_filter(model_time, u_sel.squeeze().values, cutoff_period=15)\n\n# Prepare data for boxplot\ndata = [\n    u_obs_bandpass, u_model_bandpass,\n    u_obs_highpass, u_model_highpass,\n    u_obs_lowpass, u_model_lowpass\n]\n\nlabels = [\n    \"Obs Bandpass (10-15h)\", \"Model Bandpass (10-15h)\",\n    \"Obs High-pass (<10h)\", \"Model High-pass (<10h)\",\n    \"Obs Low-pass (>15h)\", \"Model Low-pass (>15h)\"\n]\n\n# Define colors (Obs = Light Green, Model = Light Blue)\ncolors = ['lightgreen', 'lightblue', 'lightgreen', 'lightblue', 'lightgreen', 'lightblue']\n\n# Create boxplot\nfig, ax = plt.subplots(figsize=(10, 6))\nboxplot = ax.boxplot(data, labels=labels, patch_artist=True, medianprops=dict(color=\"red\"))\n\n# Apply colors to boxes\nfor patch, color in zip(boxplot['boxes'], colors):\n    patch.set_facecolor(color)\n    patch.set_alpha(0.6)  # Transparency for better readability\n\nax.set_ylabel(\"Velocity (m/s)\")\nax.set_title(\"Boxplot of Filtered Velocity Components\")\n\nplt.xticks(rotation=20)  # Rotate labels for better readability\nplt.grid(axis='y', linestyle='--', alpha=0.6)\n\nplt.show()\n","key":"JKqeLwAiTX"},{"type":"outputs","id":"pz1YSFqKuU1YEPziSHJ_D","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1875745/2300157572.py:78: MatplotlibDeprecationWarning: The 'labels' parameter of boxplot() has been renamed 'tick_labels' since Matplotlib 3.9; support for the old name will be dropped in 3.11.\n  boxplot = ax.boxplot(data, labels=labels, patch_artist=True, medianprops=dict(color=\"red\"))\n"},"children":[],"key":"fj2lvnoYyw"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"34d6f1d5b8ec49460c09bac7b9fc7f5a","path":"/34d6f1d5b8ec49460c09bac7b9fc7f5a.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"ZlgfM1y3PC"}],"key":"egPIijBdkE"}],"key":"MoMxR6ml6a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model=xr.open_mfdataset('/pscratch/sd/u/uheede/Iceland3_riv/z_Iceland3_MARBL_rnd.20230[5-6]????????.nc', combine='nested', concat_dim=[\"time\"])\n\n","key":"EE95k63aQY"},{"type":"outputs","id":"IoiMPLuyQlrOqGY_FVam0","children":[],"key":"HTIfvLRYhC"}],"key":"zFact7cAtP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u=model['u'].sel(depth=[-0,-1,-2,-3,-4,-5,-7,-9,-10,-12,-14,-15,-16,-18,-20,-26,-30,-36,-40,-50,-80]).mean('time')\nv=model['v'].sel(depth=[-0,-1,-2,-3,-4,-5,-7,-9,-10,-12,-14,-15,-16,-18,-20,-26,-30,-36,-40,-50,-80]).mean('time')\n\nu=roms_regrid_u(grid,u)\nv=roms_regrid_v(grid,v)\nmask=roms_regrid(grid,grid['mask_rho'])\n\n\n","key":"LPVJKELBeP"},{"type":"outputs","id":"MoSIG2lytSDSBTlynHu3C","children":[],"key":"N4nfhQcTw6"}],"key":"rmGIFzPZ0n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u.load()\n#t.to_netcdf('/global/cfs/cdirs/m4746/Users/ulla/run/Iceland3_MARBL/t_06.nc')\n;","key":"YhIvflNTx9"},{"type":"outputs","id":"sL9JlEMCPiG_o0RJpBI0X","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"''","content_type":"text/plain"}}},"children":[],"key":"h4ow4DHKes"}],"key":"NRdM6elltC"}],"key":"WaLAwwuVXt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"v.load()","key":"dQMJSJPiS1"},{"type":"outputs","id":"CzFxOXEQR9jTbAM9UH-hB","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=dark],\nhtml[data-theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1F1F1F;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: '►';\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: '▼';\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: '(';\n}\n\n.xr-dim-list:after {\n  content: ')';\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: ',';\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (depth: 21, lat: 722, lon: 721)&gt; Size: 44MB\narray([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)\nCoordinates:\n  * depth    (depth) float32 84B -0.0 -1.0 -2.0 -3.0 ... -36.0 -40.0 -50.0 -80.0\n  * lon      (lon) float64 6kB 337.2 337.2 337.2 337.2 ... 338.7 338.7 338.7\n  * lat      (lat) float64 6kB 63.92 63.92 63.93 63.93 ... 64.57 64.57 64.57\nAttributes:\n    regrid_method:  bilinear</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>depth</span>: 21</li><li><span class='xr-has-index'>lat</span>: 722</li><li><span class='xr-has-index'>lon</span>: 721</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-2f1e46a6-c59d-4a67-971f-f5abdaa8891e' class='xr-array-in' type='checkbox' checked><label for='section-2f1e46a6-c59d-4a67-971f-f5abdaa8891e' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</span></div><div class='xr-array-data'><pre>array([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-a318cd7d-4cb2-4604-9078-2e05b227fdc2' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a318cd7d-4cb2-4604-9078-2e05b227fdc2' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>depth</span></div><div class='xr-var-dims'>(depth)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-0.0 -1.0 -2.0 ... -50.0 -80.0</div><input id='attrs-be1da2ab-cc4d-498c-be94-5e946b09a984' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-be1da2ab-cc4d-498c-be94-5e946b09a984' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-082a963e-ba94-422e-888a-88cf076ff562' class='xr-var-data-in' type='checkbox'><label for='data-082a963e-ba94-422e-888a-88cf076ff562' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ -0.,  -1.,  -2.,  -3.,  -4.,  -5.,  -7.,  -9., -10., -12., -14., -15.,\n       -16., -18., -20., -26., -30., -36., -40., -50., -80.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>337.2 337.2 337.2 ... 338.7 338.7</div><input id='attrs-f9859f52-3793-4ca0-a2cc-fce612fe5f27' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f9859f52-3793-4ca0-a2cc-fce612fe5f27' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-de19d9f6-29c3-4ead-9252-7edd9fdb5156' class='xr-var-data-in' type='checkbox'><label for='data-de19d9f6-29c3-4ead-9252-7edd9fdb5156' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([337.194988, 337.197083, 337.199177, ..., 338.698729, 338.700823,\n       338.702917])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>63.92 63.92 63.93 ... 64.57 64.57</div><input id='attrs-9c56a84e-c438-4cd5-a155-3258b640e34f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9c56a84e-c438-4cd5-a155-3258b640e34f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6c91775d-1cd2-48dc-8e76-9908f5756adf' class='xr-var-data-in' type='checkbox'><label for='data-6c91775d-1cd2-48dc-8e76-9908f5756adf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([63.923933, 63.924832, 63.925732, ..., 64.57059 , 64.57149 , 64.572389])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5d588f97-0e15-491e-98c4-072af16a578b' class='xr-section-summary-in' type='checkbox'  ><label for='section-5d588f97-0e15-491e-98c4-072af16a578b' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>depth</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-e7b61a48-45a5-4673-b3c5-fce8f0716490' class='xr-index-data-in' type='checkbox'/><label for='index-e7b61a48-45a5-4673-b3c5-fce8f0716490' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ -0.0,  -1.0,  -2.0,  -3.0,  -4.0,  -5.0,  -7.0,  -9.0, -10.0, -12.0,\n       -14.0, -15.0, -16.0, -18.0, -20.0, -26.0, -30.0, -36.0, -40.0, -50.0,\n       -80.0],\n      dtype=&#x27;float32&#x27;, name=&#x27;depth&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-0bcc342b-6079-42b6-ad0c-a5783c4f73f0' class='xr-index-data-in' type='checkbox'/><label for='index-0bcc342b-6079-42b6-ad0c-a5783c4f73f0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 337.1949882266615,  337.1970825727734,  337.1991769188853,\n        337.2012712649972,  337.2033656111091,   337.205459957221,\n        337.2075543033329, 337.20964864944483, 337.21174299555673,\n       337.21383734166864,\n       ...\n       338.68406831222467, 338.68616265833657,  338.6882570044485,\n        338.6903513505604,  338.6924456966723,  338.6945400427842,\n        338.6966343888961,   338.698728735008,  338.7008230811199,\n        338.7029174272318],\n      dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=721))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-e8a7672d-6495-47f7-9840-eaa5f1e0df50' class='xr-index-data-in' type='checkbox'/><label for='index-e8a7672d-6495-47f7-9840-eaa5f1e0df50' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([63.923932965369254,  63.92483234964702, 63.925731733924785,\n        63.92663111820255, 63.927530502480316,  63.92842988675808,\n        63.92932927103585,  63.93022865531361,  63.93112803959138,\n       63.932027423869144,\n       ...\n        64.56429457113836,  64.56519395541612,  64.56609333969388,\n        64.56699272397165,  64.56789210824942,  64.56879149252718,\n        64.56969087680494,  64.57059026108271,  64.57148964536049,\n        64.57238902963825],\n      dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=722))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-31277eeb-6dad-4f54-af0b-5c99a8b8d0e9' class='xr-section-summary-in' type='checkbox'  checked><label for='section-31277eeb-6dad-4f54-af0b-5c99a8b8d0e9' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>regrid_method :</span></dt><dd>bilinear</dd></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray (depth: 21, lat: 722, lon: 721)> Size: 44MB\narray([[[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n...\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]],\n\n       [[ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        ...,\n        [ 0., nan, nan, ..., nan, nan, nan],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.],\n        [ 0.,  0.,  0., ...,  0.,  0.,  0.]]], dtype=float32)\nCoordinates:\n  * depth    (depth) float32 84B -0.0 -1.0 -2.0 -3.0 ... -36.0 -40.0 -50.0 -80.0\n  * lon      (lon) float64 6kB 337.2 337.2 337.2 337.2 ... 338.7 338.7 338.7\n  * lat      (lat) float64 6kB 63.92 63.92 63.93 63.93 ... 64.57 64.57 64.57\nAttributes:\n    regrid_method:  bilinear","content_type":"text/plain"}}},"children":[],"key":"G9N1p4FyZS"}],"key":"mDWvB5g6k0"}],"key":"AH9nnbey45"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"datasets","key":"d7iEQaYyLb"},{"type":"outputs","id":"7afKfS02Kl_Fvly42fAO9","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"{'HVIN_1': <xarray.Dataset> Size: 6MB\n Dimensions:   (time_dim: 19068, depth_dim: 12, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.5\n   * time_dim  (time_dim) datetime64[ns] 153kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 153kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 96B ...\n     lat       (lat_dim) float64 8B 64.38\n     u         (depth_dim, time_dim) float64 2MB ...\n     v         (depth_dim, time_dim) float64 2MB ...\n     w         (depth_dim, time_dim) float64 2MB ...\n     iigood    (depth_dim) float64 96B 2.0 3.0 4.0 5.0 ... 10.0 11.0 12.0 13.0,\n 'HVNA_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19058, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.3\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B 64.37\n     u         (depth_dim, time_dim) float64 610kB ...\n     v         (depth_dim, time_dim) float64 610kB ...\n     w         (depth_dim, time_dim) float64 610kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0,\n 'HVNV_1': <xarray.Dataset> Size: 3MB\n Dimensions:   (time_dim: 19030, depth_dim: 5, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.1\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 40B ...\n     lat       (lat_dim) float64 8B 64.31\n     u         (depth_dim, time_dim) float64 761kB ...\n     v         (depth_dim, time_dim) float64 761kB ...\n     w         (depth_dim, time_dim) float64 761kB ...\n     iigood    (depth_dim) float64 40B 2.0 3.0 4.0 5.0 6.0,\n 'HVSA_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19054, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.3\n   * time_dim  (time_dim) datetime64[ns] 152kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 152kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B 64.36\n     u         (depth_dim, time_dim) float64 610kB ...\n     v         (depth_dim, time_dim) float64 610kB ...\n     w         (depth_dim, time_dim) float64 610kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0,\n 'HVSV_1': <xarray.Dataset> Size: 2MB\n Dimensions:   (time_dim: 19108, depth_dim: 4, lat_dim: 1, lon_dim: 1)\n Coordinates:\n     lon       (lon_dim) float64 8B 338.1\n   * time_dim  (time_dim) datetime64[ns] 153kB 2024-04-05T08:00:00.000003349 ....\n Dimensions without coordinates: depth_dim, lat_dim, lon_dim\n Data variables:\n     time      (time_dim) float64 153kB 7.393e+05 7.393e+05 ... 7.395e+05\n     depth     (depth_dim) float64 32B ...\n     lat       (lat_dim) float64 8B 64.3\n     u         (depth_dim, time_dim) float64 611kB ...\n     v         (depth_dim, time_dim) float64 611kB ...\n     w         (depth_dim, time_dim) float64 611kB ...\n     iigood    (depth_dim) float64 32B 2.0 3.0 4.0 5.0}","content_type":"text/plain"}}},"children":[],"key":"Ul4ve0Y3gQ"}],"key":"IUS8YW23ri"}],"key":"km9TLT6B9h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"IzNWdx1c3n"},{"type":"outputs","id":"3dU90cjdBR_sOc5TcH9Q4","children":[],"key":"rbWXqNRioF"}],"key":"nqK71s96Vd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#obs=list(datasets.values())[1]\n\n#plt.plot(obs['u'].mean('time_dim').squeeze(),obs.depth)\n#plt.gca().invert_yaxis()\n\n#u_sel = u.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n#plt.plot(u_sel.squeeze(),u.depth*(-1))","key":"rfQQCyR1YU"},{"type":"outputs","id":"SvykUOBnSy0mvbByT8lF3","children":[],"key":"zw5q7T4LH4"}],"key":"nB89R2t57l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Create figure and subplots\nfig, axes = plt.subplots(nrows=1, ncols=5, figsize=(20, 5), sharey=True)\n\n# Loop through each dataset and create a subplot\nfor i, (key, obs) in enumerate(datasets.items()):\n    ax = axes[i]  # Select subplot\n    obs=list(datasets.values())[i]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    # Plot observed profile\n    ax.plot(obs['u'].mean('time_dim').squeeze(), obs.depth, label=\"Observed\", color='b')\n\n    # Extract nearest model data\n    u_sel = u.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n\n    # Plot modeled profile\n    ax.plot(u_sel.squeeze(), u.depth * (-1), label=\"Modeled\", color='r')\n\n    # Reverse y-axis\n    ax.invert_yaxis()\n\n    # Titles and labels\n    ax.set_title(str(stations[i]))\n    if i == 0:\n        ax.set_ylabel(\"Depth (m)\")\n    ax.set_xlabel(\"Velocity (m/s)\")\n    ax.legend()\n\nplt.tight_layout()\nplt.show()\n","key":"aGSC9vSs7I"},{"type":"outputs","id":"Bel2QWJ_6QaoS2S93PFCI","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a417fe3f8cf6883b5fb2c622e0fb94dc","path":"/a417fe3f8cf6883b5fb2c622e0fb94dc.png"},"text/plain":{"content":"<Figure size 2000x500 with 5 Axes>","content_type":"text/plain"}}},"children":[],"key":"hJfs3LwclT"}],"key":"Mdxa85N36d"}],"key":"QrIEimEQNa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Create figure and subplots\nfig, axes = plt.subplots(nrows=1, ncols=5, figsize=(20, 5), sharey=True)\n\n# Loop through each dataset and create a subplot\nfor i, (key, obs) in enumerate(datasets.items()):\n    ax = axes[i]  # Select subplot\n    obs=list(datasets.values())[i]\n    obs_lon=obs.lon\n    obs_lat=obs.lat\n    # Plot observed profile\n    ax.plot(obs['v'].mean('time_dim').squeeze(), obs.depth, label=\"Observed\", color='b')\n\n    # Extract nearest model data\n    v_sel = v.sel(lon=obs_lon.values, method='nearest').sel(lat=obs_lat.values, method='nearest')\n\n    # Plot modeled profile\n    ax.plot(v_sel.squeeze(), v.depth * (-1), label=\"Modeled\", color='r')\n\n    # Reverse y-axis\n    ax.invert_yaxis()\n\n    # Titles and labels\n    ax.set_title(str(stations[i]))\n    if i == 0:\n        ax.set_ylabel(\"Depth (m)\")\n    ax.set_xlabel(\"Velocity (m/s)\")\n    ax.legend()\n\nplt.tight_layout()\nplt.show()\n","key":"G2ls8nDmVa"},{"type":"outputs","id":"cXrWeI_V8ObIRpoQLuBk2","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1a6ca9bdea093f83fbaa6a7cb5e9ca48","path":"/1a6ca9bdea093f83fbaa6a7cb5e9ca48.png"},"text/plain":{"content":"<Figure size 2000x500 with 5 Axes>","content_type":"text/plain"}}},"children":[],"key":"oEFDEsr2F9"}],"key":"PR2tiTn5PR"}],"key":"PZdlhdum7I"}],"key":"QNjRkchlhz"},"references":{"cite":{"order":[],"data":{}}}}