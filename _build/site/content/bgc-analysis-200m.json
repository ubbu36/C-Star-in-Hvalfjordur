{"version":3,"kind":"Notebook","sha256":"d26549876260fe79689167292cf71a5842d64b5ecdf947890986eb4dac2e9e6d","slug":"bgc-analysis-200m","location":"/BGC_analysis_200m.ipynb","dependencies":[],"frontmatter":{"title":"BGC analysis","content_includes_title":false,"kernelspec":{"name":"roms-tools","display_name":"Python (My roms-tools Kernel)","language":"python"},"exports":[{"format":"ipynb","filename":"BGC_analysis_200m.ipynb","url":"/BGC_analysis_200m-ebd6d6d64d26fb2bd0cdad8800cba9a8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook conducts a comparison between observed and modeled values of DIC, alkalinity and nutrients","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IGXvwoBq7M"}],"key":"G0AuWEv2qc"}],"key":"u3rtUOldAl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import subprocess\nimport os\nimport pandas as pd\n#import netCDF4\nimport numpy as np\nimport glob\nimport time\nimport matplotlib.pyplot as plt\nimport copy\nimport xarray as xr\nfrom datetime import datetime, timedelta \nimport dask\nfrom scipy.interpolate import griddata\n#from ocean_c_lab_tools import *\n#from celluloid import Camera \n#import PyCO2SYS as csys\nimport gsw as sw\nfrom roms_regrid import *","key":"IM2u2Xtai9"},{"type":"outputs","id":"2s6bF3Mgpp4CvDqdcAW2K","children":[],"key":"rPuoX25mTm"}],"key":"YPBfVJ4s3x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xls = pd.ExcelFile('/home/x-uheede/R/HAFRO/20241210_biogeochemistry_format.xlsx')\ncombo = pd.read_excel(xls, 'Sheet1',decimal='.')\n\n\nobs=xr.Dataset.from_dataframe(combo)\nobs=obs.set_index(index=['HV','depth_bin','date'])\nobs=obs.drop_duplicates('index')\nobs=obs.unstack('index')\nobs=obs.rename(name_dict={'Latitude(°N)':'lat','Longitude(°E)':'lon'})","key":"rmoHwDYjtj"},{"type":"outputs","id":"5Aqsyo51ASKpR--UqoqYH","children":[],"key":"xX03gGZ8lc"}],"key":"fxtaxfaqtD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"density=sw.density.sigma0(obs['S'],obs['T'])\nobs['Alk']=obs['TA'] * (1 / 1000) * (density+1000)\nobs['DIC']=obs['DIC'] * (1 / 1000) * (density+1000)","key":"W267J79x9x"},{"type":"outputs","id":"zAxIfyhFaRWyXqAVf9UXo","children":[],"key":"WLUqrI9HSy"}],"key":"gnhvWzxuYr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"V5JAolUKqO"},{"type":"outputs","id":"kgBieXdog0ZdHfO4wu-VA","children":[],"key":"sU2BKFAZRO"}],"key":"ScuRBB4OIz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"TA0=274\nSref=34\nDIC0=315\nnTA=((obs['Alk']-TA0)/obs['S'])*Sref+TA0\n\nnDIC=((obs['DIC']-DIC0)/obs['S'])*Sref+DIC0\n","key":"Tan5z1SdOI"},{"type":"outputs","id":"Yd3AiLDJ0ShvXm5QubASP","children":[],"key":"FBJLmZS47Y"}],"key":"b6c76ba28J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"nDIC","key":"DfL2YwS19J"},{"type":"outputs","id":"FP_UXELd9Sd6oSVz-nFmI","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (HV: 10, depth_bin: 8, date: 14)&gt; Size: 9kB\narray([[[2161.18958909, 2155.1530183 , 2139.09386003, ...,\n                   nan,           nan,           nan],\n        [2159.11004993, 2147.72451711, 2135.40093549, ...,\n                   nan,           nan,           nan],\n        [          nan, 2149.32125199, 2143.58772843, ...,\n                   nan,           nan,           nan],\n        ...,\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]],\n\n       [[2154.18355438,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [2152.84509409,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n...\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]],\n\n       [[2141.71422495,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        ...,\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]]], shape=(10, 8, 14))\nCoordinates:\n  * HV         (HV) int64 80B 1 3 4 5 6 7 8 9 10 12\n  * depth_bin  (depth_bin) int64 64B 0 10 20 30 50 60 70 80\n  * date       (date) datetime64[ns] 112B 2024-04-04 2024-04-16 ... 2024-11-21</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>HV</span>: 10</li><li><span class='xr-has-index'>depth_bin</span>: 8</li><li><span class='xr-has-index'>date</span>: 14</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-2691fffd-4b10-4788-a927-7add293ed158' class='xr-array-in' type='checkbox' checked><label for='section-2691fffd-4b10-4788-a927-7add293ed158' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>2.161e+03 2.155e+03 2.139e+03 2.074e+03 2.091e+03 ... nan nan nan nan</span></div><div class='xr-array-data'><pre>array([[[2161.18958909, 2155.1530183 , 2139.09386003, ...,\n                   nan,           nan,           nan],\n        [2159.11004993, 2147.72451711, 2135.40093549, ...,\n                   nan,           nan,           nan],\n        [          nan, 2149.32125199, 2143.58772843, ...,\n                   nan,           nan,           nan],\n        ...,\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]],\n\n       [[2154.18355438,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [2152.84509409,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n...\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]],\n\n       [[2141.71422495,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        ...,\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]]], shape=(10, 8, 14))</pre></div></div></li><li class='xr-section-item'><input id='section-dc6590ce-fc9b-4f7c-9026-bf10561404fe' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dc6590ce-fc9b-4f7c-9026-bf10561404fe' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>HV</span></div><div class='xr-var-dims'>(HV)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 3 4 5 6 7 8 9 10 12</div><input id='attrs-fd10e46e-b4b4-43f6-b439-9142fa2f54b0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fd10e46e-b4b4-43f6-b439-9142fa2f54b0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2d8c57b6-3416-476f-baba-1e990129b54c' class='xr-var-data-in' type='checkbox'><label for='data-2d8c57b6-3416-476f-baba-1e990129b54c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 12])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>depth_bin</span></div><div class='xr-var-dims'>(depth_bin)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 10 20 30 50 60 70 80</div><input id='attrs-ad114abf-5e9c-45de-99fc-3c5031928b31' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ad114abf-5e9c-45de-99fc-3c5031928b31' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d6875976-28b5-4553-a880-f0f7f4a81ed6' class='xr-var-data-in' type='checkbox'><label for='data-d6875976-28b5-4553-a880-f0f7f4a81ed6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0, 10, 20, 30, 50, 60, 70, 80])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>date</span></div><div class='xr-var-dims'>(date)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2024-04-04 ... 2024-11-21</div><input id='attrs-3d6ea725-fdcf-4c8d-9ca4-db4015eedb25' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3d6ea725-fdcf-4c8d-9ca4-db4015eedb25' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4aaace41-45ce-4a2c-96ef-76c5c9ac8d66' class='xr-var-data-in' type='checkbox'><label for='data-4aaace41-45ce-4a2c-96ef-76c5c9ac8d66' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2024-04-04T00:00:00.000000000&#x27;, &#x27;2024-04-16T00:00:00.000000000&#x27;,\n       &#x27;2024-04-26T00:00:00.000000000&#x27;, &#x27;2024-05-13T00:00:00.000000000&#x27;,\n       &#x27;2024-05-28T00:00:00.000000000&#x27;, &#x27;2024-06-11T00:00:00.000000000&#x27;,\n       &#x27;2024-06-26T00:00:00.000000000&#x27;, &#x27;2024-07-09T00:00:00.000000000&#x27;,\n       &#x27;2024-07-25T00:00:00.000000000&#x27;, &#x27;2024-08-04T00:00:00.000000000&#x27;,\n       &#x27;2024-09-19T00:00:00.000000000&#x27;, &#x27;2024-10-08T00:00:00.000000000&#x27;,\n       &#x27;2024-10-09T00:00:00.000000000&#x27;, &#x27;2024-11-21T00:00:00.000000000&#x27;],\n      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-00bd5c90-89e3-4a1d-a7b5-1ada754c28ea' class='xr-section-summary-in' type='checkbox'  ><label for='section-00bd5c90-89e3-4a1d-a7b5-1ada754c28ea' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>HV</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-932fc492-0355-4360-9703-0b21a53adb4b' class='xr-index-data-in' type='checkbox'/><label for='index-932fc492-0355-4360-9703-0b21a53adb4b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1, 3, 4, 5, 6, 7, 8, 9, 10, 12], dtype=&#x27;int64&#x27;, name=&#x27;HV&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>depth_bin</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-41725dee-64dd-4593-baa4-a48e50260dc6' class='xr-index-data-in' type='checkbox'/><label for='index-41725dee-64dd-4593-baa4-a48e50260dc6' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 10, 20, 30, 50, 60, 70, 80], dtype=&#x27;int64&#x27;, name=&#x27;depth_bin&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>date</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-36a1d8ec-c8b3-4d81-8335-8045c1a8f61b' class='xr-index-data-in' type='checkbox'/><label for='index-36a1d8ec-c8b3-4d81-8335-8045c1a8f61b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2024-04-04&#x27;, &#x27;2024-04-16&#x27;, &#x27;2024-04-26&#x27;, &#x27;2024-05-13&#x27;,\n               &#x27;2024-05-28&#x27;, &#x27;2024-06-11&#x27;, &#x27;2024-06-26&#x27;, &#x27;2024-07-09&#x27;,\n               &#x27;2024-07-25&#x27;, &#x27;2024-08-04&#x27;, &#x27;2024-09-19&#x27;, &#x27;2024-10-08&#x27;,\n               &#x27;2024-10-09&#x27;, &#x27;2024-11-21&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;date&#x27;, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8bdad4d4-f0bf-45d2-b262-56930960b74a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-8bdad4d4-f0bf-45d2-b262-56930960b74a' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray (HV: 10, depth_bin: 8, date: 14)> Size: 9kB\narray([[[2161.18958909, 2155.1530183 , 2139.09386003, ...,\n                   nan,           nan,           nan],\n        [2159.11004993, 2147.72451711, 2135.40093549, ...,\n                   nan,           nan,           nan],\n        [          nan, 2149.32125199, 2143.58772843, ...,\n                   nan,           nan,           nan],\n        ...,\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]],\n\n       [[2154.18355438,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [2152.84509409,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n...\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]],\n\n       [[2141.71422495,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        ...,\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan],\n        [          nan,           nan,           nan, ...,\n                   nan,           nan,           nan]]], shape=(10, 8, 14))\nCoordinates:\n  * HV         (HV) int64 80B 1 3 4 5 6 7 8 9 10 12\n  * depth_bin  (depth_bin) int64 64B 0 10 20 30 50 60 70 80\n  * date       (date) datetime64[ns] 112B 2024-04-04 2024-04-16 ... 2024-11-21","content_type":"text/plain"}}},"children":[],"key":"xuI2J4xF3i"}],"key":"qDU4cILN2d"}],"key":"Ew56H6lK6x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from roms_tools import Grid, ROMSOutput","key":"HPfjKQMrrw"},{"type":"outputs","id":"uIpO6dVY04HvK4Hk_agwf","children":[],"key":"rz9S5StwPr"}],"key":"ZifoqsqOzW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid = Grid.from_file(\n    \"/home/x-uheede/S/Iceland2_MARBL_2024_60m/P_INPUT/Iceland2_grid_MAT1.nc\"\n)","key":"lFTlQpbr42"},{"type":"outputs","id":"vdf_kbkKernY-F3ZNlSWs","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-11-19 12:26:56 - WARNING - Vertical coordinates (Cs_r, Cs_w) not found in grid file.\n2025-11-19 12:26:56 - INFO - === Preparing the vertical coordinate system using N = 100, theta_s = 5.0, theta_b = 2.0, hc = 300.0 ===\n2025-11-19 12:26:56 - INFO - Total time: 0.003 seconds\n2025-11-19 12:26:56 - INFO - ========================================================================================================\n"},"children":[],"key":"edtKVrHU9t"}],"key":"NZtm8orqgq"}],"key":"mqzen9ls69"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid.update_vertical_coordinate(N=60, theta_s=5.0, theta_b=2.0, hc=300.0, verbose=False)","key":"ZzInCqF9SR"},{"type":"outputs","id":"ndokXubg9saAifbPMrgPl","children":[],"key":"qVLRIyIVcu"}],"key":"dMnCZWfR7p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"roms_output_bgc = ROMSOutput(\n    grid=grid,\n    path=[\n        \"/home/x-uheede/S/Iceland2_MARBL_2024_60m/Iceland2_MARBL_2024_bgc.20240[4-9]????????.nc\",\n    ],\n    use_dask=True,\n)\n\nroms_output_phys = ROMSOutput(\n    grid=grid,\n    path=[\n        \"/home/x-uheede/S/Iceland2_MARBL_2024_60m/Iceland2_MARBL_2024_his.20240[4-9]????????.nc\",\n    ],\n    use_dask=True,\n)","key":"wr1BRUwUJk"},{"type":"outputs","id":"E3ghNfSqQwbi1CZvOIR5Q","children":[],"key":"DfvxUsycwg"}],"key":"M4YrabhIYe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# open grid\ngrid=xr.open_mfdataset('/home/x-uheede/S/Iceland2_MARBL_2024_60m/P_INPUT/Iceland2_grid_MAT1.nc')\n\n# regridding\nh=roms_regrid(grid,grid['h'])\n\nmask=roms_regrid(grid,grid['mask_rho'])","key":"jXVWp4Y9og"},{"type":"outputs","id":"tiBOtPdPOrV_LP0C2eG-G","children":[],"key":"P7OVC5Xh7S"}],"key":"mkaRaIRd7i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"var_names=['ALK','DIC','PO4','NO3','SiO3','NH4','O2']\ndepth_levels=np.arange(0, 40,5)","key":"jr5A6SH9sr"},{"type":"outputs","id":"bsrWBbW3QvUeI6qilt7B6","children":[],"key":"aLUJTGgUuD"}],"key":"NlHdhbylFV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bgc = roms_output_bgc.regrid(depth_levels=depth_levels,var_names=var_names).load()\nphys = roms_output_phys.regrid(depth_levels=depth_levels)","key":"eitLhnfo4c"},{"type":"outputs","id":"JZFE2pAcHa0YaIebLOjjl","children":[],"key":"iEZX5KJcza"}],"key":"yjoQFE3RTX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"time_index = bgc.indexes['time']\nunique_time = ~time_index.duplicated()\n\nbgc = bgc.isel(time=unique_time)\nbgc = bgc.sortby('time')","key":"wqr1FyoEe8"},{"type":"outputs","id":"1uxPTfTH3jsR3NufRS816","children":[],"key":"K2jomDXqNg"}],"key":"HZAeh3Pofe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"time_index = phys.indexes['time']\nunique_time = ~time_index.duplicated()\n\nphys = phys.isel(time=unique_time)\nphys = phys.sortby('time')","key":"Ob7BvVeB1K"},{"type":"outputs","id":"H4UXZSzyxHX4LFaZjMymR","children":[],"key":"CnpSznrUzC"}],"key":"LZAlTWnz7u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"nTA_model=((bgc['ALK'].load()-TA0)/phys['salt'].load())*Sref+TA0\n\nnDIC_model=((bgc['DIC'].load()-DIC0)/phys['salt'].load())*Sref+DIC0\n\nbgc['nTA']=nTA_model\nbgc['nDIC']=nDIC_model","key":"SaJJqxQfrU"},{"type":"outputs","id":"nllcX80IusNEXt2QbbCiR","children":[],"key":"r8bMe0HtZr"}],"key":"SQIYTTyTeX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"WnBFwDXABD"},{"type":"outputs","id":"kECq9bd9l4oUfvAj4MBxd","children":[],"key":"nSuNVoC7yO"}],"key":"xdYZyeQqPA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# define location which calculations the average location of each station\ndef get_location(obs, hv_values):\n    locations = []\n    for hv in hv_values:\n        lat = (obs['lat'].sel(HV=hv).isel(depth_bin=0).mean('date').squeeze()).values+0\n        lon = obs['lon'].sel(HV=hv).isel(depth_bin=0).mean('date').squeeze().values + 360\n        locations.append([lat, lon])\n    return locations\n\n# List of HV values\nhv_values = 1,3,5,7,9,10,12\n\n# Get the locations\nlocations = get_location(obs, hv_values)","key":"Pq1ZmSJ7Vj"},{"type":"outputs","id":"fFG44NCL5IOKxV_chaFh1","children":[],"key":"NgN0E0SwAp"}],"key":"WcBgNZ6hoc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Assuming locations is a list of lat/lon pairs\nbgc_values = []\n\n# Loop over the first 10 locations and store each selection in t_values\nfor i in range(7):\n    lat, lon = locations[i]\n    \n    # Select the 't' values at the nearest lat/lon\n    bgc_selected = bgc.sel(lat=lat, method='nearest').sel(lon=lon, method='nearest')\n    \n    # Store the result in the list\n    bgc_values.append(bgc_selected)\n\n# Combine the selections into an xarray Dataset or DataArray\nbgc_values_combined = xr.concat(bgc_values, dim='location')\n\n# Assign a location coordinate for clarity (optional)\nbgc_values_combined = bgc_values_combined.assign_coords(location=('location', [1,3,5,7,9,10,12]))\nbgc_values_combined['depth']=bgc_values_combined.depth*(-1)\n","key":"ZVBjpdWOQe"},{"type":"outputs","id":"eLETnpkU8MHpGy9aUEnEB","children":[],"key":"UPywEoCfWq"}],"key":"Yl0itYe66c"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"yM6pNtvq0f"},{"type":"outputs","id":"kNhHvBqvRsQJvaPus7oNk","children":[],"key":"E2Bl0DotaM"}],"key":"rXvu554AYC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bgc_sub=bgc_values_combined.sel(time=(['2024-04-04T00:00:00.000000000', '2024-04-18T00:00:00.000000000',\n       '2024-04-26T00:00:00.000000000', '2024-05-13T00:00:00.000000000',\n       '2024-05-28T00:00:00.000000000', '2024-06-11T00:00:00.000000000',\n       '2024-06-26T00:00:00.000000000','2024-07-09T00:00:00.000000000','2024-07-25T00:00:00.000000000','2024-08-04T00:00:00.000000000',\n                                      '2024-09-17T00:00:00.000000000']), method='nearest')","key":"eSJXM11nlq"},{"type":"outputs","id":"8bdGCoTyWW3K8tIcddd0E","children":[],"key":"lkLi7R7Trw"}],"key":"vgJwgLseh4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bgc_sub.load()","key":"ihHELI4AvQ"},{"type":"outputs","id":"GoLKmgKkuvDbm2aJWDrJB","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":21,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"1d609aff914a9b2ed856ccf670dd35df","path":"/1d609aff914a9b2ed856ccf670dd35df.html"},"text/plain":{"content":"<xarray.Dataset> Size: 45kB\nDimensions:   (location: 7, time: 11, depth: 8)\nCoordinates:\n  * time      (time) datetime64[ns] 88B 2024-04-07T12:00:00 ... 2024-09-17\n    lat       (location) float32 28B 64.26 64.3 64.34 64.36 64.38 64.38 64.36\n    lon       (location) float32 28B 338.0 338.1 338.2 338.3 338.4 338.5 338.5\n  * depth     (depth) float32 32B -0.0 -5.0 -10.0 -15.0 -20.0 -25.0 -30.0 -35.0\n  * location  (location) int64 56B 1 3 5 7 9 10 12\nData variables:\n    ALK       (location, time, depth) float64 5kB 2.278e+03 ... 2.293e+03\n    DIC       (location, time, depth) float64 5kB 2.116e+03 ... 2.09e+03\n    PO4       (location, time, depth) float64 5kB 0.9046 0.9056 ... 0.7617\n    NO3       (location, time, depth) float64 5kB 11.31 11.32 ... 7.991 7.991\n    SiO3      (location, time, depth) float64 5kB 7.259 7.263 ... 6.828 6.828\n    NH4       (location, time, depth) float64 5kB 0.5676 0.5688 ... 0.9514\n    O2        (location, time, depth) float64 5kB 330.6 330.1 ... 278.9 278.9\n    nTA       (location, time, depth) float64 5kB 2.263e+03 ... 2.259e+03\n    nDIC      (location, time, depth) float64 5kB 2.102e+03 ... 2.06e+03\nAttributes: (12/44)\n    global_x:           512\n    global_y:           512\n    title:              Iceland2_MARBL_2024 , 200 m  resolution\n    grid_file:          /anvil/scratch/x-uheede/Iceland2_MARBL_2024_60m/P_INP...\n    forcing_files:       /anvil/scratch/x-uheede/Iceland2_MARBL_2024_60m/P_IN...\n    forcing_info:       \n    ...                 ...\n    tide_options:       # of constituents:10 , real , tidalpotential\n    river_frc_options:  OFF\n    pipe_frc_options:   OFF\n    particle_options:   OFF\n    git_version:        \n    regrid_method:      bilinear","content_type":"text/plain"}}},"children":[],"key":"v99GWaIxH2"}],"key":"VV9amxlRDg"}],"key":"LHZtu2Q5Nw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Define depth levels\nlevels = np.arange(0, 80)\n\n# Create figure and subplots (3 rows: 1 for the map, 2 for boxplots)\nfig = plt.figure(figsize=(12, 13))  # Wider figure for side-by-side plots\ngs = fig.add_gridspec(3, 2, height_ratios=[2, 1, 1], width_ratios=[1, 1])  \n\n# --- Shared Map (Top Row, Spanning Both Columns) ---\nax_map = fig.add_subplot(gs[0, :], projection=ccrs.PlateCarree())\n\n# Plot bathymetry\ncf1 = ax_map.contourf(h.lon, h.lat, h, levels, transform=ccrs.PlateCarree(), cmap='cividis')\nax_map.contourf(h.lon, h.lat, mask.where(mask != 1), cmap='Greys', transform=ccrs.PlateCarree())\n\n# Add station labels\nfor i, e in enumerate(locations):\n    ax_map.text(e[1], e[0], hv_values[i], color='red', size=10, ha='center', va='center', transform=ccrs.PlateCarree())\n\n# Gridlines\ngls = ax_map.gridlines(crs=ccrs.PlateCarree(), draw_labels=True, color='darkgray', alpha=0.5, linestyle='--')\ngls.top_labels = False\ngls.right_labels = False\n\n# Colorbar\ncb1 = plt.colorbar(cf1, shrink=0.5, ax=ax_map, orientation='horizontal', pad=0.05)\ncb1.set_label('Bottom Depth (m)', fontsize=10)\n\nax_map.set_extent([-22, -21.35, 64.25, 64.45], ccrs.PlateCarree())\nax_map.set_title('Station Overview')\n\n# --- Function for Extracting Data ---\ndef extract_cruise_data(var, depth=None, num_cruises=11):\n    \"\"\"Extracts non-NaN values for a given variable across cruises.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth_bin=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\ndef extract_model_data(var, depth=None, num_cruises=10):\n    \"\"\"Extracts non-NaN values from the model across time steps.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(time=i) if depth is None else var.isel(time=i, depth=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- Boxplots for Observations (Left) and Model (Right) ---\nax_obs = fig.add_subplot(gs[1, 0])  # Observations\nax_model = fig.add_subplot(gs[1, 1])  # Model\n\nax_obs.boxplot(extract_cruise_data(nTA), patch_artist=True)\nax_obs.set_title('Salinity Normalized Alk Variation (Observed)')\nax_obs.set_ylabel('mmol/m$^3$')\nax_obs.set_xticklabels([])\nax_obs.set_ylim(2280,2370)\n\nax_model.boxplot(extract_model_data(bgc_sub['nTA']), patch_artist=True)\nax_model.set_title('Salinity Normalized Alk Variation (Model)')\nax_model.set_xticklabels([])\nax_model.set_ylim(2230,2320)\n\n# --- Surface-Only Boxplots for Observations (Left) and Model (Right) ---\nax_obs_surface = fig.add_subplot(gs[2, 0])  # Observations (Surface)\nax_model_surface = fig.add_subplot(gs[2, 1])  # Model (Surface)\n\nax_obs_surface.boxplot(extract_cruise_data(nTA, depth=0), patch_artist=True)\nax_obs_surface.set_title('Salinity Normalized Alk, Surface Only (Observed)')\nax_obs_surface.set_xlabel('Cruise')\nax_obs_surface.set_ylabel('mmol/m$^3$')\nax_obs_surface.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\nax_obs_surface.set_ylim(2310,2390)\n\nax_model_surface.boxplot(extract_model_data(bgc_sub['nTA'], depth=0), patch_artist=True)\nax_model_surface.set_title('Salinity Normalized Alk, Surface Only (Model)')\nax_model_surface.set_xlabel('Cruise')\nax_model_surface.set_ylabel('mmol/m$^3$')\nax_model_surface.set_xticklabels(pd.to_datetime(bgc_sub['time']).strftime('%d/%m/%Y'), rotation=45)\nax_model_surface.set_ylim(2230,2310)\n\nplt.tight_layout()\nplt.show()\n","key":"zTRT6XYDUQ"},{"type":"outputs","id":"zN_g8e0d6lZDzyMOE4jeJ","children":[{"type":"output","jupyter_data":{"ename":"ValueError","evalue":"The number of FixedLocator locations (10), usually from a call to set_ticks, does not match the number of labels (11).","output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mValueError\u001b[39m                                Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[22]\u001b[39m\u001b[32m, line 83\u001b[39m\n\u001b[32m     81\u001b[39m ax_model_surface.set_xlabel(\u001b[33m'\u001b[39m\u001b[33mCruise\u001b[39m\u001b[33m'\u001b[39m)\n\u001b[32m     82\u001b[39m ax_model_surface.set_ylabel(\u001b[33m'\u001b[39m\u001b[33mmmol/m$^3$\u001b[39m\u001b[33m'\u001b[39m)\n\u001b[32m---> \u001b[39m\u001b[32m83\u001b[39m \u001b[43max_model_surface\u001b[49m\u001b[43m.\u001b[49m\u001b[43mset_xticklabels\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpd\u001b[49m\u001b[43m.\u001b[49m\u001b[43mto_datetime\u001b[49m\u001b[43m(\u001b[49m\u001b[43mbgc_sub\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43mtime\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m)\u001b[49m\u001b[43m.\u001b[49m\u001b[43mstrftime\u001b[49m\u001b[43m(\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[38;5;132;43;01m%d\u001b[39;49;00m\u001b[33;43m/\u001b[39;49m\u001b[33;43m%\u001b[39;49m\u001b[33;43mm/\u001b[39;49m\u001b[33;43m%\u001b[39;49m\u001b[33;43mY\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mrotation\u001b[49m\u001b[43m=\u001b[49m\u001b[32;43m45\u001b[39;49m\u001b[43m)\u001b[49m\n\u001b[32m     84\u001b[39m ax_model_surface.set_ylim(\u001b[32m2230\u001b[39m,\u001b[32m2310\u001b[39m)\n\u001b[32m     86\u001b[39m plt.tight_layout()\n\n\u001b[36mFile \u001b[39m\u001b[32m~/.local/lib/python3.11/site-packages/matplotlib/axes/_base.py:74\u001b[39m, in \u001b[36m_axis_method_wrapper.__set_name__.<locals>.wrapper\u001b[39m\u001b[34m(self, *args, **kwargs)\u001b[39m\n\u001b[32m     73\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mwrapper\u001b[39m(\u001b[38;5;28mself\u001b[39m, *args, **kwargs):\n\u001b[32m---> \u001b[39m\u001b[32m74\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mget_method\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/.local/lib/python3.11/site-packages/matplotlib/axis.py:2106\u001b[39m, in \u001b[36mAxis.set_ticklabels\u001b[39m\u001b[34m(self, labels, minor, fontdict, **kwargs)\u001b[39m\n\u001b[32m   2102\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(locator, mticker.FixedLocator):\n\u001b[32m   2103\u001b[39m     \u001b[38;5;66;03m# Passing [] as a list of labels is often used as a way to\u001b[39;00m\n\u001b[32m   2104\u001b[39m     \u001b[38;5;66;03m# remove all tick labels, so only error for > 0 labels\u001b[39;00m\n\u001b[32m   2105\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(locator.locs) != \u001b[38;5;28mlen\u001b[39m(labels) \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(labels) != \u001b[32m0\u001b[39m:\n\u001b[32m-> \u001b[39m\u001b[32m2106\u001b[39m         \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\n\u001b[32m   2107\u001b[39m             \u001b[33m\"\u001b[39m\u001b[33mThe number of FixedLocator locations\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m   2108\u001b[39m             \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33m (\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mlen\u001b[39m(locator.locs)\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m), usually from a call to\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m   2109\u001b[39m             \u001b[33m\"\u001b[39m\u001b[33m set_ticks, does not match\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m   2110\u001b[39m             \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33m the number of labels (\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mlen\u001b[39m(labels)\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m).\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m   2111\u001b[39m     tickd = {loc: lab \u001b[38;5;28;01mfor\u001b[39;00m loc, lab \u001b[38;5;129;01min\u001b[39;00m \u001b[38;5;28mzip\u001b[39m(locator.locs, labels)}\n\u001b[32m   2112\u001b[39m     func = functools.partial(\u001b[38;5;28mself\u001b[39m._format_with_dict, tickd)\n\n\u001b[31mValueError\u001b[39m: The number of FixedLocator locations (10), usually from a call to set_ticks, does not match the number of labels (11)."},"children":[],"key":"LdrRWg8u2C"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"16d82a03517904cc3c35cffbb6f26eb1","path":"/16d82a03517904cc3c35cffbb6f26eb1.png"},"text/plain":{"content":"<Figure size 1200x1300 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"s68jE6CIvm"}],"key":"hK8O57NMdP"}],"key":"JdntLvjJYC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Define depth levels\nlevels = np.arange(0, 80)\n\n# Create figure and subplots (3 rows: 1 for the map, 2 for boxplots)\nfig = plt.figure(figsize=(12, 7))  # Wider figure for side-by-side plots\ngs = fig.add_gridspec(2, 2, height_ratios=[1, 1], width_ratios=[1, 1])  \n\n\n\n# --- Function for Extracting Data ---\ndef extract_cruise_data(var, depth=None, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across cruises.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth_bin=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\ndef extract_model_data(var, depth=None, num_cruises=10):\n    \"\"\"Extracts non-NaN values from the model across time steps.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(time=i) if depth is None else var.isel(time=i, depth=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- Boxplots for Observations (Left) and Model (Right) ---\nax_obs = fig.add_subplot(gs[0, 0])  # Observations\nax_model = fig.add_subplot(gs[0, 1])  # Model\n\nax_obs.boxplot(extract_cruise_data(nDIC), patch_artist=True)\nax_obs.set_title('Salinity Normalized DIC Variation (Observed)')\nax_obs.set_ylabel('mmol/m$^3$')\nax_obs.set_xticklabels([])\nax_obs.set_ylim(2070,2180)\n\nax_model.boxplot(extract_model_data(bgc_sub['nDIC']), patch_artist=True)\nax_model.set_title('Salinity Normalized DIC Variation (Model)')\nax_model.set_xticklabels([])\nax_model.set_ylim(2030,2140)\n\n# --- Surface-Only Boxplots for Observations (Left) and Model (Right) ---\nax_obs_surface = fig.add_subplot(gs[1, 0])  # Observations (Surface)\nax_model_surface = fig.add_subplot(gs[1, 1])  # Model (Surface)\n\nax_obs_surface.boxplot(extract_cruise_data(nDIC, depth=0), patch_artist=True)\nax_obs_surface.set_title('Salinity Normalized DIC, Surface Only (Observed)')\nax_obs_surface.set_xlabel('Cruise')\nax_obs_surface.set_ylabel('mmol/m$^3$')\nax_obs_surface.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\nax_obs_surface.set_ylim(2070,2180)\n\nax_model_surface.boxplot(extract_model_data(bgc_sub['nDIC'], depth=0), patch_artist=True)\nax_model_surface.set_title('Salinity Normalized DIC, Surface Only (Model)')\nax_model_surface.set_xlabel('Cruise')\nax_model_surface.set_ylabel('mmol/m$^3$')\nax_model_surface.set_xticklabels(pd.to_datetime(bgc_sub['time'].isel(time=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\nax_model_surface.set_ylim()\nax_model_surface.set_ylim(2030,2150)\n\nplt.tight_layout()\nplt.show()\n","key":"Hegvjfc9qm"},{"type":"outputs","id":"vC6HGPoJOcB41tR4H3Ump","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c4f9966e3851b39f61e03d9d2f14f5c4","path":"/c4f9966e3851b39f61e03d9d2f14f5c4.png"},"text/plain":{"content":"<Figure size 1200x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"scUUIEGYpV"}],"key":"kpm1VKMkMy"}],"key":"pXC3YwmP9g"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(2290,2360,2)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=nTA.sel(HV=[1,5,9,10]).isel(date=slice(0,10)).mean('date')\ndata_alk2=obs['Alk'].sel(HV=[1,5,9,10]).isel(date=slice(0,10)).mean('date')\n\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(6*2, 3), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].invert_yaxis()\nax[0].set_title('salinity normalized alkalinity along fjord (observed)')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\nc0=ax[1].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].invert_yaxis()\nax[1].set_title('alkalinity along fjord (observed)')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')","key":"sV99yp7xtQ"},{"type":"outputs","id":"WE4tqOSSFt8UlN6naNKZD","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a3db1cde446ce6185f940a3acf505988","path":"/a3db1cde446ce6185f940a3acf505988.png"},"text/plain":{"content":"<Figure size 1200x300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"rSjex5ooTr"}],"key":"wwiIFPXHmr"}],"key":"DpoIkQDl41"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(2230,2300,2)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=bgc_sub['nTA'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).mean('time')\ndata_alk2=bgc_sub['ALK'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).mean('time')\n\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(6*2, 3), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth*(-1),data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].set_ylim(0,40)\nax[0].invert_yaxis()\nax[0].set_title('salinity normalized alkalinity along fjord (modeled)')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\n\nc0=ax[1].contourf(loc,data_alk2.depth*(-1),data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].set_ylim(0,40)\nax[1].invert_yaxis()\nax[1].set_title('alkalinity along fjord (modeled)')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')","key":"mbk7W6zDiN"},{"type":"outputs","id":"ZwrIAtU9T7hd0L2UMAp_R","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e631c7ea9b47d147b36b7aedac2eca9e","path":"/e631c7ea9b47d147b36b7aedac2eca9e.png"},"text/plain":{"content":"<Figure size 1200x300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"lTirNxwNfN"}],"key":"T9wynM0Jka"}],"key":"J5Rc4C1RhX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_alk2","key":"idvZJlfMw2"},{"type":"outputs","id":"YqG-0ooaB5Zi7hwXWiCXP","children":[],"key":"JLqHIbFp3n"}],"key":"KstPz2phAK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Compute mean and standard deviation over time for observations\ndepth_obs = obs['depth_bin'].values\ndepth_model = bgc_sub['depth'].values\n\n# Observations (Mean and Std Dev)\nalk_mean_obs = obs['Alk'].sel(HV=[1,5,9,10]).isel(date=slice(0,10)).mean(dim=['date', 'HV'])\nalk_std_obs = obs['Alk'].sel(HV=[1,5,9,10]).isel(date=slice(0,10)).std(dim=['date', 'HV'])\n\nnalk_mean_obs = nTA.sel(HV=[1,5,9,10]).isel(date=slice(0,10)).mean(dim=['date', 'HV'])\nnalk_std_obs = nTA.sel(HV=[1,5,9,10]).isel(date=slice(0,10)).std(dim=['date', 'HV'])\n\n# Model (Mean and Std Dev)\nalk_mean_model = bgc_sub['ALK'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).mean(dim=['time', 'location'])\nalk_std_model = bgc_sub['ALK'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).std(dim=['time', 'location'])\n\nnalk_mean_model = bgc_sub['nTA'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).mean(dim=['time', 'location'])\nnalk_std_model = bgc_sub['nTA'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).std(dim=['time', 'location'])\n\n# Create figure with 2 columns (nTA on left, TA on right)\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(12, 6), constrained_layout=True)\nax = axarr.flatten()\n\n# --- Plot Salinity Normalized Alkalinity (nTA) ---\nax[0].plot(nalk_mean_obs, depth_obs, marker='o', linestyle='-', color='b', label='Observed nTA')\nax[0].fill_betweenx(depth_obs, nalk_mean_obs - nalk_std_obs, nalk_mean_obs + nalk_std_obs, color='gray', alpha=0.3)\n\nax[0].plot(nalk_mean_model, depth_model*(-1), marker='s', linestyle='--', color='r', label='Modeled nTA')\nax[0].fill_betweenx(depth_model*(-1), nalk_mean_model - nalk_std_model, nalk_mean_model + nalk_std_model, color='pink', alpha=0.3)\n\nax[0].set_ylim(0,30)\nax[0].invert_yaxis()\nax[0].set_xlabel('Salinity Normalized Alkalinity (mmol/m³)')\nax[0].set_ylabel('Depth (m)')\nax[0].set_title('Salinity Normalized Alkalinity Profile')\nax[0].legend()\nax[0].grid()\n\n# --- Plot Total Alkalinity (TA) ---\nax[1].plot(alk_mean_obs, depth_obs, marker='o', linestyle='-', color='b', label='Observed TA')\nax[1].fill_betweenx(depth_obs, alk_mean_obs - alk_std_obs, alk_mean_obs + alk_std_obs, color='gray', alpha=0.3)\n\nax[1].plot(alk_mean_model, depth_model*(-1), marker='s', linestyle='--', color='r', label='Modeled TA')\nax[1].fill_betweenx(depth_model*(-1), alk_mean_model - alk_std_model, alk_mean_model + alk_std_model, color='pink', alpha=0.3)\nax[1].set_ylim(0,30)\nax[1].invert_yaxis()\nax[1].set_xlabel('Total Alkalinity (mmol/m³)')\nax[1].set_title('Total Alkalinity Profile')\nax[1].legend()\nax[1].grid()\n\nplt.show()\n","key":"jjm2bQiy3g"},{"type":"outputs","id":"T33BI16eYmr-yxOq7r0xv","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"aeb0b0d1ebae597ba42d627f181ca216","path":"/aeb0b0d1ebae597ba42d627f181ca216.png"},"text/plain":{"content":"<Figure size 1200x600 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"V9lOnl0oSH"}],"key":"ZrGOPhgvgG"}],"key":"WtFdD1fazH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Compute mean and standard deviation over time for observations\ndepth_obs = obs['depth_bin'].values\ndepth_model = bgc_sub['depth'].values\n\n# Observations (Mean and Std Dev)\nalk_mean_obs = obs['DIC'].sel(HV=[1,5,9,10]).isel(date=slice(0,10)).mean(dim=['date', 'HV'])\nalk_std_obs = obs['DIC'].sel(HV=[1,5,9,10]).isel(date=slice(0,10)).std(dim=['date', 'HV'])\n\nnalk_mean_obs = nDIC.sel(HV=[1,5,9,10]).isel(date=slice(0,10)).mean(dim=['date', 'HV'])\nnalk_std_obs = nDIC.sel(HV=[1,5,9,10]).isel(date=slice(0,10)).std(dim=['date', 'HV'])\n\n# Model (Mean and Std Dev)\nalk_mean_model = bgc_sub['DIC'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).mean(dim=['time', 'location'])\nalk_std_model = bgc_sub['DIC'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).std(dim=['time', 'location'])\n\nnalk_mean_model = bgc_sub['nDIC'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).mean(dim=['time', 'location'])\nnalk_std_model = bgc_sub['nDIC'].sel(location=[1,5,9,10]).isel(time=slice(2,7)).std(dim=['time', 'location'])\n\n# Create figure with 2 columns (nTA on left, TA on right)\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(12, 6), constrained_layout=True)\nax = axarr.flatten()\n\n# --- Plot Salinity Normalized Alkalinity (nTA) ---\nax[0].plot(nalk_mean_obs, depth_obs, marker='o', linestyle='-', color='b', label='Observed nTA')\nax[0].fill_betweenx(depth_obs, nalk_mean_obs - nalk_std_obs, nalk_mean_obs + nalk_std_obs, color='gray', alpha=0.3)\n\nax[0].plot(nalk_mean_model, depth_model*(-1), marker='s', linestyle='--', color='r', label='Modeled nTA')\nax[0].fill_betweenx(depth_model*(-1), nalk_mean_model - nalk_std_model, nalk_mean_model + nalk_std_model, color='pink', alpha=0.3)\n\nax[0].set_ylim(0,30)\nax[0].invert_yaxis()\nax[0].set_xlabel('Salinity Normalized DIC (mmol/m³)')\nax[0].set_ylabel('Depth (m)')\nax[0].set_title('Salinity Normalized DIC Profile')\nax[0].legend()\nax[0].grid()\n\n# --- Plot Total Alkalinity (TA) ---\nax[1].plot(alk_mean_obs, depth_obs, marker='o', linestyle='-', color='b', label='Observed TA')\nax[1].fill_betweenx(depth_obs, alk_mean_obs - alk_std_obs, alk_mean_obs + alk_std_obs, color='gray', alpha=0.3)\n\nax[1].plot(alk_mean_model, depth_model*(-1), marker='s', linestyle='--', color='r', label='Modeled TA')\nax[1].fill_betweenx(depth_model*(-1), alk_mean_model - alk_std_model, alk_mean_model + alk_std_model, color='pink', alpha=0.3)\nax[1].set_ylim(0,30)\nax[1].invert_yaxis()\nax[1].set_xlabel('Total DIC (mmol/m³)')\nax[1].set_title('Total DIC Profile')\nax[1].legend()\nax[1].grid()\n\nplt.show()\n","key":"mzV9sXgTRn"},{"type":"outputs","id":"u92t5aOjLbObuHjeXC_sr","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4c8221d24a2272bc76b6ff9261f8efa7","path":"/4c8221d24a2272bc76b6ff9261f8efa7.png"},"text/plain":{"content":"<Figure size 1200x600 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"IS4pnsRehI"}],"key":"QsFcLGM0Id"}],"key":"L74nbqqnhs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(2070,2160,2)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=nDIC.sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=nDIC.sel(HV=[1,5,9,10]).isel(date=slice(5,10)).mean('date')\n\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(6*2, 3), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth_bin,data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].invert_yaxis()\nax[0].set_title('salinity normalized DIC along fjord April-May (observed)')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\nc0=ax[1].contourf(loc,data_alk2.depth_bin,data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].invert_yaxis()\nax[1].set_title('salinity normalized DIC along fjord June-August (observed)')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')","key":"gcoTbBiA8J"},{"type":"outputs","id":"RFHmhcHnHC6yP-lBVl7tH","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"93e9173f7c1e17e32e540bda4714a91d","path":"/93e9173f7c1e17e32e540bda4714a91d.png"},"text/plain":{"content":"<Figure size 1200x300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"nq5cueXOQW"}],"key":"o9el4iQ3fD"}],"key":"ZUnpWR3iO3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loc = obs['lon'].sel(HV=[1,5,9,10]).isel(depth_bin=0).mean('date').values\ndepth=obs['depth_bin'].values\nlevels=np.arange(2070,2160,2)\n\nbins = np.arange(0, 90, 10) \n#depth_bins = xr.DataArray(pd.cut(depth, bins, labels=bins[:-1]), dims=\"depth\", name=\"binned_depth\")\n\ndata_alk1=nDIC.sel(HV=[1,5,9,10]).isel(date=slice(0,4)).mean('date')\ndata_alk2=nDIC.sel(HV=[1,5,9,10]).isel(date=slice(5,10)).mean('date')\n\ndata_alk1=bgc_sub['nDIC'].sel(location=[1,5,9,10]).isel(time=slice(0,4)).mean('time')\ndata_alk2=bgc_sub['nDIC'].sel(location=[1,5,9,10]).isel(time=slice(5,10)).mean('time')\n\n\nfig, axarr = plt.subplots(nrows=1, ncols=2, figsize=(6*2, 3), constrained_layout=True)\nax = axarr.flatten()\n\n#c0=ax[0].contourf(loc, data_alk.depth, data_alk.transpose())\nc0=ax[0].contourf(loc,data_alk1.depth*(-1),data_alk1.transpose(),levels)\nplt.colorbar(c0,ax=ax[0], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[0].set_ylim(0,40)\nax[0].invert_yaxis()\nax[0].set_title('salinity normalized DIC along fjord April-May (modeled)')\nax[0].set_xlabel('longitude')\nax[0].set_ylabel('depth (m)')\n\nc0=ax[1].contourf(loc,data_alk2.depth*(-1),data_alk2.transpose(),levels)\nplt.colorbar(c0,ax=ax[1], orientation='vertical', label='mmol/m3',shrink=0.5)\nax[1].set_ylim(0,40)\nax[1].invert_yaxis()\nax[1].set_title('salinity normalized DIC along fjord June-August (modeled )')\nax[1].set_xlabel('longitude')\nax[1].set_ylabel('depth (m)')","key":"YzKy0T8KY3"},{"type":"outputs","id":"cm2D3Y4Vb_1fBvlWV_Jch","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5febb032cf4ff196c82305c8318fa223","path":"/5febb032cf4ff196c82305c8318fa223.png"},"text/plain":{"content":"<Figure size 1200x300 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"q4TcfgcyS5"}],"key":"gOCBfc3pHd"}],"key":"dA4nkMXwEO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Create figure and subplots (1 row for salinity-normalized DIC, 2 columns for observations vs. model)\nfig, axes = plt.subplots(nrows=1, ncols=2, figsize=(12, 5), sharex=False)\n\n# --- Data Extraction Functions ---\ndef extract_depth_avg(var, depth_range, time_dim='date'):\n    \"\"\"Extracts mean value across a given depth range for each time step.\"\"\"\n    return var.sel(depth_bin=slice(*depth_range)).mean(dim='depth_bin', skipna=True)\n\ndef extract_depth_avg_model(var, depth_range, time_dim='time'):\n    \"\"\"Extracts mean value across a given depth range for each time step.\"\"\"\n    return var.sel(depth=slice(*depth_range)).mean(dim='depth', skipna=True)\n\n# Define depth ranges\nupper_depth_range = (0, 5)   # Upper level (0-10 m)\nlower_depth_range = (20, 40)  # Lower level (20-40 m)\n\nupper_depth_range_m = (-0.5,-5)   # Upper level (0-10 m)\nlower_depth_range_m = (-20, -40)  # Lower level (20-40 m)\n\n# --- Observations ---\nax_obs = axes[0]\nobs_upper = extract_depth_avg(nDIC.mean('HV'), upper_depth_range)\nobs_lower = extract_depth_avg(nDIC.mean('HV'), lower_depth_range)\n\nax_obs.plot(obs['date'], obs_upper, label='0-10m', marker='o', linestyle='-')\nax_obs.plot(obs['date'], obs_lower, label='20-40m', marker='s', linestyle='--')\nax_obs.set_title('Salinity-Normalized DIC (Observed)')\nax_obs.set_ylabel('mmol/m$^3$')\nax_obs.legend()\nax_obs.tick_params(axis='x', rotation=45)  # Rotate x-axis labels\n\n# --- Model ---\nax_model = axes[1]\nmodel_upper = extract_depth_avg_model(bgc_sub['nDIC'].mean('location'), upper_depth_range_m, time_dim='time')\nmodel_lower = extract_depth_avg_model(bgc_sub['nDIC'].mean('location'), lower_depth_range_m, time_dim='time')\n\nax_model.plot(bgc_sub['time'], model_upper, label='0-10m', marker='o', linestyle='-')\nax_model.plot(bgc_sub['time'], model_lower, label='20-40m', marker='s', linestyle='--')\nax_model.set_title('Salinity-Normalized DIC (Model)')\nax_model.legend()\nax_model.tick_params(axis='x', rotation=45)  # Rotate x-axis labels\n\nplt.tight_layout()\nplt.show()\n","key":"WNnu2RIgen"},{"type":"outputs","id":"KBYM1jVWvWguFcUdQRPDj","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5b269cc5faf97f6ec93dfd3ff3dc89c9","path":"/5b269cc5faf97f6ec93dfd3ff3dc89c9.png"},"text/plain":{"content":"<Figure size 1200x500 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"DHcHtPonIR"}],"key":"bSYhXrRMdP"}],"key":"PggAn35PnZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Create figure and subplots (4 rows for nutrients, 2 columns for observations vs. model)\nfig = plt.figure(figsize=(12, 13))  # Wider figure for side-by-side comparison\ngs = fig.add_gridspec(4, 2, height_ratios=[1, 1, 1, 1], width_ratios=[1, 1])  \n\n# --- Data Extraction Functions ---\ndef extract_cruise_data(var, depth=0, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across cruises (observations).\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i) if depth is None else var.isel(date=i, depth_bin=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\ndef extract_model_data(var, depth=0, num_cruises=10):\n    \"\"\"Extracts non-NaN values from the model across time steps.\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(time=i) if depth is None else var.isel(time=i, depth=depth))\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- NO3 Boxplots ---\nax1_obs = fig.add_subplot(gs[0, 0])  # Observations\nax1_model = fig.add_subplot(gs[0, 1])  # Model\n\nax1_obs.boxplot(extract_cruise_data(obs['NO3']), patch_artist=True)\nax1_obs.set_title('NO₃ Surface Only (Observed)')\nax1_obs.set_ylabel('mmol/m$^3$')\nax1_obs.set_xticklabels([])\n\nax1_model.boxplot(extract_model_data(bgc_sub['NO3']), patch_artist=True)\nax1_model.set_title('NO₃ Surface Only (Model)')\nax1_model.set_xticklabels([])\n\n# --- PO4 Boxplots ---\nax2_obs = fig.add_subplot(gs[1, 0])  # Observations\nax2_model = fig.add_subplot(gs[1, 1])  # Model\n\nax2_obs.boxplot(extract_cruise_data(obs['PO4']), patch_artist=True)\nax2_obs.set_title('PO₄ Surface Only (Observed)')\nax2_obs.set_ylabel('mmol/m$^3$')\nax2_obs.set_xticklabels([])\n\nax2_model.boxplot(extract_model_data(bgc_sub['PO4']), patch_artist=True)\nax2_model.set_title('PO₄ Surface Only (Model)')\nax2_model.set_xticklabels([])\n\n# --- SiO2 Boxplots ---\nax3_obs = fig.add_subplot(gs[2, 0])  # Observations\nax3_model = fig.add_subplot(gs[2, 1])  # Model\n\nax3_obs.boxplot(extract_cruise_data(obs['SiO2']), patch_artist=True)\nax3_obs.set_title('SiO₂ Surface Only (Observed)')\nax3_obs.set_ylabel('mmol/m$^3$')\nax3_obs.set_xticklabels([])\n\nax3_model.boxplot(extract_model_data(bgc_sub['SiO3']), patch_artist=True)\nax3_model.set_title('SiO₂ Surface Only (Model)')\nax3_model.set_xticklabels([])\n\n# --- NH4 Boxplots ---\nax4_obs = fig.add_subplot(gs[3, 0])  # Observations\nax4_model = fig.add_subplot(gs[3, 1])  # Model\n\nax4_obs.boxplot(extract_cruise_data(obs['NH4']), patch_artist=True)\nax4_obs.set_title('NH₄ Surface Only (Observed)')\nax4_obs.set_xlabel('Cruise')\nax4_obs.set_ylabel('mmol/m$^3$')\nax4_obs.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nax4_model.boxplot(extract_model_data(bgc_sub['NH4']), patch_artist=True)\nax4_model.set_title('NH₄ Surface Only (Model)')\nax4_model.set_xlabel('Cruise')\nax4_model.set_ylabel('mmol/m$^3$')\nax4_model.set_xticklabels(pd.to_datetime(bgc_sub['time'].isel(time=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nplt.tight_layout()\nplt.show()\n","key":"ySNP1HbIZE"},{"type":"outputs","id":"klDVtZkr-fH9WkY8WnU-n","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5a3df790568965437cf05dd4f4d2bd57","path":"/5a3df790568965437cf05dd4f4d2bd57.png"},"text/plain":{"content":"<Figure size 1200x1300 with 8 Axes>","content_type":"text/plain"}}},"children":[],"key":"jLeA1WaGgU"}],"key":"nMM1blyv36"}],"key":"vDOtnNuvfI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Create figure and subplots (4 rows for nutrients, 2 columns for observations vs. model)\nfig = plt.figure(figsize=(12, 13))  # Wider figure for side-by-side comparison\ngs = fig.add_gridspec(4, 2, height_ratios=[1, 1, 1, 1], width_ratios=[1, 1])  \n\n# --- Data Extraction Functions ---\ndef extract_cruise_data(var, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across all depths and cruises (observations).\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(date=i))  # Include all depth levels\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\ndef extract_model_data(var, num_cruises=10):\n    \"\"\"Extracts non-NaN values for a given variable across all depths and time steps (model).\"\"\"\n    cruises = []\n    for i in range(num_cruises):\n        data = np.hstack(var.isel(time=i))  # Include all depth levels\n        cruises.append(data[~np.isnan(data)])\n    return cruises\n\n# --- NO3 Boxplots (All Depths) ---\nax1_obs = fig.add_subplot(gs[0, 0])  # Observations\nax1_model = fig.add_subplot(gs[0, 1])  # Model\n\nax1_obs.boxplot(extract_cruise_data(obs['NO3']), patch_artist=True)\nax1_obs.set_title('NO₃ (All Depths, Observed)')\nax1_obs.set_ylabel('mmol/m$^3$')\nax1_obs.set_xticklabels([])\n\nax1_model.boxplot(extract_model_data(bgc_sub['NO3']), patch_artist=True)\nax1_model.set_title('NO₃ (All Depths, Model)')\nax1_model.set_xticklabels([])\n\n# --- PO4 Boxplots (All Depths) ---\nax2_obs = fig.add_subplot(gs[1, 0])  # Observations\nax2_model = fig.add_subplot(gs[1, 1])  # Model\n\nax2_obs.boxplot(extract_cruise_data(obs['PO4']), patch_artist=True)\nax2_obs.set_title('PO₄ (All Depths, Observed)')\nax2_obs.set_ylabel('mmol/m$^3$')\nax2_obs.set_xticklabels([])\n\nax2_model.boxplot(extract_model_data(bgc_sub['PO4']), patch_artist=True)\nax2_model.set_title('PO₄ (All Depths, Model)')\nax2_model.set_xticklabels([])\n\n# --- SiO2 Boxplots (All Depths) ---\nax3_obs = fig.add_subplot(gs[2, 0])  # Observations\nax3_model = fig.add_subplot(gs[2, 1])  # Model\n\nax3_obs.boxplot(extract_cruise_data(obs['SiO2']), patch_artist=True)\nax3_obs.set_title('SiO₂ (All Depths, Observed)')\nax3_obs.set_ylabel('mmol/m$^3$')\nax3_obs.set_xticklabels([])\n\nax3_model.boxplot(extract_model_data(bgc_sub['SiO3']), patch_artist=True)\nax3_model.set_title('SiO₂ (All Depths, Model)')\nax3_model.set_xticklabels([])\n\n# --- NH4 Boxplots (All Depths) ---\nax4_obs = fig.add_subplot(gs[3, 0])  # Observations\nax4_model = fig.add_subplot(gs[3, 1])  # Model\n\nax4_obs.boxplot(extract_cruise_data(obs['NH4']), patch_artist=True)\nax4_obs.set_title('NH₄ (All Depths, Observed)')\nax4_obs.set_xlabel('Cruise')\nax4_obs.set_ylabel('mmol/m$^3$')\nax4_obs.set_xticklabels(pd.to_datetime(obs['date'].isel(date=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nax4_model.boxplot(extract_model_data(bgc_sub['NH4']), patch_artist=True)\nax4_model.set_title('NH₄ (All Depths, Model)')\nax4_model.set_xlabel('Cruise')\nax4_model.set_ylabel('mmol/m$^3$')\nax4_model.set_xticklabels(pd.to_datetime(bgc_sub['time'].isel(time=slice(0,10))).strftime('%d/%m/%Y'), rotation=45)\n\nplt.tight_layout()\nplt.show()\n","key":"ybNuCQdNWG"},{"type":"outputs","id":"4RbzlFTuAQcMbowJ3LdPY","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cc313ea0aed15eeabd7f1c49e73093ec","path":"/cc313ea0aed15eeabd7f1c49e73093ec.png"},"text/plain":{"content":"<Figure size 1200x1300 with 8 Axes>","content_type":"text/plain"}}},"children":[],"key":"RO9PPwMxXz"}],"key":"F0LxdEF9DL"}],"key":"D1PkB7e4KW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\n# Create figure and subplots (4 rows for nutrients, 2 columns for observations vs. model)\nfig, axes = plt.subplots(nrows=4, ncols=2, figsize=(12, 13), sharex=False)  \n\n# --- Data Extraction Functions ---\ndef extract_depth_avg(var, depth_range, time_dim='date'):\n    \"\"\"Extracts mean value across a given depth range for each time step.\"\"\"\n    return var.sel(depth_bin=slice(*depth_range)).mean(dim='depth_bin', skipna=True)\n\ndef extract_depth_avg_model(var, depth_range, time_dim='time'):\n    \"\"\"Extracts mean value across a given depth range for each time step.\"\"\"\n    return var.sel(depth=slice(*depth_range)).mean(dim='depth', skipna=True)\n\n# Define depth ranges\nupper_depth_range = (0,5)   # Upper level (0-10 m)\nlower_depth_range = (20, 40)  # Lower level (20-40 m)\n\nupper_depth_range_m = (-0.5,-5)   # Upper level (0-10 m)\nlower_depth_range_m = (-20, -40)  # Lower level (20-40 m)\n\n# Define nutrients and their respective labels\nnutrients = ['NO3', 'PO4', 'SiO2', 'NH4']\nnutrients_m = ['NO3', 'PO4', 'SiO3', 'NH4']\ntitles = ['NO₃', 'PO₄', 'SiO$_3$', 'NH₄']\n\n# --- Plot each nutrient ---\nfor i, nutrient in enumerate(nutrients):\n    # Observations\n    ax_obs = axes[i, 0]\n    obs_upper = extract_depth_avg(obs[nutrient].mean('HV'), upper_depth_range)\n    obs_lower = extract_depth_avg(obs[nutrient].mean('HV'), lower_depth_range)\n\n    ax_obs.plot(obs['date'], obs_upper, label='0-10m', marker='o', linestyle='-')\n    ax_obs.plot(obs['date'], obs_lower, label='20-40m', marker='s', linestyle='--')\n    ax_obs.set_title(f'{titles[i]} (Observed)')\n    ax_obs.set_ylabel('mmol/m$^3$')\n    ax_obs.legend()\n    ax_obs.tick_params(axis='x', rotation=45)  # Rotate x-axis labels\n\n\nfor i, nutrient in enumerate(nutrients_m):\n    # Model\n    ax_model = axes[i, 1]\n    model_upper = extract_depth_avg_model(bgc_sub[nutrient].mean('location'), upper_depth_range_m, time_dim='time')\n    model_lower = extract_depth_avg_model(bgc_sub[nutrient].mean('location'), lower_depth_range_m, time_dim='time')\n\n    ax_model.plot(bgc_sub['time'], model_upper, label='0-10m', marker='o', linestyle='-')\n    ax_model.plot(bgc_sub['time'], model_lower, label='20-40m', marker='s', linestyle='--')\n    ax_model.set_title(f'{titles[i]} (Model)')\n    ax_model.legend()\n    ax_model.tick_params(axis='x', rotation=45)  # Rotate x-axis labels\n\n\nplt.tight_layout()\nplt.show()\n","key":"Id7XhXVzwa"},{"type":"outputs","id":"w6S7wKgRDljW8wmVSA7qt","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"86bc3f85689fbcccd97da96dd42fd2b1","path":"/86bc3f85689fbcccd97da96dd42fd2b1.png"},"text/plain":{"content":"<Figure size 1200x1300 with 8 Axes>","content_type":"text/plain"}}},"children":[],"key":"X7x9pyT0d6"}],"key":"KkHVfOhhOf"}],"key":"JHdNJOIaXF"}],"key":"wJdVKVlU6o"},"references":{"cite":{"order":[],"data":{}}}}